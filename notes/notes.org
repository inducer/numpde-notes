#+TITLE: Numerical Methods for Partial Differential Equations
#+SUBTITLE: CS555 / MATH552 / CSE510
#+AUTHOR: Andreas Kloeckner
#+DATE: Spring 2022

* LaTeX header setup stuff                                         :noexport:

#+startup: beamer content indent

#+LATEX_CLASS: beamer
#+LaTeX_CLASS_OPTIONS: [aspectratio=149]

#+BEAMER_HEADER: \setbeamertemplate{navigation symbols}{}
#+BEAMER_HEADER: \setbeamertemplate{footline}{%
#+BEAMER_HEADER:     \raisebox{5pt}{\makebox[\paperwidth]{\hfill\makebox[20pt]{\color{gray}
#+BEAMER_HEADER:           \scriptsize\insertframenumber}}}\hspace*{5pt}}

#+BEAMER_HEADER: \usepackage{tikz}
#+BEAMER_HEADER: \usetikzlibrary{calc}
#+BEAMER_HEADER: \usetikzlibrary{positioning}
#+BEAMER_HEADER: \usetikzlibrary{shapes.geometric}
#+BEAMER_HEADER: \usetikzlibrary{shapes.arrows}
#+BEAMER_HEADER: \usetikzlibrary{shapes.symbols}
#+BEAMER_HEADER: \usetikzlibrary{shadows}
#+BEAMER_HEADER: \usetikzlibrary{chains}
#+BEAMER_HEADER: \usetikzlibrary{fit}
#+BEAMER_HEADER: \usetikzlibrary{decorations}
#+BEAMER_HEADER: \usetikzlibrary{decorations.pathreplacing}
#+BEAMER_HEADER: \usetikzlibrary{3d}
#+BEAMER_HEADER: \usepackage{gnuplot-lua-tikz}

#+BEAMER_HEADER: \usepackage{environ}
#+BEAMER_HEADER: \usepackage{tcolorbox}
#+BEAMER_HEADER: \usepackage{stmaryrd}

#+BEAMER_HEADER: \usepackage{pifont}
#+BEAMER_HEADER: \usepackage[normalem]{ulem}

#+BEAMER_HEADER: \newif\ifshowhidden
#+BEAMER_HEADER: \showhiddentrue
#+BEAMER_HEADER: \def\fillinbox#1{\begin{tcolorbox}[height=#1]\end{tcolorbox}}
#+BEAMER_HEADER: \ifshowhidden
#+BEAMER_HEADER:   \NewEnviron{hidden}[0]{\begin{tcolorbox}\BODY\end{tcolorbox}}
#+BEAMER_HEADER: \else
#+BEAMER_HEADER:   \NewEnviron{hidden}[0]{\begin{tcolorbox}[colback=white]\phantom{\vbox{\BODY}}\end{tcolorbox}}
# #+BEAMER_HEADER:   \setbeamercolor{background canvas}{bg=black!7!white}
#+BEAMER_HEADER: \fi

#+BEAMER_HEADER: \let\plainhref=\href
#+BEAMER_HEADER: \let\plainurl=\url
#+BEAMER_HEADER: \def\href#1#2{\plainhref{#1}{{\color{orange}\uline{#2}}}}
#+BEAMER_HEADER: \def\url#1{\href{#1}{\texttt{#1}}}

#+BEAMER_HEADER: \def\classurl{https://relate.cs.illinois.edu/course/cs450-s19/}

#+BEAMER_HEADER: \def\activity#1{\href{\classurl/flow/#1/start}{Activity: #1}}
#+BEAMER_HEADER: \def\demonote#1{\ifshowhidden\medskip\par Demo Instructions: {\color{blue} #1}\fi}
#+BEAMER_HEADER: \newcommand{\inclass}[1]{\textcolor{purple}{\textbf{In-class activity: }#1}}
#+BEAMER_HEADER: \newcommand{\demo}[1]{\textcolor{purple}{\textbf{Demo: }#1}}
#+BEAMER_HEADER: \newcommand{\demolink}[2]{{\color{purple}%
#+BEAMER_HEADER: \plainhref{https://mybinder.org/v2/gh/inducer/numpde-notes/main?filepath=demos/#1/#2.ipynb}{\uline{\textbf{Demo: }#2}}
#+BEAMER_HEADER: [\plainhref{https://mybinder.org/v2/gh/inducer/numpde-notes/main?filepath=cleared-demos/#1/#2.ipynb}{\uline{cleared}}]%
#+BEAMER_HEADER: }}
#+BEAMER_HEADER: \newcommand{\inclasslink}[2]{\plainhref{\classurl/flow/inclass-#1/start}{\color{purple}\uline{\textbf{In-class activity: }#2}}}
#+BEAMER_HEADER: \newcommand{\sourceref}[1]{{\footnotesize[#1]}}

#+BEAMER_HEADER: \let\tmop=\operatorname
#+BEAMER_HEADER: \let\ds=\displaystyle
#+BEAMER_HEADER: \let\laplace=\triangle
#+BEAMER_HEADER: \let\leqslant=\le
#+BEAMER_HEADER: \let\geqslant=\ge

#+BEAMER_HEADER: \newcommand{\symball}[2]{
#+BEAMER_HEADER:   \begin{tikzpicture}[baseline=-0.7ex]
#+BEAMER_HEADER:     \shadedraw [shading=ball,ball color=#1,use as bounding box]
#+BEAMER_HEADER:       circle (1ex) node at (0.7ex,0) [minimum width=0.7ex] {};
#+BEAMER_HEADER:
#+BEAMER_HEADER:     \node [text=white,font=\bfseries] {#2};
#+BEAMER_HEADER:   \end{tikzpicture}}
#+BEAMER_HEADER: \newcommand{\plusball}{\symball{green}{{\small +}}}
#+BEAMER_HEADER: \newcommand{\okball}{\symball{orange}{o}}
#+BEAMER_HEADER: \newcommand{\minusball}{\symball{red}{-}}

#+BEAMER_HEADER: \let\b=\boldsymbol
#+BEAMER_HEADER: \let\op=\operatorname
#+BEAMER_HEADER: \newcommand{\nocomma}{}
#+BEAMER_HEADER: \newcommand{\Alpha}{A}

#+BEAMER_HEADER: \newcommand{\abs}[1]{\left| #1 \right|}
#+BEAMER_HEADER: \newcommand{\norm}[1]{\left\| #1 \right\|}
#+BEAMER_HEADER: \newcommand{\seminorm}[1]{\left| #1 \right|}
#+BEAMER_HEADER: \newcommand{\ip}[2]{\left\langle #1, #2 \right\rangle}
#+BEAMER_HEADER: \newcommand{\mathd}{\mathrm{d}}
#+BEAMER_HEADER: \newcommand{\assign}{:=}
#+BEAMER_HEADER: \newcommand{\fl}{\operatorname{fl}}

#+BEAMER_HEADER: \def\assign{:=}

#+BEAMER_HEADER: \newcommand{\avg}[1]{\{#1\}}
#+BEAMER_HEADER: \newcommand{\jump}[1]{\left\llbracket#1\right\rrbracket}

#+BEAMER_HEADER: \def\credit#1{
#+BEAMER_HEADER:   \begin{tikzpicture}[overlay]
#+BEAMER_HEADER:     \node [above left=0.75cm of current page.south east,
#+BEAMER_HEADER:       font=\scriptsize,fill=gray!30,opacity=0.5]
#+BEAMER_HEADER:       {#1};
#+BEAMER_HEADER:   \end{tikzpicture}
#+BEAMER_HEADER: }

#+BEAMER_HEADER: \tikzstyle{every picture}+=[remember picture]
#+BEAMER_HEADER: \pgfdeclarelayer{background}
#+BEAMER_HEADER: \pgfdeclarelayer{foreground}
#+BEAMER_HEADER: \pgfsetlayers{background,main,foreground}

#+BEAMER_HEADER: \newcommand{\cc}{\raisebox{-0.25ex}{\includegraphics[height=2ex]{cc.pdf}}}

#+BEAMER_HEADER: \AtBeginSection[] {
#+BEAMER_HEADER:   \begin{frame}[shrink]{Outline}
#+BEAMER_HEADER:     \linespread{0.8}
#+BEAMER_HEADER:     \tableofcontents[sectionstyle=show/shaded,subsectionstyle=show/show/hide]
#+BEAMER_HEADER:   \end{frame}
#+BEAMER_HEADER: }
#+BEAMER_HEADER: \AtBeginSubsection[] {
#+BEAMER_HEADER:   \begin{frame}[shrink]{Outline}
#+BEAMER_HEADER:     \linespread{0.8}
#+BEAMER_HEADER:     \tableofcontents[sectionstyle=show/shaded,subsectionstyle=show/shaded/hide]
#+BEAMER_HEADER:   \end{frame}
#+BEAMER_HEADER: }

#+BEAMER_HEADER: \usecolortheme{orchid}

#+LATEX_COMPILER: pdflatex
#+OPTIONS: H:3 toc:nil ':t tasks:t
#+BEAMER_THEME: default
#+COLUMNS: %45ITEM %10BEAMER_ENV(Env) %10BEAMER_ACT(Act) %4BEAMER_COL(Col) %8BEAMER_OPT(Opt)

* Introduction
  :PROPERTIES:
  :RELATE_TREE_SECTION_NAME: intro
  :RELATE_TREE_SECTION_OPENED: true
  :END:
** Notes
  :PROPERTIES:
  :RELATE_TREE_ICON: fa fa-book
  :RELATE_TREE_LINK: https://andreask.cs.illinois.edu/cs555-s22/notes.pdf
  :END:

** Notes (unfilled, with empty boxes)
  :PROPERTIES:
  :RELATE_TREE_ICON: fa fa-book
  :RELATE_TREE_LINK: https://andreask.cs.illinois.edu/cs555-s22/notes-folded.pdf
  :END:
** About the Class
*** What's the point of this class?

PDEs describe lots of things in nature:

#+LATEX: \begin{hidden}
- Fluid flow (Navier-Stokes equations)
- Electromagnetism (Maxwell's equations)
- Waves (Elasticity, Acoustics)
- Plasmas (Magnetohydrodynamics)
#+LATEX: \end{hidden}

Idea: Use them to
#+LATEX: \begin{hidden}
- Make predictions (and check them, to validate the model: science!)
- Use predictions (for design of cars, airplanes, reactors, ...)
#+LATEX: \end{hidden}

*** Survey

- Home dept
- Degree pursued
- Longest program ever written
  - in Python?
- Research area

*** Class web page

#+BEGIN_CENTER
[[https://bit.ly/numpde-s22]]
#+END_CENTER

- Book Draft
- Notes, Class Outline
- Assignments (submission and return)
- Piazza
- Grading Policies/Syllabus
- Video
- Scribbles
- Demos (binder)

*** Sources for these Notes

- Adler, James, Hans De Sterck, Scott MacLachlan, and Luke N. Olson.
  /Numerical Partial Differential Equations/, 2022. (draft)
- Strikwerda, John C. /Finite Difference Schemes and Partial Differential Equations/, Second Edition. Other Titles in Applied Mathematics. Society for Industrial and Applied Mathematics, 2004.
- LeVeque, Randall J. /Numerical Methods for Conservation Laws/. 2nd ed. Birkhäuser Basel, 1992.
- Braess, Dietrich. /Finite Elements: Theory, Fast Solvers, and Applications in Solid Mechanics/. Cambridge University Press, 2007.
- Shu, Chi-Wang. /Lecture Notes for AM257/, Brown University, Fall 2006.
- Heuveline, Vincent. /Lecture Notes for ``Numerik für PDEs''/. Universität Karlsruhe, Summer 2005.
- Various prior bits of material by Luke Olson and Stephen Bond.

*** Open Source <3
    
These notes (and the accompanying demos) are open-source!

\bigskip
Bug reports and pull requests welcome: [[https://github.com/inducer/numpde-notes]]

\bigskip
Copyright (C) 2020-22 Andreas Kloeckner

\bigskip
\scriptsize
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

\medskip
The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

\medskip
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

** Classifcation of PDEs
*** PDEs: Example I

What does this do? \(\partial_t u =\partial_x u\)
#+LATEX: \begin{hidden}
- Slope in $x$ and $t$ matches
- Single profile on an \(x\)/\(t\) diagonal
- Which one? (left-leaning)
- We'll deal with this a lot.
  - *Advection equation*, *one-way wave equation*
  - General solution: $u(x,t)=u_0(x+t)$
#+LATEX: \end{hidden}

*** PDEs: Example II

What does this do? \(\partial_x^2 u +\partial_y^2 u=0\)
#+LATEX: \begin{hidden}
- Second derivative measures "bendiness" of a function
- "Bendiness" in $x$ and $y$ need to add up to zero
- Can a function like this have a maximum?
#+LATEX: \end{hidden}

*** Some good questions

- What is a time-like variable? (Variables labeled $t$?)
#+LATEX: \begin{hidden}
A variable across which information does not flow `backward'.
#+LATEX: \end{hidden}
- What if there are boundaries? (space/time)
- Existence and Uniqueness of Solutions?
  - Depends on where we look (the /function space/)
  - In the case of the two examples? (if there are no boundaries?)

Some general takeaways:
#+LATEX: \begin{hidden}
- Simple techniques can go a long way.
- Develop/make use of physical intuition.
#+LATEX: \end{hidden}

*** PDEs: An Unhelpfully Broad Problem Statement

Looking for $u:\Omega \to R^n$ where $\Omega\subseteq \mathbb R^d$ so that
$u\in V$ and
\[F(u, u_x, u_y, u_{xx}, u_{xy}, u_{yy}, \dots, x, y, \dots) = 0\]

**** Notation

Used as convenient:
\[u_x = \partial_x u = \frac{\partial u}{\partial x}\]

*** Properties of PDEs

What is the *order* of the PDE?
#+LATEX: \begin{hidden}
The highest (total, i.e. summing over axes) order of derivative occurring in $F$.
#+LATEX: \end{hidden}

When is the PDE *linear*?
#+LATEX: \begin{hidden}
If $u$ and $v$ are solutions, $\alpha u +\beta v$ are, too.
#+LATEX: \end{hidden}

When is the PDE *quasilinear*?
#+LATEX: \begin{hidden}
The dependency in $F$ on the highest-order partial derivatives is linear in $u$.
#+LATEX: \end{hidden}

When is the PDE *semilinear*?
#+LATEX: \begin{hidden}
If it is quasi-linear and if the high-order terms have coefficients that depend only on space.
#+LATEX: \end{hidden}

*** Examples: Order, Linearity?
\[(xu^2 )u_{xx} + (u_x + y)u_{yy} + u^3_x + yu_y = f \]
#+LATEX: \begin{hidden}
Second-order quasilinear
#+LATEX: \end{hidden}
\[(x + y + z)u_x + (z^2 )u_y + (\sin x)u_z = f\]
#+LATEX: \begin{hidden}
First-order semilinear
#+LATEX: \end{hidden}

*** Properties of Domains

#+LATEX: \begin{hidden}
- smooth
- with corners
- with /reentrant/  corners
- with cusps

May influence existence/uniqueness of solutions!
#+LATEX: \end{hidden}

*** Function Spaces: Examples

Name some function spaces with their norms.
#+LATEX: \begin{hidden}

\begin{tabular}{l|p{12.0cm}}
  \(C (\Omega )\) & \(f\) continuous, \(\|f\|_\infty  \assign \sup _{x \in \Omega }     |f (x) |\)\\
  \(C^k (\Omega )\) & \(f\) \(k\)-times continuously differentiable\\
  \(C^{0, \alpha } (\Omega )\) & \(\|f\|_\alpha  \assign \|f\|_\infty  + \sup _{x     \ne y}  \frac{|f (x) - f (y) |}{|x - y|^\alpha }\) (\(\alpha \in (0, 1)\))\\
  \(C_L (\Omega )\) & \(|f (x) - (y) | \le L \norm{x - y}\)\\
  \(L_p (\Omega )\) & \(\norm{f}_{p,\Omega} \assign \sqrt[p]{\int _D |f (x) |^p dx} < \infty\)

    Why do these only define equivalence classes?

    \(L_2\) special because\dots?\\
  \(W_p^1 (\Omega )\) & \(\|f\|_{W^p_1(\Omega)} \assign (\|f\|_{p,\Omega}+\norm{f'}_{p,\Omega})  < \infty\)\\
  \(H^1 (\Omega )\) & equivalent to \(W^1_2(\Omega)\), also a Hilbert space
\end{tabular}
#+LATEX: \end{hidden}
May /also/ influence existence/uniqueness of solutions!

*** Solving PDEs

Closed-form solutions:

- If separation of variables applies to the domain: good luck with your ODE
- If not: Good luck! $\to$ Numerics

**** General Idea (that we will follow some of the time)

- Pick $V_h\subseteq V$ finite-dimensional
  - $h$ is often a /mesh spacing/
- Approximate $u$ through $u_h\in V_h$
- Show: $u_h\to u$ (in some sense) as $h\to 0$

**** Example

#+LATEX: \begin{hidden}
$u(x)=\sin x$ where $V_h$ is piecewise constant functions with grid spacing $h$.
#+LATEX: \end{hidden}

*** About grand big unifying theories

Is there a grand big unifying theory of PDEs?
#+LATEX: \begin{hidden}
No. Frustratingly, studying PDEs is a little bit like stamp
collecting. For instance, there are broad classes of second-order PDEs
that behave mostly alike.
#+LATEX: \end{hidden}
*** Collect some stamps

\[a(x, y)u_{xx} + 2b(x, y)u_{xy} + c(x, y)u_{yy} + d(x, y)u_x + e(x, y)u_y + f (x, y)u = g(x, y)\]

| Discriminant value | Kind       | Example               |
|--------------------+------------+-----------------------|
| $b^2-ac<0$        | Elliptic   | Laplace $u_{xx}+u_{yy}=0$ |
| $b^2-ac=0$        | Parabolic  | Heat $u_t=u_{xx}$    |
| $b^2-ac>0$        | Hyperbolic | Wave $u_{tt}=u_{xx}$  |

Where do these names come from?
#+LATEX: \begin{hidden}
Quadratic forms: $a x^2 +2b xy +c y^2 + \text{lower order terms}$

Where does this come from? The search for /characteristic curves/.
Will see these again later. See [[https://people.maths.bris.ac.uk/~maajh/methods/chap1.pdf][Hogg `17]] for a good description.
#+LATEX: \end{hidden}

*** PDE Classification in Other Cases
Scalar first order PDEs?
#+LATEX: \begin{hidden}
Classified as hyperbolic. (See later.)
#+LATEX: \end{hidden}
First order systems of PDEs?
#+LATEX: \begin{hidden}
Can be classified into hyperbolic/elliptic/parabolic as well, using
slightly more complicated method, depending on the direction of
the characteristics. See [[https://people.maths.bris.ac.uk/~maajh/methods/chap1.pdf][Hogg `17]] or [[http://people.3sr-grenoble.fr/users/bloret/enseee/maths/loret_maths-EEE.html][Loret `08]].
#+LATEX: \end{hidden}
*** Classification in higher dimensions

\[ Lu \assign \sum_{i = 1}^d \sum_{j = 1}^d a_{i, j} (x) \frac{\partial^2
   u}{\partial x_i \partial x_j} + \text{lower order terms} \]

Consider the matrix $A(x)=(a_{ij} (x))_{i,j}$. May assume $A$ symmetric. Why?
#+LATEX: \begin{hidden}
Schwarz's theorem. So: real-valued eigenvalues.
#+LATEX: \end{hidden}

What cases can arise for the eigenvalues?

#+LATEX: \begin{hidden}
| Case                                                 | Kind             |
|------------------------------------------------------+------------------|
| $\lambda_j(x)=0$ for some $\lambda$                  | parabolic        |
| $\lambda_j(x)$ all have the same sign                | elliptic         |
| $\lambda_j(x)$ all but one have the same sign        | hyperbolic       |
| $\lambda_j(x)$ $>1$ eigenvalue per sign, nonsingular | ultra-hyperbolic |
#+LATEX: \end{hidden}

*** Elliptic PDE: Laplace/Poisson Equation

\[\laplace u =\sum_{i=1}^d \frac{\partial^2 u}{\partial x_i^2}=\nabla\cdot\nabla u(x)\overset{\text{2D}}=u_{xx}+u_{yy}=f(x) \quad (x\in \Omega)\]
Called *Laplace equation* if $f=0$. With *Dirichlet boundary condition*
\[u(x)=g(x) \qquad (x\in\partial\Omega).\]

\demolink{intro}{Elliptic PDE Illustrating the Maximum Principle}

*** Elliptic PDEs: Singular Solution

\demolink{intro}{Elliptic PDE Radially Symmetric Singular Solution}

\medskip
Given $G(x)=C\log(|x|)$ as the *free-space Green's function*, can we
construct the solution to the PDE with a more general $f$?
#+LATEX: \begin{hidden}
\[u(x)=(G * f)(x) =\int_{\mathbb R^d} G(x-y) f(y) dy\]
#+LATEX: \end{hidden}
What can we learn from this?
#+LATEX: \begin{hidden}
Solutions to the Laplace equation are globally coupled. The value of $f$
at any point influences the solution /everywhere/ (if only a little)
#+LATEX: \end{hidden}

*** Elliptic PDEs: Justifying the Singular Solution

\[u(x)=(G * f)(x) =\int_{\mathbb R^d} G(x-y) f(y) dy\]
Why?
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
\laplace u(x)&=(\laplace G * f)(x) =\int_{\mathbb R^d} (\laplace G(x-y)) f(y) dy\\
&=\int_{\mathbb R^d} \delta(x-y) f(y) dy=f(x)
\end{align*}
#+LATEX: \end{hidden}
*** Parabolic PDE: Heat Equation $\cdot$ Separation of Variables

\vspace*{-3ex}
\begin{align*}
  u_t &=u_{xx} \qquad ((x,t)\in [0,1]\times[0,T])\\
  u(x,0)&=g(x)\qquad (x\in [0,1])\\
  u(0,t)= u(1,t) &= 0\qquad(t\in[0,T])
\end{align*}
#+LATEX: \begin{hidden}
Looking for $u (x, t) = v (t) \cdot w (x)$.

Plug into PDE: $v' (t) \cdot w (x) = v (t) \cdot w'' (x)$. Divide:
\[ \frac{v' (t)}{v (t)} = C = \frac{w'' (x)}{w (x)}, \]
where $C$ is constant since it is independent of $x$ and $t$.

- $w'' = Cw$ with BCs yields $w (x) = \alpha \cdot \sin (m \pi x)$ and $C = -
  m^2 \pi^2$ or any linear combination; Fourier to match
  $g$.

- Focus on specific value of $m$: $v' = Cv$ with ICs yields $v (t) = \exp (-m^2 \pi^2 t)$.
#+LATEX: \end{hidden}
*** Parabolic PDE: Solution Behavior

\demolink{intro}{Parabolic PDE}
What can we learn from analytic and numerical solution?
#+LATEX: \begin{hidden}
- Heat equation `washes out' the solution
- Appears to obey a maximum principle
- Appears to smooth the data
#+LATEX: \end{hidden}

*** Hyperbolic PDE: Wave Equation

\begin{align*}
  u_{tt} &=c^2 u_{xx} \qquad ((x,t)\in \mathbb R\times[0,T])\\
  u(x,0)&=g(x)\qquad (x\in \mathbb R)
\end{align*}
with $g(x)=\sin(\pi x)$.

\medskip
Is this problem well-posed?
#+LATEX: \begin{hidden}
No, missing initial condition on $u_t$.
\[u_t(x,0)=0\qquad (x\in \mathbb R)\]
#+LATEX: \end{hidden}

Can be rewritten in *conservation law* form:
#+LATEX: \begin{hidden}
\[q_t(x) + \nabla\cdot F(q(x)) = s(x)\]
#+LATEX: \end{hidden}

*** Hyperbolic Conservation Laws

\[\b q_t(\b x,t) + \nabla\cdot \b F(\b q(\b x,t)) = \b s(\b x)\]
Why is this called a (system of) conservation law(s)?
#+LATEX: \begin{hidden}
- Balance between a conserved quantity $\b q$ and a flux $\b F$.
  - Integrate, consider divergence theorem (for $n=1$)
- Flux prescribes the `flow direction'. When is flux divergence $<0$?
- $s$ is a source term.
#+LATEX: \end{hidden}
$F: ?\to ?$
#+LATEX: \begin{hidden}
- $\b q(\b x,t) \in \mathbb R^n$
- $\b F: \mathbb R^n \to\mathbb R^n\times \mathbb R^d$
#+LATEX: \end{hidden}

*** Wave Equation as a Conservation Law
Rewrite the wave equation in conservation law form:
#+LATEX: \begin{hidden}
Introduce a new variable $v$ and let
\begin{align*}
  u_t &= c v_x\\
  v_t &= c u_x.
\end{align*}
Observe $u_{tt}=c v_{xt}=c^2 u_{xx}$. Define $\b q:=\begin{bmatrix}u & v\end{bmatrix}^T$.
#+LATEX: \end{hidden}

*** Solving Conservation Laws
Solve
\begin{align*}
  u_t &= c v_x\\
  v_t &= c u_x.
\end{align*}

#+LATEX: \begin{hidden}
\[\b q_t +\begin{bmatrix} 0&-c \\ -c & 0\end{bmatrix} \b q_x = \b q_t + A\b q_x =\b 0\]
Diagonalize: Define \(\b{\tilde q}:= V^{-1} \b q\),
\[\b{\tilde q}_t + V^{-1}A V\b{\tilde q}_x =\b{\tilde q}_t +\begin{bmatrix} c&0 \\ 0 & -c\end{bmatrix} \b{\tilde q}_x = 0\]
$\rightarrow$ two advection equations

\medskip
Solution, for some $\phi_\ell$, $\phi_r$: \(u(t,x) = \phi_\ell(x+ct) + \phi_r(x-ct)\)
#+LATEX: \end{hidden}

\demolink{intro}{Hyperbolic PDE}

*** Hyperbolic: Solution Properties

Properties of the solution for hyperbolic equations:
#+LATEX: \begin{hidden}
- Has /conserved quantities/
- $q$, ``energy'' (\(\rightarrow\) HW1)
- Maintains smoothness of IC
- Typical trick: Project to one dimension, diagonalize, understand advection behavior.
#+LATEX: \end{hidden}
** Preliminaries: Differencing
*** Interpolation and Vandermonde Matrices

#+LATEX: \begin{hidden}
Limit the set of functions to a linear
combination from an /interpolation basis/ \(\varphi _i\).\medskip
\[f (x) = \sum _{j = 0}^{N_{\tmop{func}}} \alpha _j \varphi _j (x)_{} \]
Interpolation becomes solving the linear system:
\[y_i = f (x_i) = \sum _{j = 0}^{N_{\tmop{func}}} \alpha _j
   \underbrace{\varphi _j (x_i)}_{V_{i j}} \qquad \leftrightarrow \qquad V
   \b{\alpha } = \b{y} . \]
Want unique answer: Pick \(N_{\tmop{func}} = N\) \(\rightarrow\) \(V\)
square.

\(V\) is called the /(generalized) Vandermonde matrix/.\medskip

\[V \left ( \text{coefficients} \right ) = \left ( \text{values at nodes}
   \right ) . \]
#+LATEX: \end{hidden}
*** Numerical Differentiation: How?

How can we take derivatives numerically?

#+LATEX: \begin{hidden}
Let $\b x = (x_i)_{i = 1}^n$ be nodes and $(\varphi_i)_{i = 1}^n$ an interpolation basis.

Find interpolation coefficients $\b{\alpha}= (\alpha_i)_{i = 1}^n = V^{- 1} f (\b{x})$. Then
\[
  f (\xi) \approx p_{n - 1} (\xi) = \sum_{i = 1}^n \alpha_i \varphi_i (\xi).
\]
Then, simply take a derivative:
\[
  f' (\xi) \approx p_{n - 1}' (\xi) = \sum_{i = 1}^n \alpha_i \varphi_i' (\xi) .
\]
$\varphi_i'$ are known because the interpolation basis $\varphi_i$ is known!
#+LATEX: \end{hidden}

\demolink{intro}{Taking Derivatives with Vandermonde Matrices}

*** Finite Differences Numerically
\demolink{intro}{Finite Differences}

\demolink{intro}{Finite Differences vs Noise}

\demolink{intro}{Floating point vs Finite Differences}
*** Taking Derivatives Numerically

Why /shouldn't/ you take derivatives numerically?
#+LATEX: \begin{hidden}
- `Unbounded'

    A function with small \(\norm{f}_\infty\) can have arbitrarily large
    \(\norm{f'}_\infty\)

- Amplifies noise

    Imagine a smooth function perturbed by small, high-frequency wiggles

- Subject to cancellation error

- Inherently less accurate than integration

  - Interpolation: \(h^n\)

  - Quadrature: \(h^{n + 1}\)

  - Differentiation: \(h^{n - 1}\)

    (where \(n\) is the number of points)
#+LATEX: \end{hidden}

*** Differencing Order of Accuracy Using Taylor

Find the order of accuracy of the finite difference formula $f' (x) \approx [f (x + h) - f (x - h)] / 2 h$.
#+LATEX: \begin{hidden}
\begin{align*}
    & f' (x) - \frac{f (x + h) - f (x - h)}{2 h}\\
   = & f' (x) - \frac{1}{2 h} \left[ f (x) + hf' (x) + \frac{h^2}{2} f'' (x)
  + \frac{h^3}{6} f''' (x) + O (h^4) \right]\\
    & + \frac{1}{2 h} \left[ f (x) - hf' (x) + \frac{h^2}{2} f'' (x) -
  \frac{h^3}{6} f''' (x) + O (h^4) \right]\\
   = & \frac{1}{2 h} \cdot \frac{h^3}{6} f''' (x) \quad \text{as $h
  \rightarrow 0$} .
\end{align*}
#+LATEX: \end{hidden}
** Interpolation Error Estimates (reference)
*** Truncation Error in Interpolation

If \(f\) is \(n\) times continuously differentiable on a closed
interval \(I\) and \(p_{n-1} (x)\)  is a
polynomial of degree at most $n$ that interpolates $f$ at $n$ distinct
points \(\{x_i\}\) ($i=1,...,n$) in that interval, then for each $x$ in the
interval there exists $\xi$ in that interval such that

\[f (x) - p_{n - 1} (x) = \frac{f^{(n)} (\xi )}{n!} (x - x_1) (x - x_2) \cdots
   (x - x_n). \]

#+LATEX: \begin{hidden}
Set the error term to be \(R(x) := f(x) - p_{n-1}(x) \)
and set up an auxiliary function:
\[Y_x(t) = R(t) - \frac{R(x)}{W(x)} W(t)\quad\text{where}\quad W(t) = \prod_{i=1}^n (t-x_i).\]
Note also the introduction of $t$ as an additional variable, independent
of the point $x$ where we hope to prove the identity.
#+LATEX: \end{hidden}

*** Truncation Error in Interpolation: cont'd.
\[Y_x(t) = R(t) - \frac{R(x)}{W(x)} W(t)\quad\text{where}\quad W(t) = \prod_{i=1}^n (t-x_i)\]
#+LATEX: \begin{hidden}
- Since \(x_i\) are roots of $R(t)$ and $W(t)$, we have
  \(Y_x(x)=Y_x(x_i)=0\), which means $Y_x$ has at least $n+1$ roots.
- From Rolle's theorem, $Y_x'(t)$ has at least $n$ roots, then $Y_x^{(n)}$ has at
  least one root $\xi$, where $\xi\in I$.
- Since \(p_{n-1}(x)\) is a polynomial of degree at most $n-1$, \(R^{(n)}(t) = f^{(n)}(t)\).
  Thus
  \[ Y_x^{(n)}(t) = f^{(n)}(t) - \frac{R(x)}{W(x)} n!. \]
- Plugging $Y_x^{(n)}(\xi)=0$ into the above yields the result.
#+LATEX: \end{hidden}

*** Error Result: Connection to Chebyshev

What is the connection between the error result and Chebyshev interpolation?
#+LATEX: \begin{hidden}
- The error bound suggests choosing the interpolation nodes such that the product
  \(\abs{\prod_{i=1}^n (x-x_i)}\) is as small as possible. The Chebyshev nodes achieve this.

- If nodes are edge-clustered, $\prod_{i=1}^n (x-x_i)$
  clamps down the (otherwise quickly-growing) error there.
- Confusing: /Chebyshev approximating polynomial/ (or "polynomial best-approximation").
  *Not* the Chebyshev interpolant.
- Chebyshev nodes also do *not* minimize the Lebesgue constant.
#+LATEX: \end{hidden}

*** Error Result: Simplified Form

Boil the error result down to a simpler form.
#+LATEX: \begin{hidden}
Assume
\(x_1 < \cdots < x_n\).

- \(\abs{f^{(n)} (x)} \le M\) for \(x \in [x_{1,} x_n]\),

- Set the interval length \(h = x_n - x_1\).

    Then \(| x - x_i | \le h \).

Altogether--there is a constant \(C\) independent of \(h\) so that:
\[\max _x \abs{f (x) - p_{n - 1} (x)} \le CMh^n . \]
For the grid spacing \(h \rightarrow 0\), we have
\(E (h) = O (h^n)\).
This is called /convergence of order \(n\)/.
#+LATEX: \end{hidden}

- \demolink{intro}{Interpolation Error}

* Finite Difference Methods for Time-Dependent Problems
  :PROPERTIES:
  :RELATE_TREE_SECTION_NAME: fd-tdep
  :RELATE_TREE_SECTION_OPENED: true
  :END:

** 1D Advection
*** 1D Advection Equation and Characteristics

\[u_t+a u_x=0, \quad u(0,x)=g(x)\qquad (x\in\mathbb R)\]
Solution?
#+LATEX: \begin{hidden}
Generalize to 1D conservation law: \(u_t+f(u)_x=0\). Find solution.

*Characteristic Curve:* Define a function $x (t)$ so that $u(x(t),t)=u(x_0,0)$.
Suppose we consider $x$ defined by the IVP
\[ \left\{\begin{array}{l}
     \frac{\mathd x (t)}{\mathd t} = f' (u (x (t),t)),\\
     x (0) = x_0 .
   \end{array}\right.\]
Then
\begin{equation*} \frac{\mathd u (x (t), t)}{\mathd t} = u_x x' (t) + u_t = u_x f' (u (x (t),t)
   + u_t = f (u)_x + u_t = 0. \end{equation*}
So $u (x (t), t) = u (x (0), 0) = g(x_0)$.
#+LATEX: \end{hidden}
*** Solving Advection with Characteristics

\[u_t+a u_x=0, \quad u(0,x)=g(x)\qquad (x\in\mathbb R)\]
Find the characteristic curve for advection.
#+LATEX: \begin{hidden}
Here $x(t)=x_0+at$.
#+LATEX: \end{hidden}

Generalize this to a solution formula.
#+LATEX: \begin{hidden}
General solution of advection: $u(t,x)= g(x-at)$. $a$: *Advection speed*.
#+LATEX: \end{hidden}

Does the solution formula admit solutions that aren't obviously allowed by the PDE?
#+LATEX: \begin{hidden}
Solution formula allows nonsmooth profiles. Unclear: Those are not differentiable.

$\rightarrow$ Idea (later): weaken the notion of a derivative
#+LATEX: \end{hidden}

What is *upwind*, *downwind*?

*** Finite Difference for Hyperbolic: Idea

**** Grid figure
     :PROPERTIES:
     :BEAMER_col: 0.4
     :END:

\begin{tikzpicture}
  \def\dx{0.4}
  \def\dt{0.4}
  \foreach \ix in {-4,-3,...,4}
    \foreach \it in {0,1,...,4}
    {
      \fill (\dx*\ix, \dt*\it) circle (1pt);
    }
  \draw [thick,->] (-5*\dx,0) -- (5*\dx,0) node [anchor=west] {$x$};
  \draw [thick,->] (0,0) -- (0, 6*\dt)node [anchor=west] {$t$};
\end{tikzpicture}

**** Description
     :PROPERTIES:
     :BEAMER_col: 0.6
     :END:

\[\{(x_k, t_\ell): x_k = kh_x , t_\ell = \ell h_t\}\]
If $u(x,t)$ is the exact solution, want
\[u_{k,\ell}\approx u(x_k,t_\ell).\]

Condition at each grid point?
#+LATEX: \begin{hidden}
- Pick a derivative stencil for each derivative term in the PDE
- Get system of equations
- Solve
#+LATEX: \end{hidden}
What are explicit/implicit schemes?
#+LATEX: \begin{hidden}
Implicit require solution of a system of equations
#+LATEX: \end{hidden}

*** Designing Stencils
#+BEGIN_EXPORT latex
\def\dx{0.4}
\def\dt{0.4}
\def\bggrid{
  \foreach \ix in {-2,-1,...,2}
    \foreach \it in {0,1,2}
    { \fill [fill=black!20] (\dx*\ix, \dt*\it) circle (1pt); }
  \draw [draw=black!20,thick,->] (-2*\dx,0) -- (2*\dx,0) node [anchor=west] {$x$};
  \draw [draw=black!20,thick,->] (0,0) -- (0, 2*\dt)node [anchor=west] {$t$};
}
#+END_EXPORT

**** Stencils
     :PROPERTIES:
     :BEAMER_col: 0.2
     :END:

#+BEGIN_EXPORT latex
\small
ETCS:
\begin{hidden}\vspace{-1ex}
\begin{tikzpicture}[scale=0.7]
  \bggrid
  \foreach \ix/\it in {-1/0, 0/0, 1/0, 0/1}
  {
    \fill (\dx*\ix, \dt*\it) circle (2pt);
  }
\end{tikzpicture}\vspace{-1ex}
\end{hidden}


ITCS:
\begin{hidden}\vspace{-1ex}
\begin{tikzpicture}[scale=0.7]
  \bggrid
  \foreach \ix/\it in {-1/1, 0/1, 1/1, 0/0}
  {
    \fill (\dx*\ix, \dt*\it) circle (2pt);
  }
\end{tikzpicture}\vspace{-1ex}
\end{hidden}

ETFS:
\begin{hidden}\vspace{-1ex}
\begin{tikzpicture}[scale=0.7]
  \bggrid
  \foreach \ix/\it in {0/0, 1/0, 0/1}
    \fill (\dx*\ix, \dt*\it) circle (2pt);
\end{tikzpicture}\vspace{-1ex}
\end{hidden}

ETBS:
\begin{hidden}\vspace{-1ex}
\begin{tikzpicture}[scale=0.7]
  \bggrid
  \foreach \ix/\it in {-1/0, 0/0, 0/1}
    \fill (\dx*\ix, \dt*\it) circle (2pt);
\end{tikzpicture}\vspace{-1ex}
\end{hidden}


#+END_EXPORT

**** Commentary
     :PROPERTIES:
     :BEAMER_col: 0.75
     :END:

Terminology?
#+LATEX: \begin{hidden}
- **E** Explicit / **I** Implicit
- **T** Time / **S** Space
- **F** Forward: *right*
- **B** Backward: *left*
- **Upwind**: *left* if $a>0$
- **Downwind**: *right* if $a>0$
#+LATEX: \end{hidden}

Write out ITCS:
#+LATEX: \begin{hidden}
\[\frac{u_{k, \ell + 1} - u_{k, \ell}}{h_t} + a \frac{u_{k + 1, \ell + 1} - u_{k -
1, \ell + 1}}{2 h_x} = 0\]
#+LATEX: \end{hidden}

*** Crank-Nicolson

#+BEGIN_EXPORT latex
\def\dx{0.4}
\def\dt{0.4}
\def\bggrid{
  \foreach \ix in {-2,-1,...,2}
    \foreach \it in {0,1,2}
    { \fill [fill=black!20] (\dx*\ix, \dt*\it) circle (1pt); }
  \draw [draw=black!20,thick,->] (-2*\dx,0) -- (2*\dx,0) node [anchor=west] {$x$};
  \draw [draw=black!20,thick,->] (0,0) -- (0, 2*\dt)node [anchor=west] {$t$};
}
#+END_EXPORT
**** Stencils
     :PROPERTIES:
     :BEAMER_col: 0.25
     :END:


#+BEGIN_EXPORT latex
\begin{tikzpicture}
  \bggrid
  \foreach \ix/\it in {-1/0, 0/0, 1/0, -1/1, 0/1, 1/1}
    \fill (\dx*\ix, \dt*\it) circle (2pt);
\end{tikzpicture}

Crank-Nicolson

#+END_EXPORT

**** Commentary
     :PROPERTIES:
     :BEAMER_col: 0.75
     :END:
Write out Crank-Nicolson:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{multline*} \frac{u_{k, \ell + 1} - u_{k, \ell}}{h_t} \\+ \frac{a}{2} \left[ \frac{u_{k +
   1, \ell + 1} - u_{k - 1, \ell + 1}}{2 h_x} + \frac{u_{k + 1, \ell} - u_{k -
   1, \ell}}{2 h_x} \right] = 0 \end{multline*}
#+LATEX: \end{hidden}

*** Lax-Wendroff

#+BEGIN_EXPORT latex
\def\dx{0.4}
\def\dt{0.4}
\def\bggrid{
  \foreach \ix in {-2,-1,...,2}
    \foreach \it in {0,1,2}
    { \fill [fill=black!20] (\dx*\ix, \dt*\it) circle (1pt); }
  \draw [draw=black!20,thick,->] (-2*\dx,0) -- (2*\dx,0) node [anchor=west] {$x$};
  \draw [draw=black!20,thick,->] (0,0) -- (0, 2*\dt)node [anchor=west] {$t$};
}
#+END_EXPORT
**** Stencils
     :PROPERTIES:
     :BEAMER_col: 0.15
     :END:

#+BEGIN_EXPORT latex

\medskip
\begin{tikzpicture}
  \bggrid
  \foreach \ix/\it in {-1/0, 0/0, 1/0, 0/1}
  {
    \fill (\dx*\ix, \dt*\it) circle (2pt);
  }
\end{tikzpicture}

Lax-Wendroff
#+END_EXPORT

**** Commentary
     :PROPERTIES:
     :BEAMER_col: 0.85
     :END:

What's the core idea behind Lax-Wendroff?
#+LATEX: \begin{hidden}
- Write out a Taylor expansion in time
- Use the PDE to replace time $\partial$ with space $\partial$
- Allows two-level schemes of any order of accuracy
#+LATEX: \end{hidden}

Write out Lax-Wendroff.
#+LATEX: \begin{hidden}
\( u_t = - au_x \) so also \( u_{t t} = - a (u_x)_t = - a (u_t)_x = a^2 u_{x x} . \)
\begin{eqnarray*}
  & & u_{k, \ell + 1} - u_{k, \ell}
   \approx  h_t u_t (x_k, t_{\ell}) + \frac{h_t^2}{2} u_{t t} (x_k,
  t_{\ell})\\
  & = & - h_t au_x (x_k, t_{\ell}) + \frac{h_t^2}{2} a^2 u_{x x} (x_k,
  t_{\ell})\\
  & \approx & -h_t a \frac{u_{k + 1, \ell} - u_{k - 1, \ell}}{2 h_x} +
  \frac{h_t^2 a^2}{2} \cdot \frac{u_{k + 1, \ell} - 2 u_{k, \ell} + u_{k - 1,
  \ell}}{h_x^2}
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Exploring Advection Schemes

\demolink{fd-tdep}{Methods for 1D Advection}

\medskip
- Which of the schemes "work"?
- Any restrictions worth noting?

** Stability and Convergence
*** A Matrix View of Two-Level Stencil Schemes

**** Num solution notation
     :PROPERTIES:
     :BEAMER_col: 0.5
     :END:
Numerical solution vectors:
\[\b v_\ell=\begin{bmatrix} u_{1,\ell}\\ \vdots\\ u_{N_x,\ell}\end{bmatrix},
\quad
\b v=\begin{bmatrix} \b v_1\\ \vdots\\ \b v_{N_t}\end{bmatrix}.\]

**** True solution notation
     :PROPERTIES:
     :BEAMER_col: 0.5
     :END:

True solution vectors:
\[\b u_\ell=\begin{bmatrix} u(x_1,t_\ell)\\ \vdots \\ u(x_{N_x},t_\ell)\end{bmatrix}\,
\quad
\b u=\begin{bmatrix} \b u_1\\ \vdots \\ \b u_{N_t}\end{bmatrix}.\]
**** Schemes
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

***** Two-Level Finite Difference Scheme
      :PROPERTIES:
      :BEAMER_env: definition
      :END:

A finite difference scheme that can be written as
#+LATEX: \begin{hidden}
\[P_h \b {v}_{\ell+1} = Q_h \b v_\ell+h_t \b b_\ell\]
#+LATEX: \end{hidden}
is called a *two-level linear finite difference scheme*.

***** End def
      :PROPERTIES:
      :BEAMER_env: ignoreheading
      :END:

#+LATEX: \begin{hidden}
- Mostly $\b b_\ell=0$, i.e. homogeneous schemes, no source terms.
- $P_h$ and $Q_h$ may depend on both $h_x$ and $h_t$.
- $P_h$ and $Q_h$ and the spatial grid may also be infinite.
#+LATEX: \end{hidden}

*** Rewriting Schemes in Matrix Form (1/2)
\[P_h \b {v}_{\ell+1} = Q_h \b v_\ell+h_t \b b_\ell\]

Find $P_h$ and $Q_h$ for ETCS:
#+LATEX: \begin{hidden}
ETCS:
\begin{equation*}
   \frac{u_{k, \ell + 1} - u_{k, \ell}}{h_t} + a \frac{u_{k + 1, \ell} - u_{k
   - 1, \ell}}{2 h_x} = 0.
\end{equation*}
Equivalently:
\begin{equation*}
   u_{k, \ell + 1} = u_{k, \ell} + \frac{ah_t}{2 h_x} (- u_{k + 1, \ell} +
   u_{k - 1, \ell}).
\end{equation*}
So
\[P_h=I, \qquad Q_h = \tmop{tridiag} \left( \frac{ah_t}{2 h_x}, 1, -\frac{ah_t}{2 h_x}
\right).\]

#+LATEX: \end{hidden}

*** Rewriting Schemes in Matrix Form (2/2)

Find $P_h$ and $Q_h$ for Crank-Nicolson:
#+LATEX: \begin{hidden}

\[
P_h = \tmop{tridiag} \left( -\frac{ah_t}{4 h_x}, 1, \frac{ah_t}{4 h_x}\right),
\]
and
\[
Q_h = \tmop{tridiag} \left( \frac{ah_t}{4 h_x}, 1, -\frac{ah_t}{4 h_x}\right).
\]
#+LATEX: \end{hidden}

*** Truncation Error
**** Truncation Error
      :PROPERTIES:
      :BEAMER_env: definition
      :END:

#+LATEX: \begin{hidden}
The *local truncation error* $\tau_{k,\ell}$ is the error that remains when a finite difference method
is applied to a smooth exact solution $u$ at $(x_k,t_\ell)$.
#+LATEX: \end{hidden}
**** End
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

\demolink{fd-tdep}{Truncation Error Analysis via sympy}

*** Error and Error Propagation
Express definition of truncation error in our two-level framework:
#+LATEX: \begin{hidden}
\[ P_h \b{u}_{\ell + 1} = Q_h \b{u}_{\ell} +
\underbrace{\b{\tau}_{\ell}}_{\text{Trunc.Err.}} h_t . \]
#+LATEX: \end{hidden}

Define $\b{e}_{\ell} =\b{u}_{\ell} -\b{v}_\ell$. Understand
the error as accumulation of truncation error:
#+LATEX: \begin{hidden}
Recall \(P_h \b{v}_{\ell + 1} = Q_h \b{v}_{\ell}\).
Subtract from the truncation error definition to find:
\begin{eqnarray*}
  \b{e}_0 & = & \b{0}\\
  P_h \b{e}_{\ell + 1} & = & Q_h \b{e}_{\ell} +
  \b{\tau}_{\ell} h_t\\
  \b{e}_{\ell + 1} & = & P_h^{- 1} Q_h \b{e}_l + P_h^{- 1}
  \b{\tau}_{\ell} h_t .
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Discrete and Continuous Norms

To measure properties of numerical solutions we need *norms*. Define a discrete $L^\infty$ norm.
#+LATEX: \begin{hidden}
\[ \norm{\b{e}}_{\infty} = \max_{k, \ell} | e_{k, \ell} | .
\]
#+LATEX: \end{hidden}

Define a discrete $L^2$ norm.
#+LATEX: \begin{hidden}
\vspace*{-2ex}
\[ \norm{\b{e}}_2 = \sqrt{\sum_{k, \ell} e_{k, \ell}^2 h_x h_t} .
\qquad\text{Unless otherwise given: } \norm{\cdot} =\norm{\cdot}_2. \]
#+LATEX: \end{hidden}

Important features:
#+LATEX: \begin{hidden}
- Value of discrete norm should not change wildly if $h_x$ and $h_t$
  change (and, along with them, the number of nodes).
- Ideal: approximate a continuous norm.
#+LATEX: \end{hidden}

*** Consistency and Convergence

Assume $u, (\partial_x^{q_x}) u, (\partial_t^{q_t}) u \in L^2 (\mathbb{R}
\times [0, t^{\ast}])$.

**** Consistency
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
A two-level scheme is *consistent* in the \(L^2\)-norm with order $q_t$ in time and $q_x$ in space if
#+LATEX: \begin{hidden}
\[ \max_{\ell, \ell h_t \le t^{\ast}} \norm{\b{\tau}_{\ell}} = O
   (h_x^{q_x} + h_t^{q_t}) \qquad \text{as $(h_x, h_t) \rightarrow (0, 0)$}.\]
#+LATEX: \end{hidden}

**** Convergence
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
A two-level scheme is *convergent* in the \(L^2\)-norm with order $q_t$ in time and $q_x$ in space if
#+LATEX: \begin{hidden}
\[ \max_{\ell, \ell h_t \le t^{\ast}} \norm{\b{e}_{\ell}} = O
   (h_x^{q_x} + h_t^{q_t}) \qquad \text{as $(h_x, h_t) \rightarrow (0, 0)$}.\]

#+LATEX: \end{hidden}

**** End
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

Is consistency sufficient for convergence?

*** Analyzing ETFS (1/2)


\[ \frac{u_{k, \ell + 1} - u_{k, \ell}}{h_t} + a \frac{u_{k + 1, \ell} - u_{k,
   \ell}}{h_x} = 0 \]

Let's understand more precisely what happens for this scheme. Assume $a>0$.
#+LATEX: \begin{hidden}
Rewrite as
\[ u_{k, \ell + 1} = u_{k, \ell} - \frac{ah_t}{h_x} (u_{k + 1, \ell} - u_{k,
   \ell}) = (1 + \lambda) u_{k, \ell} - \lambda u_{k + 1, \ell} \]
for $\lambda = ah_t / h_x$.
#+LATEX: \end{hidden}

*** Analyzing ETFS (2/2)

\[ u_{k, \ell + 1} = (1 + \lambda) u_{k, \ell} - \lambda u_{k + 1, \ell} \]

Consider $u (x, 0) = \b{1}_{[- 1, 0]} (x)$. Predict solution behavior.

#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  u_{0, 0} = 1 &  & u_{1 \ldots, 0} = 0\\
  u_{0, 1} = (1 + \lambda) &  & u_{1 \ldots, 1} = 0\\
  u_{0, 2} = (1 + \lambda)^2 &  & u_{1 \ldots, 2} = 0
\end{eqnarray*}
So the right half never ``sees'' the traveling bump; this can't be convergent.
Meanwhile,
\[ u (0, t) \approx u_{0, t / h_t}
  = \left( 1 + \frac{ah_t}{h_x} \right)^{t / h_t}
  = \left( 1 + \frac{a t / h_x}{t / h_t} \right)^{t / h_t}
  \stackrel{h_t\to0}\to \exp \left(\frac{at}{h_x} \right) \]
#+LATEX: \end{hidden}
\demolink{fd-tdep}{Methods for 1D Advection} (Revisit ETFS)
*** Stability

\[P_h \b {v}_{\ell+1} = Q_h \b v_\ell\]

Write down a matrix product to bring $\b v_0$ to $\b v_\ell$:
#+LATEX: \begin{hidden}
\[\b v_\ell= (P^{- 1}_h Q_h)^{\ell} \b v_0\]
#+LATEX: \end{hidden}

**** Stability
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
A two-level scheme is *stable* in the \(L^2\)-norm if there exists a constant $c > 0$ independent of
$h_t$ and $h_x$ so that
\[ \norm{(P^{- 1}_h Q_h)^{\ell} P_h^{- 1}} \le c \]
for all $\ell$ and $h_t$ such that $\ell h_t \le t^{\ast}$.

*** Lax Convergence Theorem

**** Lax Convergence
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

If a two-level FD scheme is
- *consistent* in the \(L^2\)-norm with order $q_t$ in time and $q_x$ in space, and
- *stable* in the \(L^2\)-norm, then
it is
*convergent* in the \(L^2\)-norm with order $q_t$ in time and $q_x$ in space.
**** End
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
- A stronger result holds: The above is actually ``if and only if''.

  (called the *Lax Equivalence Theorem* or *Lax-Richtmyer Theorem*)

- Think of this as an important `meta-theorem' of numerical analysis (or ``fundamental theorem of NA"):
  \[
    \text{Consistent} + \text{Stable} \Rightarrow \text{Convergent}
  \]
- A related result holds for ODEs, due to Dahlquist.
#+LATEX: \end{hidden}

*** Lax Convergence: Proof (1/2)
#+LATEX: \begin{hidden}
Recall error propagation:
\[P_h \b{e}_{\ell + 1} = Q_h \b{e}_{\ell} + \b{\tau}_{\ell} h_t\]
So:
\[\b{e}_{\ell + 1} = P_h^{- 1} Q_h \b{e}_l + P_h^{- 1} \b{\tau}_{\ell} h_t.\]
Since \(\b e_0=0\),
\begin{eqnarray*}
  \b{e}_1 & = & h_t P_h^{- 1} \b{\tau}_0,\\
  \b{e}_2 & = & h_t (P_h^{- 1} Q_h) P_h^{- 1} \b{\tau}_0 + h_t
  P_h^{- 1} \b{\tau}_1 .
\end{eqnarray*}
By induction,
\[ \b{e}_{\ell} = h_t \sum_{m = 1}^{\ell} (P_h^{- 1} Q_h)^{\ell - m}
   P_h^{- 1} \b{\tau}_{m - 1} . \]
#+LATEX: \end{hidden}

*** Lax Convergence: Proof (2/2)
\[ \b{e}_{\ell} = h_t \sum_{m = 1}^{\ell} (P_h^{- 1} Q_h)^{\ell - m}
   P_h^{- 1} \b{\tau}_{m - 1} . \]
#+LATEX: \begin{hidden}
Let $\ell h_t \le t^{\ast}$. Taking the norm of both sides,
\begin{eqnarray*}
  \norm{\b{e}_{\ell}} & \le & h_t \sum_{m = 1}^{\ell}
  \norm{(P_h^{- 1} Q_h)^{\ell - m} P_h^{- 1} \b{\tau}_{m - 1}}\\
  & \le & h_t \sum_{m = 1}^{\ell} \underbrace{\norm{(P_h^{- 1}
  Q_h)^{\ell - m} P_h^{- 1} \b{}}}_{\le c \text{ (stab.)}}
  \norm{\b{\tau}_{m - 1}}\\
  & \le & h_t \ell c \cdot \max_{\ell : \ell h_t \le t^{\ast}} \norm{\b{\tau}_\ell}
  \le ct^{\ast} \max_{\ell : \ell h_t \le t^{\ast}} \norm{\b{\tau}_\ell} \\
  &\overset{\text{cons.}}{=}& O (h_x^{q_x} + h_t^{q_t}) .
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Conditions for Stability

\[ \norm{(P^{- 1}_h Q_h)^{\ell} P_h^{- 1}} \le c \]

Give a simpler, sufficient condition:
#+LATEX: \begin{hidden}
\[ \norm{P^{- 1}_h Q_h}\leq 1,\qquad  \norm{P_h^{- 1}} \le c. \]
Also called *Lax-Richtmyer stability*.
#+LATEX: \end{hidden}

How can we show bounds on these matrix norms?
#+LATEX: \begin{hidden}
- Observe: bounds have to hold for all $h_t$ and $h_x$.
- Generally: cumbersome.
- Possibly easiest: approach via singular values.
- Bound singular values: For example using Gershgorin.
#+LATEX: \end{hidden}

*** Stability of ETBS (1/3)

**** Gershgorin
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

For a matrix $A \in \mathbb{C}^{N \times N} = (a_{i, j})$,
\[ \sigma (A) \subset \bigcup_{j = 1}^N \bar{B} \left( a_{j, j}, \sum_{k \neq
   j} \abs{a_{j, k}} \right) . \]

**** End
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
ETBS:
\[ \frac{u_{k, \ell + 1} - u_{k, l}}{h_t} + a \frac{u_{k, \ell} - u_{k - 1,
   \ell}}{h_x} = 0 \]

Analyze stability of ETBS:
#+LATEX: \begin{hidden}
Let $\lambda = ah_t / h_x$. Then
\( u_{k, \ell + 1} = \lambda u_{k - 1, \ell} + (1 - \lambda) u_{k, \ell}\).

So $P_h = I$ and $Q_h = \tmop{tridiag} (\lambda, 1 - \lambda, 0)$.
$\norm{P_h^{- 1}} \le 1$ trivially.
#+LATEX: \end{hidden}
*** Stability of ETBS (2/3)

$P_h = I$ and $Q_h = \tmop{tridiag} (\lambda, 1 - \lambda, 0)$.
#+LATEX: \begin{hidden}


\[ \norm{Q_h} = \sqrt{\rho (Q^T_h Q_h)}, \]
where $Q_h^T Q_h = \tmop{tridiag} (\lambda (1 - \lambda), (1 - \lambda)^2 +
\lambda^2, \lambda (1 - \lambda))$.
Assume $0 \le \lambda \le 1$ for now, then $\lambda (1 - \lambda) \ge 0$. Let $\Lambda\in\sigma(Q^T_h Q_h)$.
\begin{eqnarray*}
  2 \lambda^2 - 2 \lambda \le & \Lambda - (1 - \lambda)^2 - \lambda^2 & \le 2 \lambda - 2 \lambda^2,\\
  1 - 4 \lambda + 4 \lambda^2 \le & \Lambda & \le 1,\\
  0 \le (1 - 2 \lambda)^2 \le & \Lambda & \le 1.
\end{eqnarray*}
So $\abs{\Lambda} \le 1$, which implies $\norm{Q^T_h Q_h} \le 1$,
which means $\norm{Q_h} \le 1$.

If $\lambda > 1$, analogously:
# \begin{eqnarray*}
#   2 \lambda - 2 \lambda^2 \le & \Lambda - (1 - \lambda)^2 - \lambda^2 &
#   \le 2 \lambda^2 - 2 \lambda,\\
#   1 \le & \Lambda & \le 1 - 4 \lambda + 4 \lambda^2,\\
#   1 \le & \Lambda & \le (1 - 2 \lambda)^2 .
# \end{eqnarray*}
$\abs{\Lambda} \ge 1$, which implies $\norm{Q^T_h Q_h} \ge 1$,
which means $\norm{Q_h} \ge 1$.
#+LATEX: \end{hidden}

*** Stability of ETBS (3/3)

Summarize ETBS stability:

#+LATEX: \begin{hidden}
We learn that ETBS is stable if $0 \le \lambda \le 1$. Rewriting,
we obtain
\[ \frac{ah_t}{h_x} < 1 \quad \Leftrightarrow \quad h_t \le
   \frac{h_x}{a} . \]
This type of stability is called *conditional stability*, and the condition we
found a *Courant-Friedrichs-Lewy* (*CFL*) condition.
#+LATEX: \end{hidden}

Comments?
#+LATEX: \begin{hidden}
Way cumbersome to prove. Is there something easier that gives necessary/sufficient conditions?
#+LATEX: \end{hidden}

** Von Neumann Stability
*** Discrete (Space) Fourier Transform
Assume $\b{x}$ infinitely long. Define:
\[ \hat{\b{x}} (\theta) = \sum_{k\in\mathbb Z} x_k e^{- i \theta k} \]

When is this well-defined?
#+LATEX: \begin{hidden}
\[ \abs{\hat{\b{x}} (\theta)} = \abs{\sum_k x_k e^{- i \theta k}}
   \le \sum_k \abs{x_k}, \]
Well-defined if $\sum_k \abs{x_k}$ is absolutely convergent. ($\sum_k=\sum_{k\in\mathbb Z}$)
#+LATEX: \end{hidden}
*** Inverting the Fourier Transform

To recover $\b{x}$:
\[ x_k = \frac{1}{2 \pi} \int_{- \pi}^{\pi} \hat{\b{x}} (\theta) e^{i
   \theta k} d \theta . \]
Proof?
#+LATEX: \begin{hidden}
\[ \frac{1}{2 \pi} \int_{- \pi}^{\pi} \sum_j x_j e^{- i \theta j} e^{i
   \theta k} d \theta = \frac{1}{2 \pi} \sum_j x_j \int_{- \pi}^{\pi} e^{i
   \theta (k - j)} d \theta = \sum_j x_j \delta_{j, k} = x_k . \]
#+LATEX: \end{hidden}

*** Getting to $L^2$
- Fourier Transform well defined for $\b x\in \ell^1$.
- Problem: We care about $L^2$, not $\ell^1$.

**** Parseval
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:
If $\norm{\b{x}}_2 < \infty$, then
\[ \norm{\b{x}}_2^2 = \frac{1}{2 \pi} \int_{- \pi}^{\pi}
   \abs{\hat{\b{x}} (\theta)}^2 d \theta < \infty . \]
**** End
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
Impact?
#+LATEX: \begin{hidden}
Can extend definition of Fourier transform to $L^2$.
#+LATEX: \end{hidden}

*** Toeplitz Operators

**** Toeplitz Operator
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
An operator $T$ is a *Toeplitz operator* if $(T\b{x})_j = \sum_k x_k
p_{j - k}$. In this case, $\b{p}$ is called the *Toeplitz vector*.

**** Example: ETCS
Let $\lambda = ah_t / 2 h_x$. Then
\[ u_{k, \ell + 1} = \lambda u_{k - 1, \ell} + u_{k, \ell} - \lambda u_{k + 1,
   \ell}.\]
**** End
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
Is ETCS Toeplitz?

*** Is ETCS Toeplitz?

\((P_h \b{u}_{\ell + 1})_j = u_{j, \ell + 1} \overset{!}{=} \sum_k u_{k, \ell + 1} p_{j - k}\)
#+LATEX: \begin{hidden}
\begin{equation*}
   p_{j - k} = \begin{cases}
     1 & k = j,\\
     0 & \text{otherwise} .
   \end{cases} \qquad p_m = \delta_{0, m}.
\end{equation*}
#+LATEX: \end{hidden}
\((Q_h \b{u}_{\ell})_j = \lambda u_{j - 1, \ell} + u_{j, \ell} - \lambda u_{j + 1, \ell} \overset{!}{=} \sum_k u_{k, \ell} q_{j - k}\)
#+LATEX: \begin{hidden}
\begin{equation*}
   q_{j - k} = \begin{cases}
     \lambda & k = j - 1,\\
     1 & k = j,\\
     - \lambda & k = j + 1,\\
     0 & \text{otherwise} .
   \end{cases} \qquad q_m = \begin{cases}
     \lambda & m = 1,\\
     1 & m = 0,\\
     - \lambda & m = - 1,\\
     0 & \text{otherwise} .
   \end{cases}
\end{equation*}
Both $P_h$ and $Q_h$ are Toeplitz.
#+LATEX: \end{hidden}

*** Fourier Transforms of Toeplitz Operators (1/3)

\[ y_j = \sum_k x_k p_{j - k} \]
#+LATEX: \begin{hidden}
\begin{eqnarray*}
  \hat{\b{y}} (\theta) & = & \sum_j \sum_k x_k p_{j - k} e^{- i \theta
  j}\\
  & = & \sum_j \sum_k \left( \frac{1}{2 \pi} \int_{- \pi}^{\pi} \hat{\b{x}} (\varphi) e^{i \varphi k} d \varphi \right) p_{j - k} e^{- i \theta j}\\
  & = & \frac{1}{2 \pi} \int_{- \pi}^{\pi} \hat{\b{x}} (\varphi) \sum_j \sum_k e^{i \varphi k} p_{j - k} e^{- i \theta j} d \varphi\\
  & = & \frac{1}{2 \pi} \int_{- \pi}^{\pi} \hat{\b{x}} (\varphi) \sum_j \left( \sum_k e^{i \varphi (k - j)} p_{j - k} \right) e^{i (\varphi - \theta) j} d \varphi .
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Fourier Transforms of Toeplitz Operators (2/3)

\begin{equation*}
  \hat{\b{y}} (\theta) = \frac{1}{2 \pi} \int_{- \pi}^{\pi} \hat{\b{x}} (\varphi) \sum_j \left( \sum_k e^{i \varphi (k - j)} p_{j - k} \right) e^{i (\varphi - \theta) j} d \varphi .
\end{equation*}
#+LATEX: \begin{hidden}


Consider
\[ \sum_k e^{i \varphi (k - j)} p_{j - k} = \sum_k e^{- i \varphi (j - k)}
   p_{j - k} \overset{\ell = j - k}{=} \hat{\b{p}} (\varphi).\]
So
\begin{equation*}
   \hat{\b{y}} (\theta) = \int_{- \pi}^{\pi} \hat{\b{x}} (\varphi) \hat{\b{p}} (\varphi) \frac{1}{2 \pi} \sum_j e^{i (\varphi - \theta) j} d \varphi.
\end{equation*}
#+LATEX: \end{hidden}

*** Fourier Transforms of Toeplitz Operators (3/3)

\begin{equation*}
   \hat{\b{y}} (\theta) = \int_{- \pi}^{\pi} \hat{\b{x}} (\varphi) \hat{\b{p}} (\varphi) \frac{1}{2 \pi} \sum_j e^{i (\varphi - \theta) j} d \varphi.
\end{equation*}

#+LATEX: \begin{hidden}
Define $w_j = (1 / 2 \pi) e^{i \varphi j}$. Then
\( \hat{\b{w}} (\theta) = \frac{1}{2 \pi} \sum_k e^{i (\varphi -
   \theta) k}.\)
So
\[ \hat{\b{y}} (\theta) = \int_{- \pi}^{\pi} \hat{\b{x}} (\varphi) \hat{\b{p}} (\varphi) \hat{\b{w}} (\theta) d \varphi.\]
To determine $\hat{\b{w}} (\theta)$, consider
\[ (1 / 2 \pi) e^{i \varphi j} = w_j = \frac{1}{2 \pi} \int_{- \pi}^{\pi}
   \hat{\b{w}} (\theta) e^{i \theta j} d \theta .\]
Observe that (by uniqueness of the FT) $\hat{\b{w}} (\theta) = \delta (\varphi - \theta)$ would do the trick.
Therefore \(\hat{\b{y}} (\theta) = \hat{\b{x}} (\theta) \hat{\b{p}} (\theta)\).
#+LATEX: \end{hidden}

*** Fourier Transforms of Inverse Toeplitz Operators

Recall \((P \b x)_j = \sum_k p_{j - k}x_k\).

\medskip
What is the Fourier transform $\hat {\b z}(\theta)$ of $P_h^{-1} \b x$?
#+LATEX: \begin{hidden}
- Inverse is also Toeplitz (by linearity and translation invariance).
- Fourier transform of $P_h P_h^{-1} \b x$ is $\hat{\b x}$ for any $\b x$.
- Therefore $\hat{\b p}(\theta)\hat{\b z}(\theta)=\hat{\b x}(\theta)$.
- By  uniqueness of Fourier t. (unproven): $\hat{\b z}(\theta)=\frac1{\hat{\b p}(\theta)}\hat{\b x}(\theta)$.
#+LATEX: \end{hidden}

Fourier transform $P_h^{- 1} Q_h \b{y}$?
#+LATEX: \begin{hidden}
\[ \frac{\hat{\b{q}} (\theta)}{\hat{\b{p}} (\theta)}
   \hat{\b{y}} (\theta).\]
#+LATEX: \end{hidden}

*** Bounding the Operator Norm

Bound \(\norm{P_h^{- 1} Q_h}_2^2\) using Fourier:
#+LATEX: \begin{hidden}
\vspace*{-3ex}
\begin{multline*}
  \norm{P_h^{- 1} Q_h}_2^2 
  = \sup_{\b{x} \neq \b{0}} \frac{\norm{P^{- 1}_h Q_h \b{x}}^2_2}{\norm{\b{x}}^2_2}
  = \sup_{\b{x} \neq \b{0}} \frac{\frac{h_x}{2 \pi} 
    \int_{- \pi}^{\pi} \abs{\frac{\hat{\b{q}} (\theta)}{\hat{\b{p}} (\theta)} \hat{\b{x}} (\theta)}^2 d \theta}{\frac{h_x}{2 \pi} \int_{- \pi}^{\pi} \abs{\hat{\b{x}} (\theta)}^2 d \theta}\\
  \le \sup_{\b{x} \neq \b{0}} \frac{\max_{\varphi \in [- \pi, \pi]} \abs{\frac{\hat{\b{q}} (\varphi)}{\hat{\b{p}} (\varphi)}}^2 \int_{- \pi}^{\pi} \abs{\hat{\b{x}} (\theta)}^2 d \theta}{\int_{- \pi}^{\pi} \abs{\hat{\b{x}} (\theta)}^2 d \theta}
  = \max_{\varphi \in [- \pi, \pi]} \abs{\frac{\hat{\b{q}} (\varphi)}{\hat{\b{p}} (\varphi)}}^2.
\end{multline*}

\[ \text{Similarly,}\qquad \norm{P_h^{- 1}}_2^2 \le \max_{\varphi \in [- \pi, \pi]} \abs{1/\hat{\b{p}} (\varphi)}^2 . \]
#+LATEX: \end{hidden}
Is the upper bound attained?
#+LATEX: \begin{hidden}
If $\hat{\b{x}} (\theta) = \delta (\theta - \varphi^{\ast})$, where
$\varphi^{\ast}$ maximizes $\abs{\hat{\b{q}} (\theta) /
\hat{\b{p}} (\theta)}$, then yes. (So $x_k = (1 / 2 \pi) e^{i
\varphi^{\ast} k}$.)
#+LATEX: \end{hidden}
*** von Neumann Stability

Two-level finite difference scheme
\[P_h \b {v}_{\ell+1} = Q_h \b v_\ell+h_t \b b_\ell,\]
where $P_h$ and $Q_h$ are Toeplitz operators with vectors $\b{p}$ and
$\b{q}$.

**** Symbol of a Two-Level Finite Difference Scheme
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

Let
\[ \hat{\b{p}} (\theta) = \sum_k p_k e^{- i \varphi k}, \qquad
   \hat{\b{q}} (\theta) = \sum_k q_k e^{- i \varphi k} . \]
Then the *symbol* of the two-level FD method is $s (\varphi) =
\hat{\b{q}} (\varphi) / \hat{\b{p}} (\theta)$.

**** Von Neumann Stability
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

If
\[ \max_{\varphi} \abs{s (\varphi)} \le 1, \qquad \max_{\varphi}
   \abs{\frac{1}{\hat{\b{p}} (\varphi)}} \le c \]
for some constant $c > 0$, we say the scheme is *von Neumann stable*.

*** Comparison with Lax-Richtmyer Stability

Need $\norm{(P^{- 1}_h Q_h)^{\ell} P_h^{- 1}} \le c$.

#+LATEX: \begin{hidden}
Implied by von Neumann stability.
#+LATEX: \end{hidden}

Why is bounding the symbol the most salient part?

#+LATEX: \begin{hidden}
If $\norm{P_h^{- 1} Q_h}\le 1$ encounters problems, there there often
also doesn't exist a $c$ so that $\norm{P_h^{- 1}} \le c$.
#+LATEX: \end{hidden}


Main restriction of von Neumann stability?
#+LATEX: \begin{hidden}
- Only works on infinite/periodic grids.

- Have BCs? Analysis gets more difficult.
#+LATEX: \end{hidden}
*** von Neumann Stability: ETBS (1/2)

ETBS: Let $\lambda = ah_t / h_x$.
\( u_{k, \ell + 1} = \lambda u_{k - 1 , \ell} + (1 - \lambda) u_{k, \ell} \).
#+LATEX: \begin{hidden}
\vspace{-2ex}
\[ P_h = I, \qquad Q_h = \tmop{tridiag} (\lambda, 1 - \lambda, 0).\]
Auxiliary result: Fourier transform of $r_k = \delta_{k, j}$.
\[ \hat{\b{r}} (\varphi) = \sum_k r_k e^{- i \varphi k} = \sum_k
   \delta_{k, j} e^{- i \varphi k} = e^{- i \varphi j} . \]
\((Q_h \b x)_j=\sum_k q_{j-k}x_k\), so\\
\((Q_h \b x)_0 = q_0 x_0+ x_{-1} q_1 + x_1 q_{-1}+\cdots\), so\\
\(\b q = (\dots,0,0, 1-\lambda, \lambda,0,\dots)\).
\[ \hat{\b{p}} (\varphi) = 1, \qquad \hat{\b{q}} (\varphi) =
   \lambda e^{- i \varphi} + (1 - \lambda) = 1 - \lambda (1 - e^{- i \varphi}).\]
\vspace{-6ex}
\begin{eqnarray*}
  \abs{s (\varphi)}^2 & = & \abs{\frac{\hat{\b{q}}
  (\varphi)}{\hat{\b{p}} (\varphi)}}^2 = (1 - \lambda (1 - e^{- i
  \varphi})) (1 - \lambda (1 - e^{i \varphi}))\\
  & = & \mathtt{} 1 + 2 (\lambda - \lambda^2) (\cos \varphi - 1) .
\end{eqnarray*}
#+LATEX: \end{hidden}

*** von Neumann Stability: ETBS (2/2)
Found: \(\abs{s (\varphi)}^2 =\mathtt{} 1 + 2 (\lambda - \lambda^2) (\cos \varphi - 1).\)
#+LATEX: \begin{hidden}
Maximize: take derivative w.r.t. $\varphi$, set to 0:
\[ \frac{d}{d \varphi} \left( \mathtt{} 1 + 2 (\lambda - \lambda^2) (\cos
   \varphi - 1) \right) = - 2 (\lambda - \lambda^2) \sin \varphi = 0 \]
if and only if $\varphi \in \mathbb{Z} \pi$.

For $m \in \mathbb{Z}$, $s (m
\pi) = 1 + 2 (\lambda - \lambda^2) ((- 1)^m - 1)$. For $m$ even, $s (m \pi) = 1$.

For $m$ odd,
\( s (m \pi) = 1 - 4 (\lambda - \lambda^2) = (1 - 2 \lambda)^2\).

Thus $| s (\varphi) |^2 \le 1$ if and only if
\[ \abs{1 - 2 \lambda} \le 1 \quad \Leftrightarrow \quad 0 \le
   \lambda \le 1 \quad \Leftrightarrow \quad 0 \le h_t \le
   \frac{h_x}{a} . \]
Found: conditionally von Neumann stable with CFL as before.
#+LATEX: \end{hidden}
*** von Neumann Stability: ETCS
Let $\lambda = ah_t / h_x$. Then
\[ u_{k, \ell + 1} = \frac{\lambda}{2} u_{k - 1, \ell} + u_{k, \ell} -
   \frac{\lambda}{2} u_{k + 1, \ell} . \]
#+LATEX: \begin{hidden}
\[ P_h = I, \qquad Q_h = \tmop{tridiag} (\lambda / 2, 1, - \lambda / 2) . \]
So $\hat{\b{p}} (\varphi) = 1$, and
\[ \hat{\b{q}} (\varphi) = \frac{\lambda}{2} e^{- i \varphi} + 1 -
   \frac{\lambda}{2} e^{- i \varphi (- 1)} = 1 - \lambda \sin (\varphi) i. \]
So
\[ \max_{\varphi} \abs{s (\varphi)}^2 = \max_{\varphi}
   \abs{\frac{\hat{\b{q}} (\varphi)}{\hat{\b{p}} (\varphi)}}^2 =
   1 + \lambda^2 \sin^2 (\varphi) \ge 1. \]
Not von Neumann stable $\Rightarrow$ not Lax-Richtmyer stable.
#+LATEX: \end{hidden}

*** von Neumann Stability: Crank-Nicolson

Let $\lambda = ah_t / (4 h_x)$
\[ - \lambda u_{k - 1, \ell + 1} + u_{k, \ell + 1} + \lambda u_{k + 1, \ell +
   1} = \lambda u_{k - 1, \ell} + u_{k, \ell} - \lambda u_{k + 1, \ell} . \]
#+LATEX: \begin{hidden}
\[ P_h = \tmop{tridiag} (- \lambda, 1, \lambda), \quad Q_h = \tmop{tridiag}
   (\lambda, 1, - \lambda) . \]
\begin{eqnarray*}
  \hat{\b{p}} (\varphi) & = & - \lambda e^{- i \varphi} + 1 + \lambda
  e^{i \varphi} = 1 + 2 \lambda i \sin (\varphi),\\
  \hat{\b{q}} (\varphi) & = & \lambda e^{- i \varphi} + 1 - \lambda
  e^{i \varphi} = 1 - 2 \lambda i \sin (\varphi) .
\end{eqnarray*}
\[ \abs{s (\varphi)}^2 = \frac{1 + 4 \sin^2 (\varphi)}{1 + 4 \sin^2 (\varphi)}
   = 1. \]
Crank-Nicolson is unconditionally von Neumann stable.
#+LATEX: \end{hidden}

** Dispersion and Dissipation
*** Studying Solutions of the PDE
*Saw numerically:* interesting dispersion/dissipation behavior.

*Want:* theoretical understanding.

\bigskip
Consider /linear/, /continuous/ (not yet discrete) differential operators
\begin{eqnarray*}
  L_1 u & = & u_t + au_x,\\
  L_2 u & = & u_t - Du_{\tmop{xx}} + au_x \qquad(D>0)\\
  L_3 u & = & u_t + au_x - \mu u_{x x x} .
\end{eqnarray*}
What could we use as a prototype solution?

*** A Prototype Solution of the PDE
Observation: all these operators are diagonalized by complex exponentials.
Come up with a `prototype complex exponential solution'.

#+LATEX: \begin{hidden}
Let $z (x, t) = z_0 e^{i (kx - \omega t)}$.
#+LATEX: \end{hidden}

What type of function is this?
#+LATEX: \begin{hidden}
- For $k$, $\omega$ real: traveling wave with speed $c = \omega / k$.

  $z (x - ct, 0) = z_0 e^{i (k (x - ct))} = z (x, t)$.
- For $k$ imaginary: an evanescent wave in $x$.
- For $\tmop{Im} \omega < 0$: a wave decaying in time.
#+LATEX: \end{hidden}
*** Wave-like Solutions of the PDE

\[z (x, t) = z_0 e^{i (kx - \omega t)}\]

$L_2 u = u_t - Du_{\tmop{xx}} + au_x$ ($D>0$). Plug in $z$.
#+LATEX: \begin{hidden}
$Lz = (- i \omega + iak + Dk^2)z$.
#+LATEX: \end{hidden}
Observations in connection with $L$?
#+LATEX: \begin{hidden}
- $Lz = \lambda (\omega, k) z$.
- $z (x, t)$ is a solution iff $Lz = 0$ iff $\lambda (\omega, k) = 0$.
#+LATEX: \end{hidden}

What is the *dispersion relation*?
#+LATEX: \begin{hidden}
The equation $\lambda (\omega, k) = 0$ is called the *dispersion relation* for
the PDE $L$.
#+LATEX: \end{hidden}

*** Picking Apart the Dispersion Relation

Consider $\omega (k) = \alpha (k) + i \beta (k)$. Rewrite the wave solution with this.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  z (x, t) & = & z_0 e^{i (kx - \omega(k) t)}\\
  & = & z_0 e^{i (kx - \alpha (k) t - i \beta (k) t)}\\
  & = & z_0 e^{\beta (k) t} e^{i (kx - \alpha (k) t)} .
\end{eqnarray*}
#+LATEX: \end{hidden}

How can we recognize dissipation?
#+LATEX: \begin{hidden}
If $\beta (k) < 0$, we call the PDE *dissipative*.
#+LATEX: \end{hidden}
What is the *phase speed*? How can we recognize *dispersion*?
#+LATEX: \begin{hidden}
- The *phase speed* of $z (x, t)$ is $v_{\tmop{ph}} = \alpha (k) / k$.
- If $v_{\tmop{ph}}$ is a constant ($\Leftrightarrow$ $\alpha (k)$ is linear in
  $k$), all waves move at the same speed.
- If that's not the case, we call the PDE *dispersive*.
#+LATEX: \end{hidden}

*** Dispersion Relation: Examples

In each case, find the dispersion relation and identify properties.

$L_1 u = u_t + au_x$
#+LATEX: \begin{hidden}
- $\lambda (\omega, k) = i (ak - \omega) = 0$, i.e. $\omega = ak$.
- Neither dissipative nor dispersive.
#+LATEX: \end{hidden}

$L_2 u = u_t - Du_{\tmop{xx}} + au_x$ ($D>0$)
#+LATEX: \begin{hidden}
- $\lambda (\omega, k) = - i \omega + iak + Dk^2$, i.e. $\omega = ak - iDk^2$.
- Dissipative, but not dispersive.
#+LATEX: \end{hidden}

$L_3 u = u_t + au_x - \mu u_{x x x}$
#+LATEX: \begin{hidden}
- $\lambda (\omega, k) = - i \omega + iak + i \mu k^3$, i.e. $\omega = ak + \mu k^3$.
- Dispersive, but not dissipative.
#+LATEX: \end{hidden}

*** Numerical Dissipation/Dispersion Analysis

*Goal:* Want discrete finite difference scheme to match dissipation/dispersion
behavior of continuous PDE.

\bigskip
Define a discrete wave-like function:
#+LATEX: \begin{hidden}
\[ z_{j, \ell} = z_0 e^{i (kjh_x - \omega \ell h_t)}\]
#+LATEX: \end{hidden}

We want $\b{z}$ to solve $P_h \b{z}_{\ell + 1} = Q_h
\b{z}_{\ell}$. How can we connect the operators to the wave solution?
#+LATEX: \begin{hidden}
$P_h$ and $Q_h$ consist of Toeplitz operators.
#+LATEX: \end{hidden}
*** Toeplitz and Waves

\[ z_{j, \ell} = z_0 e^{i (kjh_x - \omega \ell h_t)} . \]

**** Waves Diagonalize Toeplitz Operators
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:
Let $T$ be a Toeplitz operator. Then \(T\b{z}_{\ell} = \lambda (k)
\b{z}_{\ell} = \hat{\b{t}} (kh_x) \b z_\ell \).
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  (T\b{z}_{\ell})_j & = & \sum_m z_{m, \ell} t_{j - m} = \sum_m z_0
  e^{i (kmh_x - \omega \ell h_t)} t_{j - m}\\
  & = & \sum_m z_0 e^{i (k (m - j) h_x)} e^{i (kjh_x - \omega \ell h_t)} t_{j
  - m}\\
  & = & \left( \sum_{m'} e^{- ikm' h_x} t_{m'} \right) z_0 e^{i (kjh_x -
  \omega \ell h_t)} .
\end{eqnarray*}
\[\Rightarrow \lambda (k) = \sum_m e^{- ikmh_x} t_m = \hat{\b{t}} (kh_x) . \]
#+LATEX: \end{hidden}

*** Waves and Two-Level Schemes

Since $P_h$ and $Q_h$ are Toeplitz, we must have
\[ P_h \b{z}_{\ell + 1} = \lambda_P (k) \b{z}_{\ell + 1}, \qquad
   Q_h \b{z}_{\ell} = \lambda_Q (k) \b{z}_{\ell} . \]
What does that mean?
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  \lambda_P (k) \b{z}_{\ell + 1} & = & \lambda_Q (k)
  \b{z}_{\ell}\\
  \lambda_P (k) z_0 e^{i (kjh_x - \omega (\ell + 1) h_t)} & = & \lambda_Q (k)
  z_0 e^{i (kjh_x - \omega \ell h_t)}\\
  e^{- i \omega h_t} & = & \frac{\lambda_Q (k)}{\lambda_P (k)} =
  \frac{\hat{\b{q}} (kh_x)}{\hat{\b{p}} (kh_x)} = s (kh_x),
\end{eqnarray*}
which is the *symbol* of of the finite difference method.
#+LATEX: \end{hidden}
Seen before?
#+LATEX: \begin{hidden}
Used in von Neumann stability analysis.
#+LATEX: \end{hidden}

*** Discrete Dispersion Relation (1/2)

So $\b{z}_{\ell}$ is a solution of the finite difference
scheme if $\omega = \omega (kh_x)$ satisfies
\[ e^{- i \omega (\kappa) h_t} = s (\kappa), \]
where we let $\kappa = kh_x$. Interpret $\kappa$.
#+LATEX: \begin{hidden}
A number proportional to the number of *wavelengths per point*.
#+LATEX: \end{hidden}

Let $s (\kappa) = \abs{s (\kappa)} e^{i \varphi (\kappa)} = e^{\log \abs{s
(\kappa)} + i \varphi (\kappa)}$. $\omega(\kappa)$?
#+LATEX: \begin{hidden}
\[ \omega (\kappa) = \frac{- \varphi (\kappa) + i \log \abs{s (\kappa)}}{h_t} . \]
#+LATEX: \end{hidden}

*** Discrete Dispersion Relation (2/2)
\[ \omega (\kappa) = \frac{- \varphi (\kappa) + i \log \abs{s (\kappa)}}{h_t} . \]
Plug that into the wave-like solution:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  z_{j, \ell} & = & z_0 e^{i (kjh_x - \omega \ell h_t)}\\
  & = & z_0 e^{i \left( kjh_x - \frac{- \varphi (\kappa) + i \log \abs{s
  (\kappa)}}{h_t} \ell h_t \right)}\\
  & = & z_0 e^{\log \abs{s (\kappa)} \ell} e^{ik \left( jh_x - \frac{-
  \varphi (\kappa)}{kh_t} \ell h_t \right)}
\end{eqnarray*}
#+LATEX: \end{hidden}
Criterion for stability?
#+LATEX: \begin{hidden}
$\abs{s (\kappa)} \le 1$ (as before)
#+LATEX: \end{hidden}

*** Numerical Dispersion/Dissipation
Finite difference scheme $P_h \b{u}_{\ell + 1} = Q_h
\b{u}_{\ell}$ with symbol $s (k)$.
\[z_{j, \ell} =
  z_0 e^{\log \abs{s (\kappa)} \ell} e^{ik \left( jh_x - \frac{-
  \varphi (\kappa)}{kh_t} \ell h_t \right)}\]

When is the scheme *dissipative*?
#+LATEX: \begin{hidden}
If $\abs{s (kh_x)} < 1$, the scheme is called *dissipative*. Dissipation
occurs exponentially in time, with factor $s (kh_x)$.
#+LATEX: \end{hidden}
What is the *phase speed*?
#+LATEX: \begin{hidden}
The scheme has *phase speed* $v_{\tmop{ph}} = \frac{- \varphi (kh_x)}{kh_t}$.
#+LATEX: \end{hidden}
*Dispersion*?
#+LATEX: \begin{hidden}
If $v_{\tmop{ph}}$ is independent of $k$, all waves move with the same speed.
If not, the scheme is called *dispersive*.
#+LATEX: \end{hidden}

*** Dispersion/Dissipation Analysis of ETBS

Let $\lambda = ah_t / h_x$. Shown earlier: $s (kh_x) = 1 - \lambda (1 - e^{- ikh_x})$.

#+LATEX: \begin{hidden}
$s(\kappa)=(1-\lambda)+\lambda e^{-i\kappa}$. If we sweep $\kappa$, $s(\kappa)$ traces a circle:

\begin{tikzpicture}[scale=3]
  \def\lam{0.3}
  \draw [thick,->] (-0.25,0) -- (1.25,0) node [anchor=west] {$\operatorname{Re} s(k h_x)$};
  \draw [thick,->] (0,-0.35) -- (0,0.35) node [anchor=south] {$\operatorname{Im} s(k h_x)$};
  \draw [thick] (1-\lam,0.05) -- ++(0,-0.1) node [anchor=north] {$1-\lambda$};
  \draw [thick] (1,0.05) -- ++(0,-0.1) node [anchor=north] {$1$};
  \draw [dotted,thick] (1-\lam,0) circle (\lam);
\end{tikzpicture}

For small $\lambda$, the circle moves towards $s (kh_x) = 1$, implying lower
dissipation per step.

\medskip
Overall, we obtain
\[ e^{- i \omega (\kappa) h_t} = 1 - \lambda (1 - e^{- ikh_x}) . \]
#+LATEX: \end{hidden}

*** Dispersion/Dissipation Analysis of ETBS: Fine Grid

\[ e^{- i \omega (\kappa) h_t} = 1 - \lambda (1 - e^{- ikh_x})\]
#+LATEX: \begin{hidden}

If $kh_x$ is small, $e^{- ikh_x} \approx 1 - ikh$, so that
\[s (kh_x) \approx (1 - \lambda) + \lambda (1 - ikh_x) = 1 - i \lambda kh_x.\]

For small $\omega (kh_x)$, approximate
\(e^{- i \omega (kh_x) h_t} = 1 - i \omega (kh_x) h_t\).

Setting the two (approximately) equal yields
\[ 1 - i \omega (kh_x) h_t \approx 1 - i \lambda kh_x
\qquad\Rightarrow\qquad
\omega (kh_x) h_t \approx \lambda kh_x = \frac{ah_t}{h_x} kh_x, \]
i.e. $\omega (kh_x) \approx ak$, or $v_{\tmop{ph}} \approx (- ak) / (kh_t) = - a / h_t$,
which is independent of $k$. Thus we expect little dispersion for waves with
low number of wavelengths per point.
#+LATEX: \end{hidden}

*** Dispersion/Dissipation: Demo

- \demolink{fd-tdep}{Experimenting with Dispersion and Dissipation}
- \demolink{fd-tdep}{Dispersion and Dissipation}

** A Glimpse of Parabolic PDEs
*** Heat Equation
Heat equation ($D>0$):
\begin{eqnarray*}
  u_t & = & Du_{x x}, \qquad (x, t) \in \mathbb{R} \times (0, \infty),\\
  u (x, 0) & = & g (x) \qquad x \in \mathbb{R}.
\end{eqnarray*}
Fundamental solution ($g (x) = \delta (x)$):
#+LATEX: \begin{hidden}
\[ u (x, t) = \frac{1}{\sqrt{4 \pi t}} e^{- x^2 / 4 t} . \]
#+LATEX: \end{hidden}

Why is this a weird model?
#+LATEX: \begin{hidden}
Infinite speed of propagation of information
#+LATEX: \end{hidden}

*** Schemes for the Heat Equation

Cook up some schemes for the heat equation.

\bigskip
Explicit Euler:
#+LATEX: \begin{hidden}
\[ \frac{u_{k, \ell + 1} - u_{k, \ell}}{h_t} - D \frac{u_{k + 1, \ell} - 2
   u_{k, \ell} + u_{k - 1, \ell}}{h_x^2} = 0 \]
#+LATEX: \end{hidden}
Implicit Euler:
#+LATEX: \begin{hidden}
\[ \frac{u_{k, \ell + 1} - u_{k, \ell}}{h_t} - D \frac{u_{k + 1, \ell + 1} - 2
   u_{k, \ell + 1} + u_{k - 1, \ell + 1}}{h_x^2} = 0 \]
#+LATEX: \end{hidden}

*** Von Neumann Analysis of Explicit Euler for Heat (1/2)

Let $\lambda = Dh_t / h_x^2$.
\[ u_{k, \ell + 1} = u_{k, \ell} + \lambda (u_{k + 1, \ell} - 2 u_{k, \ell} +
   u_{k - 1, \ell}) . \]
#+LATEX: \begin{hidden}
\[ P_h = I, \qquad Q_h = \tmop{tridiag} (\lambda, 1 - 2 \lambda, \lambda) . \]
Thus
\begin{eqnarray*}
  \hat{\b{p}} (\varphi) & = & 1,\\
  \hat{\b{q}} (\varphi) & = & \lambda e^{- i \varphi} + (1 - 2 \lambda)
  + \lambda e^{i \varphi} = 1 - 2 \lambda + 2 \lambda \cos (\varphi) .
\end{eqnarray*}
We want $\abs{s (\varphi)} \le 1$, thus we need
\begin{eqnarray*}
  - 1 \le & 1 + 2 \lambda (\cos (\varphi) - 1) & \le 1\\
  \Leftrightarrow \quad - 2 \le & 2 \lambda (\cos (\varphi) - 1) &
  \le 0.
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Von Neumann Analysis of Explicit Euler for Heat (2/2)

\begin{equation*}
  - 2 \le 2 \lambda (\cos (\varphi) - 1) \le 0.
\end{equation*}
#+LATEX: \begin{hidden}
Since $\abs{\cos (\varphi)} \le 1$, also $- 2 \le \cos (\varphi) -
1 \le 0$. For the lower bound,
\[ - 2 \le - 4 \lambda \quad \Leftrightarrow \quad \frac{1}{2} \ge
   \frac{Dh_t}{h_x^2} \quad \Leftrightarrow \quad h_t \le \frac{h_x^2}{2
   D} . \]
Observe $h_t = O (h_x^2)$, which is often prohibitively small.
#+LATEX: \end{hidden}

Comment on the stability region found regarding speeds of propagation.

#+LATEX: \begin{hidden}
- Saw: heat equation has infinite speed of information propagation
- Explicit Euler has finite speed of information propagation (how fast?)
#+LATEX: \end{hidden}

*** Von Neumann Analysis of Implicit Euler for Heat

Let $\lambda = Dh_t / h_x^2$.
\[ u_{k, \ell + 1} - \lambda (u_{k + 1, \ell + 1} - 2 u_{k, \ell + 1} + u_{k -
   1, \ell + 1}) = u_{k, \ell} \]
#+LATEX: \begin{hidden}
\[ P_h = \tmop{tridiag} (- \lambda, 1 + 2 \lambda, - \lambda), \qquad Q_h = I.
\]
\begin{equation*}
  \hat{\b{p}} (\varphi) = 1 + 2 \lambda (1 - \cos (\varphi)),\quad
  \hat{\b{q}} (\varphi) = 1.
\end{equation*}
To obtain $\abs{s (\varphi)} \le 1$, consider
\( 1 \le \abs{1 + 2 \lambda (1 - \cos (\varphi))}\),
which is always true.
#+LATEX: \end{hidden}

Does the type of system we need to solve for implicit+parabolic correspond to
another PDE?

#+LATEX: \begin{hidden}
- Yes, elliptic.
- Focus on solving those later.
#+LATEX: \end{hidden}

** TODO The Method of Lines                                        :noexport:
* Finite Volume Methods for Hyperbolic Conservation Laws
  :PROPERTIES:
  :RELATE_TREE_SECTION_NAME: fv-hyperbolic
  :RELATE_TREE_SECTION_OPENED: true
  :END:
** Theory of 1D Scalar Conservation Laws
*** Conservation Laws: Recap
\begin{equation*}
  \label{eq:scalar-claw} u_t + f (u)_x = 0,
\end{equation*}
where $u$ is a function of $x$ and $t\in \mathbb R_0^+$.

\medskip
Rewrite in integral form:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[ \frac{\mathd}{\mathd t} \int_a^b u (x, t) \mathd x + f (u (b, t)) - f (u
   (a, t)) = 0 \qquad\text{for any $a$, $b$.} \]
#+LATEX: \end{hidden}
Recall: *Characteristic Curve:* a function $x (t)$ so that $u(x(t),t)=u(x_0,0)$.
\[ \left\{\begin{array}{l}
     \frac{\mathd x (t)}{\mathd t} = f' (u (x (t),t)),\\
     x (0) = x_0 .
   \end{array}\right.\]
What assumption underlies all this?
#+LATEX: \begin{hidden}
Smooth Solution.
#+LATEX: \end{hidden}

*** Going Nonlinear: Burgers' Equation
Make a simple modification to advection $u_t+au_x=0$ to make it nonlinear.
#+LATEX: \begin{hidden}
$u_t+uu_x=0$
#+LATEX: \end{hidden}
Is that a sensible modification?
#+LATEX: \begin{hidden}
Yes: it is the core part of the momentum equation in Euler's equations of gas dynamics in 1D.
\[\partial_t \b u +\b u\cdot \nabla \b u +\frac{\nabla p}\rho =\b g\]
#+LATEX: \end{hidden}
Is that still a conservation law?
#+LATEX: \begin{hidden}
Yes: $u_t+(u^2/2)_x=0$. Called *Burgers' Equation*.
#+LATEX: \end{hidden}

*** Burgers' Equation: Try FD Numerics

\demolink{fv-hyperbolic}{ETBS for Volume Burgers}

\bigskip
What do you think of these results?
#+LATEX: \begin{hidden}
No good, very bad. Conservation of $\int u$ should hold at least to the
order of accuracy of the scheme!

\medskip
We clearly need to rethink our plan here.
We will begin by learning about the theory of conservation laws.
#+LATEX: \end{hidden}

*** Burgers' Equation

\begin{equation*}
  \label{eq:burgers-sin} \left\{\begin{array}{l}
    u_t + \left( \frac{u^2}{2} \right)_x = 0,\\
    u (x, 0) = g(x) =\sin (x) .
  \end{array}\right.
\end{equation*}

Interpret Burgers' equation.
#+LATEX: \begin{hidden}
$f(u)=u^2/2$. So $f'(u)=u$.

Characteristic speed is given by `how much stuff there is'/`the density'
#+LATEX: \end{hidden}

Consider the characteristics at $\pi / 2$ and $3 \pi / 2$.
#+LATEX: \begin{hidden}
$f(u)=u^2/2$. So $f'(u)=u$.

- $x=\pi/2$: $f'(\sin x) = 1$.
- $x=3\pi/2$: $f'(\sin x) = -1$.

They intersect!
#+LATEX: \end{hidden}

*** Weak Solutions
\begin{equation*}
  \frac{\mathd}{\mathd t} \int_a^b u (x, t) \mathd x
  = f (u (a, t)) - f (u (b, t))
\end{equation*}
Define a weak solution:
#+LATEX: \begin{hidden}
- If $u$ satisfies the integral form for almost all $(a, b)$ then
  $u$ is called a weak solution. (physically meaningful)

- If for any $\varphi \in C^1_0 (\mathbb{R}\times[0,\infty))$ (compact support),
  \[ - \int_0^{\infty} \int_{- \infty}^{\infty} (u \varphi_t + f (u)
     \varphi_x) \mathd x \mathd t - \int_{- \infty}^{\infty} u^0 (x) \varphi
     (x, 0) \mathd x = 0, \]
  then in $u$ is called a *weak solution*. (more meaningful mathematically)

Turns out: equivalent. (not shown)
#+LATEX: \end{hidden}
*** Rankine-Hugoniot Condition (1/2)
Consider: Two $C^1$ segments separated by a curve $x(t)$ with
no regularity.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[ (d/dt) \bigg( \underbrace{\int_a^{x (t)} u (x, t) d x}_{G_a (x (t),
   t) \assign} + \underbrace{\int_{x (t)}^b u (x, t) d x}_{G_b (x (t), t)
   \assign} \bigg) + f (u (b, t)) - f (u (a, t)) = 0. \]
\begin{eqnarray*}
  &  & \frac{d}{d t} G_a (x (t), t) = \frac{\partial G_a (x (t), t)}{\partial
  x} \cdot \frac{d x (t)}{d t} + \frac{\partial G_a}{\partial t}\\
  & = & u (x (t), t) x' (t) + \int_a^{x (t)} u_t (x, t) d x\\
  & = & u (x (t), t) x' (t) - \int_a^{x (t)} f (u)_x (x, t) d x\\
  & = & u (x (t), t)x'(t) - (f (u (x (t), t)) - f (u (a, t))),
\end{eqnarray*}
and $d G_b (x (t), t) / d t$ analogously.
#+LATEX: \end{hidden}
*** Rankine-Hugoniot Condition (2/2)

\begin{equation*}
  (d/dt) G_a (x (t), t) = u (x (t), t)x'(t) - (f (u (x (t), t)) - f (u (a, t))).
\end{equation*}

#+LATEX: \begin{hidden}
Discontinuity at $u (x (t), t)$: $(d / d t) G_a$ doesn't exist. One-sided limits:
\begin{eqnarray*}
  \left[ \frac{d G_a (x (t), t)}{t} \right]^- & = & u^- x' (t) - (f (u^-) - f
  (u (a, t))),\\
  \left[ \frac{d G_b (x (t), t)}{t} \right]^+ & = & - u^+ x' (t) - (f (u (b,
  t)) - f (u^+)) .
\end{eqnarray*}
Adopted shorthand: \(u^- \assign u (x (t)^-, t), \qquad u^+ \assign u (x (t)^+, t)\).

Plug into integral form: $u^- x' (t) - f (u^-) - u^+ x' (t) + f (u^+)
= 0$.
\[ x' (t) = \frac{f (u^+) - f (u^-)}{u^+ - u^-} . \]

This is the called the *Rankine-Hugoniot Condition*.
#+LATEX: \end{hidden}

*** Rankine-Hugoniot and Weak Solutions

**** Rankine-Hugoniot and Weak Solutions
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

If $u$ is piecewise $C^1$ and is discontinuous only along isoated curves, and
if $u$ satisfies the PDE when it is $C^1$, and the Rankine-Hugoniot
condition holds along all discontinuous curves, then $u$ is a weak solution of
the conservation law.

*** Riemann Problems: Example 1

Consider the following *Riemann problem*:
\begin{align*}
     &u_t + \left( \frac{u^2}{2} \right)_x = 0,\\
     &u (x, 0) = \begin{cases}
       1 & x < 0,\\
       - 1 & x \ge 0.
     \end{cases}
 \end{align*}

#+LATEX: \begin{hidden}
The IC is just propagated in time (at ``speed 0'') to form a weak solution (a *shock*).
#+LATEX: \end{hidden}
*** Riemann Problems: Example 2

\begin{align*}
     &u_t + \left( \frac{u^2}{2} \right)_x = 0,\\
     &u (x, 0) = \begin{cases}
       -1 & x < 0,\\
       1 & x \ge 0.
     \end{cases}
 \end{align*}
 (IC sign flip compared to previous slide)

 #+LATEX: \begin{hidden}
The propagated ICs also form a weak solution. But consider
\begin{equation*}
   u (x, t) = \begin{cases}
     - 1 & x \le - t,\\
     x / t & - t < x < t,\\
     1 & x > t.
   \end{cases}
\end{equation*}
This is *also* a weak solution (a *rarefaction wave*).

Conclusion: Our current notion of weak solution is /too/ weak.
#+LATEX: \end{hidden}
*** Bad Shocks and Good Shocks

In the shock version of the `ambiguous' Riemann problem, where do the
characteristics go?

#+LATEX: \begin{hidden}
- Out of the shock.
- In the first example, the shock is *self-steepening*.
- In the second example, it is not.
#+LATEX: \end{hidden}

Comment on the stability of that situation.
#+LATEX: \begin{hidden}
Smearing out the initial profile or adding viscosity would wash out the
solution into a rarefaction fan.
#+LATEX: \end{hidden}

*** Ad-Hoc Idea: Ban Bad Shocks

Recall: what is $f' (u)$?

#+LATEX: \begin{hidden}
Characteristic speed.
#+LATEX: \end{hidden}


Devise a way to ban unstable shocks.

#+LATEX: \begin{hidden}
A discontinuity propagating with speed $s$ (cf. Rankine-Hugoniot) satsifes the
*entropy condition* if
\[ f' (u^-) > s > f' (u^+).\]
If $f$ is convex, $f'$ is monotonically non-decreasing, and the
Rankine-Hugoniot speed automatically falls between $f' (u^-)$ and $f' (u^+)$.
So for convex $f$, $f' (u^-) > f' (u^+)$ is sufficient (and implies $u^- >
u^+$ by convexity).
#+LATEX: \end{hidden}

*** Vanishing Viscosity Solutions
*Goal:* neither uniqueness nor existence poses a problem.

\bigskip
How?
#+LATEX: \begin{hidden}
Consider adding an *artificial viscosity*:
\[ u_t^{\varepsilon} + f (u^{\varepsilon})_x = \varepsilon u_{x,
   x}^{\varepsilon} \qquad\text{with small $\varepsilon >0$}.\]

By `washing out' the solution, the viscous term increases smoothness,
and, we hope, restores uniqueness.

\medskip
Then we would wish to define an *vanishing viscosity weak solution* as
\[ \lim_{\varepsilon \rightarrow 0} u^{\varepsilon} (x, t) = u (x, t)\]
in some norm.
#+LATEX: \end{hidden}

*** Entropy-Flux Pairs

What are features of (physical) entropy?
#+LATEX: \begin{hidden}
- Constant along particle paths in smooth flow
- Jumps to higher values across a shock
#+LATEX: \end{hidden}

**** Entropy/Entropy Flux
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
An *entropy* $\eta (u)$ and an *entropy flux* $\psi (u)$ are functions
so that $\eta$ is convex and
\[ \eta (u)_t + \psi (u)_x = 0 \]
for smooth solutions of the conservation law.

*** Finding Entropy-Flux Pairs

\(\eta (u)_t + \psi (u)_x = 0\).
Find conditions on $\eta$ and $\psi$.

#+LATEX: \begin{hidden}
For smooth $u$, the chain rule gives \( \eta'  (u) u_t + \psi' (u) u_x = 0 \).
Similarly, we can rewrite the conservation law:
\begin{eqnarray*}
  u_t + f' (u) u_x & = & 0\\
  \Leftrightarrow \quad \eta' (u) u_t + \eta' (u) f' (u) u_x & = & 0.
\end{eqnarray*}
This gives us $\psi' (u) = -\eta'(u)(u_t/u_x)= \eta' (u) f' (u)$.

Lots of solutions for scalar conservation laws. For systems and in multiple
dimensions: may have no solutions.
#+LATEX: \end{hidden}

Come up with an entropy-flux pair for Burgers.
#+LATEX: \begin{hidden}
$f (u) = u^2 / 2$. If we take $\eta (u) = u^2$, then $\psi' (u) = 2 u \cdot
u$, i.e. $\psi (u) = 2 u^3 / 3$.
#+LATEX: \end{hidden}

*** Back to Vanishing Viscosity (1/2)

\[ u_t + f (u)_x = \varepsilon u_{x x} \]
What's the evolution equation for the entropy?
#+LATEX: \begin{hidden}
Note: Viscosity solutions are always smooth. Allowed to do derivative
gymnastics. Multiply by $\eta'(u)$:
\begin{eqnarray*}
  \eta' (u) u_t + \eta' (u) f' (u) u_x & = & \varepsilon \eta' (u) u_{x x}\\
  \Leftrightarrow \quad \eta (u)_t + \psi (u)_x & = & \varepsilon (\eta' (u)
  u_x)_x - \varepsilon \eta'' (u) u_x^2 .
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Back to Vanishing Viscosity (2/2)

\begin{equation*}
  \eta (u)_t + \psi (u)_x = \varepsilon (\eta' (u)
  u_x)_x - \varepsilon \eta'' (u) u_x^2 .
\end{equation*}
Integrate this over $[x_1, x_2] \times [t_1, t_2]$, with $x_1$, $x_2$ on either side of jump.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  &  & \int_{t_1}^{t_2} \int_{x_1}^{x_2} \eta (u)_t + \psi (u)_x d xd t\\
  & = & \varepsilon \int_{t_1}^{t_2} [\eta' (u (x_2, t)) u_x (x_2, t) - \eta'
  (u (x_1, t)) u_x (x_1, t)] d t\\
  &  & - \varepsilon \int_{t_1}^{t_2} \int_{x_1}^{x_2} \underbrace{\eta'' (u)
  u_x^2}_{\ge 0} d xd t.
\end{eqnarray*}
As $\varepsilon \rightarrow 0$, the first term goes to zero. The
second term involves an integral over the square of the derivative of a
steepening  $u$ (as $\varepsilon \rightarrow 0$), and so will not vanish.
Accordingly,
\( \eta (u)_t + \psi (u)_x \le 0\) weakly.
#+LATEX: \end{hidden}

*** Entropy Solution

**** Entropy solution
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
The function $u (x, t)$ is the *entropy solution* of the conservation law if
for *all* convex entropy functions and corresponding entropy fluxes, the
inequality
\[ \eta (u)_t + \psi (u)_x \le 0 \]
is satisfied in the weak sense.
**** End def
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

*** Entropy Solution vs Entropy Condition

Relate entropy solutions \( \eta (u)_t + \psi (u)_x \le 0 \) back to the entropy condition.
#+LATEX: \begin{hidden}
Consider Burgers, integrate the entropy ineq. over a small box:
#+BEGIN_EXPORT latex
\begin{tikzpicture}[scale=0.6]
    \draw (0,0) .. controls ++(45:3) .. (7,3)
        node (bl) [pos=0.1] {} 
        node (tr) [pos=0.9] {};
    \draw (bl) rectangle (tr)
      let \p1 = (bl), \p2 = (tr), \p{tl} = (\x1, \y2), \p{br} = (\x2, \y1)
      in (\p{tl}) node (tl) {} (\p{br}) node (br) {};
    
    \draw (bl) ++(0, -0.25) node [anchor=north] {$x_1$};
    \draw (br) ++(0, -0.25) node [anchor=north] {$x_1+\Delta x=x_1+s_1 \Delta t$};
    \draw (bl) ++(-0.25, 0) node [anchor=east] {$t_1$};
    \draw (tl) ++(-0.25, 0) node [anchor=east] {$t_1+\Delta t$};
    
    \draw (tl) node [anchor=north west] {$u\approx u_l$};
    \draw (br) node [anchor=south east] {$u\approx u_r$};
\end{tikzpicture}
#+END_EXPORT

\vspace{-5ex}
\begin{align*}
0&\ge\left[ \int_{x_1}^{x_1+\Delta x} u^2\right]_{t_1}^{t_1+\Delta t}
+\left[ \int_{t_1}^{t_1 +\Delta t} 2u^3/3\right]_{x_1}^{x_1 +\Delta x}\\
&=s_1\Delta t (u_l^2 -u_r^2) +2/3\Delta t (u_r^3-u_l^3) +O(\Delta t^2)\\
&=\Delta t(u_l^2 -u_r^2)(s_1-s_2) +O(\Delta t^2)\\
&=-1/6 (u_l-u_r)^3\Delta t+O(\Delta t^2)\quad \to \quad u_l > u_r,
\end{align*}
with $s_1=[u^2/2]/[u]$, $s_2=[2u^3/3]/[u^2]$, $s_2-s_1=[u]^2/(6(u_l+u_r))$.

#+LATEX: \end{hidden}
# Source: Leveque 1992, p. 40

*** Conservation of Entropy?

What can you say about conservation of entropy in time?
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  0 & \ge & \int_{t_1}^{t_2} \int_{x_1}^{x_2} \eta (u)_t + \psi (u)_x d
  xd t\\
  & = & \left[ \int_{x_1}^{x_2} \eta (u (x, t)) d x \right]_{t_1}^{t_2} +
  \left[ \int_{t_1}^{t_2} \psi (u (x, t)) d t \right]_{x_1}^{x_2},
\end{eqnarray*}
so that
\[ \int_{x_1}^{x_2} \eta (u (x, t_2)) d x \le \int_{x_1}^{x_2} \eta (u
   (x, t_1)) d x - \underbrace{\left[ \int_{t_1}^{t_2} \psi (u (x, t)) d t
   \right]_{x_1}^{x_2}}_{\text{Outflow/Inflow}} \]
If $u$ is compactly supported, then we can choose $x_1$ and $x_2$ 
so that $\psi(u(x_1,t))\equiv \text{const}(t)\equiv \psi(u(x_2,t))$ and entropy can only decrease.
(fluid flow: $\text{math. entropy} = - \rho \cdot \text{phys. entropy}$)
#+LATEX: \end{hidden}

*** Total Variation
\[ \operatorname{TV} (u) = \limsup_{\varepsilon \rightarrow 0} \frac{1}{\varepsilon}
   \int \abs{u (x + \varepsilon) - u (x)} d x. \]
Simpler form if $u$ is differentiable?
#+LATEX: \begin{hidden}
\[ \operatorname{TV} (u) = \int \abs{u' (x)} d x \]
#+LATEX: \end{hidden}

Hiking analog?
#+LATEX: \begin{hidden}
Elevation change
#+LATEX: \end{hidden}
*** Total Variation and Conservation Laws

**** Total Variation is Bounded \sourceref{Dafermos 2016, Thm. 6.2.6}
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:
Let $u$ be a solution to a conservation law with $f'' (u) \ge 0$. Then:
\[ \tmop{TV} (u (t + \Delta t, \cdot)) \le \tmop{TV} (u (t, \cdot))
   \quad \text{for $\Delta t \ge 0$} . \]
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
- For smooth solutions (and non-crossing characteristics), all function values
  live \(\Rightarrow\) TV stays unchanged.

- For solutions with shocks, local minima and maxima may disappear into the
  shock \(\Rightarrow\) TV decreases.
#+LATEX: \end{hidden}


**** $L^1$ contraction \sourceref{Dafermos 2016, Thm. 6.3.2}
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

Let $u$, $v$ be viscosity solutions of the conservation law. Then
\[ \norm{u (t + \Delta, \cdot) - v (t + \Delta t, \cdot)}_{L^1 (\mathbb{R})}
   \le \norm{u (t, \cdot) - v (t, \cdot)}_{L^1 (\mathbb{R})} \quad
   \text{for $\Delta t \ge 0$} . \]

** Numerical Methods for Conservation Laws
*** Finite Difference for Conservation Laws? (1/2)
\[ \left\{\begin{array}{l}
     u_t + \left( \frac{u}{2} \right)_x^2 = 0\\
     u (x, 0) = \begin{cases}
       1 & x < 0,\\
       0 & x \ge 0.
     \end{cases}
   \end{array}\right. \]
Entropy Solution?
#+LATEX: \begin{hidden}
\[ u (x, t) = \begin{cases}
     1 & x \le \frac{1}{2} t,\\
     0 & x > \frac{1}{2} t.
   \end{cases} \]
#+LATEX: \end{hidden}

Rewrite the PDE to `match' the form of advection $u_t + au_x = 0$:
#+LATEX: \begin{hidden}
$u_t + uu_x= 0$.
#+LATEX: \end{hidden}
Equivalent?
*** Finite Difference for Conservation Laws? (2/2)

Recall the /upwind scheme/ for $u_t + au_x = 0$:
#+LATEX: \begin{hidden}
\[ u_{j,\ell + 1} = u_{j,\ell} - a \cdot \frac{\Delta t}{\Delta x} (u_{j,\ell} - u_{j -
   1,\ell}) . \]
#+LATEX: \end{hidden}
Write the upwind FD scheme for $u_t + uu_x = 0$:
#+LATEX: \begin{hidden}

\[ u_{j,\ell + 1} = u_{j,\ell} - \frac{\Delta t}{\Delta x} u_{j,\ell} (u_{j,\ell} - u_{j - 1,\ell})
   . \]
- For $j \neq 0$, $u_{j,0} - u_{j - 1,0} = 0$
- For $j = 0$, $u_{j,0} = 0$.
Altogether,
\[ u_{j,\ell + 1} = u_{j,\ell}. \]
Bad.
#+LATEX: \end{hidden}
*** Schemes in Conservation Form

**** Conservative Scheme
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

A conservation law scheme is called *conservative* iff it
can be written as
#+LATEX: \begin{hidden}
\[ u_{j,\ell + 1} = u_{j,\ell} - \frac{\Delta t}{\Delta x} [f^*_{j + 1 / 2}(\b u_\ell) -
   f^*_{j - 1 / 2}(\b u_\ell)], \]
#+LATEX: \end{hidden}

where \(f^*\)\dots
#+LATEX: \begin{hidden}
- is Lipschitz continuous,
- satisfies $f^* (u, \cdots, u) = f (u)$ (*consistency*).
#+LATEX: \end{hidden}


**** Lax-Wendroff
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:
If the solution $\{u_{j,\ell} \}$ to a conservative scheme converges (as $\Delta
t, \Delta x \rightarrow 0$) boundedly almost everywhere to a function $u (x, t)$, then
$u$ is a weak solution of the conservation law.

*** Lax-Wendroff Theorem: Proof
*Summation by parts*: With $\Delta^+ a_k=a_{k+1}-a_k$ and $\Delta^- a_k = a_k-a_{k-1}$:
\begin{equation*}
  \sum_{k = 1}^N a_k (\Delta^- \varphi_k) + \sum_{k = 1}^N \varphi_k
  (\Delta^+ a_k) = - a_1 \varphi_0 + \varphi_N a_{N + 1}.
\end{equation*}
#+LATEX: \begin{hidden}
Let $\varphi_{j,\ell} = \varphi (x_j, t_\ell)$ for $\varphi \in C^1_0$ (compact support). Then, by conservativity,
\begin{eqnarray*}
  &   & 0=\sum_{\ell=1}^\infty \sum_j \left(  \frac{\Delta_2^+u_{j,\ell }}{h_ t} +
  \frac{\Delta^+ f^*_{j - 1 / 2}}{h_ x} \right)
  \varphi_{j,\ell} h_x h_t\\
  & = & - \sum_{\ell=1}^\infty \sum_j \left( \frac{\Delta_2^- \varphi_{j,\ell}}{h_ t} u_{j,\ell}
    + \frac{\Delta_1^- \varphi_{j,\ell} }{h_ x} f^*_{j - 1 / 2} \right) h_x h_t
    - \sum_j u_{j,1} \phi_{j,0} h_x\\
  &\underset{f^*(u,u)=u}{\overset{\text{DCT}}{\rightarrow}}&
  -\int_0^{\infty} \int_{- \infty}^{\infty} (\varphi_t u + \varphi_x f (u))
  \mathd x \mathd t
  -\int_{-\infty}^\infty u(x,0)\phi(x,0)
  \mathd x
  = 0.
\end{eqnarray*}
#+LATEX: \end{hidden}
*** Finite Volume Schemes
Finite volume: Idea?
#+LATEX: \begin{hidden}
- Consider the solution constant in each cell: $\bar{u}_j$
- $\bar{u}_j$ is the *cell average* of cell $I_j$:
  \[\bar{u}_j=(1/h_x) \int_{x_{j-1/2}}^{x_{j+1/2}} u(x) dx\]
- Choose $h_x$, $h_t$ so that \(\max |f' (u) | h_ t < h_ x\).

\medskip
*Idea:* Solve Riemann problem at each cell interface.
#+LATEX: \end{hidden}

*** Developing Finite Volume

 \[\int_{t_\ell}^{t^{\ell + 1}} \int_{x_{j - 1 / 2}}^{x_{j + 1 / 2}} (u_t + f (u)_x)\mathd x \mathd t =0\]
#+LATEX: \begin{hidden}
\begin{eqnarray*}
  \frac{1}{h_x} \int_{x_{j - 1 / 2}}^{x_{j + 1 / 2}} u^{\ell + 1} \mathd x -
  \frac{1}{h_x} \int_{x_{j - 1 / 2}}^{x_{j + 1 / 2}} u^\ell \mathd x \\
  +
  \frac{1}{h_x} \int_{t_\ell}^{t_{\ell + 1}} f (u_{j + 1 / 2}) \mathd t -
  \frac{1}{h_x} \int_{t_\ell}^{t_{\ell + 1}} f (u_{j - 1 / 2}) \mathd t & = &
  0\\
  \Leftrightarrow\quad
  \bar u_{j,\ell+1} -\bar u_{j,\ell}\\
  +
  \frac{1}{h_x} \int_{t_\ell}^{t_{\ell + 1}} f (u_{j + 1 / 2}) \mathd t -
  \frac{1}{h_x} \int_{t_\ell}^{t_{\ell + 1}} f (u_{j - 1 / 2}) \mathd t & = &
  0.
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Flux Integrals?

\[\frac{1}{h_x} \int_{t_\ell}^{t_{\ell + 1}} f (u_{j + 1 / 2}) \mathd t?\]
#+LATEX: \begin{hidden}
The substitution
\[
  \bar{x} = ax,\qquad
  \bar{t} = at.
\]
leaves the conservation law and the Riemann ICs invariant.

$\Rightarrow$ The Riemann solution must be *self-similar* under scaling.

\medskip
Thus: the Riemann solution $u (x, t)$ can be viewed as function of only one variable $\xi = x / t$.

\medskip
Thus $u$ is constant along $x = x_{j \pm 1 / 2}$, so that
\[
\frac{1}{h_x} \int_{t_\ell}^{t_{\ell + 1}} f (u_{j + 1 / 2}) \mathd t= \frac{h_t}{h_x} f (u_{j + 1 / 2}).
\]
#+LATEX: \end{hidden}
*** The Godunov Scheme

Altogether:
\[ \bar{u}_{j,\ell+1} = \bar{u}_{j,\ell} - \frac{h_t}{h_x} (f (u_{j + 1 / 2,\ell}) -
   f (u_{j - 1 / 2,\ell})) . \]
Overall algorithm?
#+LATEX: \begin{hidden}
- *Reconstruct* $u_{j \pm 1 / 2,\ell}^-$ and $u_{j \pm 1 / 2,\ell}^+$
- *Evolve* the Riemann problem at $x_{j\pm 1/2}$:
- *Average* the Riemann solutions to obtain $\bar{u}_{j,\ell+1}$

\to *Numerical flux* / *Riemann solver*: \(f^*(u_{j \pm 1 / 2,\ell}^-, u_{j \pm 1 / 2,\ell}^+)\)
#+LATEX: \end{hidden}
Heuristic time step restriction?
#+LATEX: \begin{hidden}
Will run into problems if wave from one cell interface interacts with
other interface: \(h_t\le h_x/\max_j \abs{f'(u_j)} \)
#+LATEX: \end{hidden}

*** Riemann Problem

\[ \left\{\begin{array}{l}
     u_t + f (u)_x = 0,\\
     u (x, 0) = \begin{cases}
       u_l & x < 0,\\
       u_r & x \ge 0
     \end{cases}
   \end{array}\right. \]
Exact solution in the Burgers case?
#+LATEX: \begin{hidden}
\vspace{-1ex}
\[ u (x, t) = \begin{cases}
     \begin{cases}
       u_l & x < st,\\
       u_r & x \ge st,
     \end{cases} & u_l \ge u_r,\\
     \begin{cases}
       u_l & x < u_l t,\\
       x / t & u_l t \le x < u_r t,\\
       u_r & x \ge u_r t,
     \end{cases} & u_l < u_r,
   \end{cases} \]
\[ s = \frac{f (u_r) - f (u_l)}{u_r - u_l} = \frac{\frac{1}{2} [u_r^2 -
   u_l^2]}{u_r - u_l} = \frac{1}{2} (u_l + u_r) . \]
Why is the rarefaction part independent of $u_l$ and $u_r$?
#+LATEX: \end{hidden}
*** Riemann Solver for a General Conservation Law

To complete the scheme: Need $f^*(u^-, u^+)$. For Burgers: already known.

For a general convex ($f'' (u) > 0$) conservation law?
#+LATEX: \begin{hidden}
Let $u_s$ such that $f' (u_s) = 0$ (called the *stagnation state*: why?)
\[ f(u(0,t))= f^{\ast} (u^-, u^+) = \begin{cases}
     f (u^-) & \text{if shock with $s > 0$},\\
     f (u^+) & \text{if shock with $s \le 0$},\\
     f (u^-) & \text{if raref. with $f' (u^-) \ge 0$},\\
     f (u^+) & \text{if raref. with $f' (u^+) \le 0$},\\
     f (u_s) & \text{if raref. with $f' (u^-) \le 0 \le f'
     (u^+)$} .
   \end{cases} \]
#+LATEX: \end{hidden}

Equivalent to
#+LATEX: \begin{hidden}
\[ f^{\ast} (u^-, u^+) = \begin{cases}
     \max_{u^+ \le u \le u^-} f (u) & \text{if $u^- > u^+$},\\
     \min_{u^{_-} \le u \le u^+} f (u) & \text{if $u^- \le
     u^+$} .
   \end{cases} \]
#+LATEX: \end{hidden}
*** More Riemann Solvers

Downside of Godunov Riemann solver?
#+LATEX: \begin{hidden}
Not easy/efficient to implement in general. Want simpler Riemann solvers.
#+LATEX: \end{hidden}

*** Back to Advection
Consider only $f(u)=au$ for now. Riemann solver inspiration from FD?
#+LATEX: \begin{hidden}
For $a \ge 0$, want ETBS:
\begin{eqnarray*}
  0 & = & \frac{u_{j, \ell + 1} - u_{j, \ell}}{h_t} + a \frac{u_{j, \ell} - u_{j - 1, \ell}}{h_x}\\
  & = & \frac{u_{j, \ell + 1} - u_{j, \ell}}{h_t} + \frac{f (u_{j, \ell}) - f (u_{j - 1, \ell})}{h_x}\\
  & = & \frac{u_{j, \ell + 1} - u_{j, \ell}}{h_t} + \frac{f^{\ast} (u_{j,
  \ell}, u_{j + 1, \ell}) - f^{\ast} (u_{j - 1, \ell}, u_{j, \ell})}{h_x} .
\end{eqnarray*}
Clearly equivalent to a finite volume scheme! Upwind numerical flux?
\[ f^{\ast} (u^{_-}, u^+) = \begin{cases}
     au^- & a \ge 0\\
     au^+ & a < 0
   \end{cases} = \frac{au^- + au^+}{2} - \frac{\abs{a}}{2} (u^+ - u^-)
   . \]
#+LATEX: \end{hidden}
*** Side Note: First Order Upwind, Rewritten
\[ \frac{u_{j, \ell + 1} - u_{j, \ell}}{h_t} + \frac{f^{\ast} (u_{j, \ell},
   u_{j + 1, \ell}) - f^{\ast} (u_{j - 1, \ell}, u_{j, \ell})}{h_x} \]
with
\[ f^{\ast} (u^{_-}, u^+) = \frac{au^- + au^+}{2} - \frac{\abs{a}}{2} (u^+ -
   u^-) . \]
#+LATEX: \begin{hidden}
\begin{equation*}
   \frac{u_{j, \ell + 1} - u_{j, \ell}}{h_t} + a \frac{u_{j + 1, \ell} - u_{j
   - 1, \ell}}{2 h_x} = \frac{\abs{a} h_x}{2} \cdot \frac{u_{j + 1, \ell} - 2
   u_{j, \ell} + u_{j - 1, \ell}}{h_x^2},
\end{equation*}
i.e. it is equivalent to ETCS (unstable!) with a second-order discretization
of $\partial_x^2$, i.e. a dissipation, with a coefficient that vanishes as
$h_x \rightarrow 0$.
#+LATEX: \end{hidden}

*** Lax-Friedrichs

Generalize linear upwind flux for a nonlinear conservation law:
\[ f^{\ast} (u^{_-}, u^+) = \frac{au^- + au^+}{2} - \frac{\abs{a}}{2} (u^+ -
   u^-) . \]
#+LATEX: \begin{hidden}
\[ f^{\ast} (u^{_-}, u^+) = \frac{f (u^-) + f (u^+)}{2} - \frac{\alpha}{2}
   (u^+ - u^-) . \]
Choice of $\alpha$ (consistent with linear)? Idea:
\( \alpha = \abs{f' ((u^- + u^+) / 2)} \)

Unfortunately: may converge to a weak solution that violates the entropy
condition (not shown). Better:
\[ \alpha = \max \left( \abs{f' (u^-)}, \abs{f' (u^+)} \right). \]
Called *local Lax-Friedrichs*. Global variant (with global max) also OK.
#+LATEX: \end{hidden}

\demolink{fv-hyperbolic}{Finite Volume Burgers} (Part I)

** Higher-Order Finite Volume
*** Improving Accuracy

Consider our existing discrete FV formulation:
\[ \bar{u}_{j,\ell+1} = \bar{u}_{j,\ell} - \frac{h_t}{h_x} (f (u_{j + 1 / 2,\ell}) -
   f (u_{j - 1 / 2,\ell})) . \]
What obstacles exist to increasing the order of accuracy?
#+LATEX: \begin{hidden}
- Temporal Accuracy
- Spatial Accuracy
- Nonsmoothness (in both space and time)
#+LATEX: \end{hidden}

What order of accuracy can we expect?
#+LATEX: \begin{hidden}
- Near shocks: no convergence in $L^\infty$, first-order in $L^2$.
- Elsewhere: hopefully, as high as we would like
#+LATEX: \end{hidden}

*** Improving the Order of Accuracy

Improve temporal accuracy.

#+LATEX: \begin{hidden}
Rewrite FV using the *method of lines*:
\[ \frac{d \bar u_j (t)}{dt} + \frac{f^{\ast} (u_{j + 1 / 2}^- (t), u_{j + 1 /
   2}^+ (t)) - f^{\ast} (u_{j - 1 / 2}^- (t), u_{j - 1 / 2}^+ (t))}{h_x} = 0.
\]
#+LATEX: \end{hidden}
What's the obstacle to higher spatial accuracy?

#+LATEX: \begin{hidden}
Letting $u^-_{j + 1 / 2} = \bar{u}_j = u_{j - 1 / 2}^+$.

#+LATEX: \end{hidden}

How can we improve the accuracy of that approximation?

#+LATEX: \begin{hidden}
Include more cells in the *reconstruction* of the state $u_{j + 1 / 2}^{\pm}$.
#+LATEX: \end{hidden}

*** Increasing Spatial Accuracy

/Temporary Assumptions:/
- $f' (u) \ge 0$
- $f^*_{j + 1 / 2} (u^-,u^+)= f (u^-)$ (e.g. Godunov in this situation)

\medskip
Reconstruct $u_{j + 1 / 2}$ using $\{ \bar{u}_{j - 1}, \bar{u}_j, \bar{u}_{j + 1} \}$. Accuracy? Names?
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  u^{-, (1)}_{j + 1 / 2} & = & \frac{1}{2} (\bar{u}_j + \bar{u}_{j + 1}), \qquad \text{(2nd order central)}\\
  u^{-, (2)}_{j + 1 / 2} & = & \frac{3}{2} \bar{u}_j - \frac{1}{2} \bar{u}_{j - 1},
  \qquad \text{(2nd order upwind)}
\end{eqnarray*}
#+LATEX: \end{hidden}

Compute fluxes, use increments over cell average:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{equation*}
  f^{*,(1)}_{j + 1 / 2} = f \big( \bar{u}_j + \underbrace{\frac{1}{2}
  (\bar{u}_{j + 1} - \bar{u}_j)}_{\tilde{u}_j^{(1)}} \big),
  \qquad
  f^{*,(2)}_{j + 1 / 2} = f \big( \bar{u}_j + \underbrace{\frac{1}{2}
  (\bar{u}_j - \bar{u}_{j - 1})}_{\tilde{u}_j^{(2)}} \big) .
\end{equation*}
#+LATEX: \end{hidden}

*** Demos: Spatial Accuracy

- \demolink{fv-hyperbolic}{Higher-Order Reconstruction}
- \demolink{fv-hyperbolic}{Finite Volume Burgers} (Part II)

*** Lax-Wendroff

Another scheme for high-order. For $u_t + au_x$, from finite difference:
\[ f^{\ast} (u^-, u^+) = \frac{au^- + au^+}{2} - \frac{a^2}{2} \cdot
   \frac{\Delta t}{\Delta x} (u^+ - u^-) . \]
Taylor in time: $u_{\ell + 1} = u_{\ell} + \partial_t u_{\ell} \cdot h_t +
\partial_t^2 u_{\ell} \cdot h_t^2 / 2 + O (h_t^3)$.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  u_t & = & - f (u)_x,\\
  u_{t t} & = & - f (u)_{x t} = - (f (u)_t)_x = - (f' (u) u_t)_x = (f' (u) f
  (u)_x)_x .
\end{eqnarray*}
#+LATEX: \end{hidden}
Then use central differences to discretize derivatives:
\begin{multline*}
   \frac{u_{j, \ell + 1} - u_{j, \ell}}{h_t} + \frac{f (u_{j + 1, \ell}) - f
   (u_{j - 1, \ell})}{2 h_x} \\
   = \frac{h_t}{2 h_x} \left[
   f' (u_{j + 1 / 2, \ell}) \frac{f (u_{j + 1, \ell}) - f (u_{j, \ell})}{h_x}
   - f' (u_{j - 1 / 2, \ell}) \frac{f (u_{j, \ell}) - f (u_{j - 1, \ell})}{h_x} \right]
\end{multline*}
\[\text{As Riemann solver: } f^{\ast} (u^-, u^+) = \frac{f (u^-) + f (u^+)}{2} - \frac{h_t}{h_x} [f'
   (u^{\circ}) (f (u^+) - f (u^-))] . \]
*** Monotone Schemes

**** Monotone Scheme
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
A scheme
\begin{eqnarray*}
  u_{j,\ell + 1} & = & u_{j,\ell}
  - \lambda (
    f^* (u_{j - p}, \ldots, u_{j + q})
    - f^* (u_{j - p - 1}, \ldots, u_{j + q - 1}))\\
  & =: & G (u_{j - p - 1}, \ldots, u_{j + q})
\end{eqnarray*}
is called a *montone scheme* if $G$ is a monotonically nondecreasing
function $G (\uparrow, \uparrow, \ldots, \uparrow)$ of each argument.

*** Monotonicity for Three-Point Schemes
Three-Point Scheme:
\[ G (u_{j - 1}, u_j, u_{j + 1}) = u_j - \lambda [f^* (u_j, u_{j + 1}) -
   f^* (u_{j - 1}, u_j)] . \]
When is this monotone?
#+LATEX: \begin{hidden}
If $f^* (\uparrow, \downarrow)$, then $G (\uparrow, ?,
\uparrow)$. To clean up the second argument, consider
\[ \frac{\partial G}{\partial u_j} = 1 - \lambda [\underbrace{f^*_1 -
   f^*_2}_{\ge 0}] \ge 0. \]
(The subscripts indicate partial derivatives with respect to the first and second argument.)

\medskip
If $\lambda (f^*_1 - f^*_2) \le 1$, then $G (\uparrow, \uparrow, \uparrow)$.

\medskip
*Note:* Also obtain a time-step restriction.
#+LATEX: \end{hidden}
*** Lax-Friedrichs is Monotone

\[ f^{\ast} (u^{_-}, u^+) = \frac{f (u^-) + f (u^+)}{2} - \frac{\alpha}{2}
   (u^+ - u^-) . \]

Show: This is monotone.
#+LATEX: \begin{hidden}
Let $\alpha = \max_u |f' (u)|$.
\begin{eqnarray*}
  f^*_1 & = & \frac{1}{2} [f' (u^-) + \alpha] \ge 0,\\
  f^*_2 & = & \frac{1}{2} [f' (u^+) - \alpha] \le 0.
\end{eqnarray*}
So $f^* (\uparrow, \downarrow)$. Assume $h_t$ is chosen
small enough so that $\lambda (f^*_1 - f^*_2) \le 1$ is
satisfied.
#+LATEX: \end{hidden}
*** Monotone Schemes: Properties

**** Good properties of monotone schemes
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

# - $u_j \le v_j$ for all $j$ (``$u \le v$'') implies $G (u)_j \le G (v)_j$ for all $j$.
- *Local maximum principle*:
  \[ \min_{i \in \text{stencil around } j} u_i \le G (u)_j \le
  \max_{i \in \text{stencil around } j} u_i . \]
- *\(L^1\)-contraction*:
  \[ \norm{G (u) - G (v)}_{L^1} \le \norm{u - v}_{L^1} . \]
- *TVD*:
  \[ TV(G (u))\le TV(u). \]
- Solutions to monotone schemes satisfy \emph{all} entropy conditions.

*** Godunov's Theorem

**** Godunov, see also [[https://doi.org/10.1002/cpa.3160290305][Harten/Hyman/Lax/Keyfitz `76]]
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:
Monotone schemes are at most first-order accurate.

**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:



What now?
#+LATEX: \begin{hidden}
Maybe relax this condition? Maybe only ask for TVD?
#+LATEX: \end{hidden}

*** Linear Schemes

**** Linear Schemes
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
A scheme is called a *linear scheme* if it is linear when applied
to a linear PDE:
\[ u_t + au_x = 0, \]
where $a$ is a constant.
**** End def
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

Write the general case of a linear scheme for \(u_t + u_x = 0\):
#+LATEX: \begin{hidden}

\[ u_{j,\ell + 1} = \sum_{k = - K}^K c_k (\lambda) u_{j - k,\ell}, \]
where $c_k (\lambda)$ are constants which may depend on $\lambda = h_t/
h_x$. Such a linear scheme is monotone iff
\(c_k (\lambda) \ge 0\) for all $k$.

\medskip
Also called *positive schemes*.
#+LATEX: \end{hidden}
*** Linear + TVD = ?

**** TVD for linear Schemes
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

For linear schemes, TVD $\Rightarrow$ monotone.

**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

What does that mean?
#+LATEX: \begin{hidden}
Linear TVD schemes are at most first order accurate.
#+LATEX: \end{hidden}

Now what?
#+LATEX: \begin{hidden}
Not all bad: Implies that /nonlinear/ TVD schemes at least stand a chance.
#+LATEX: \end{hidden}

*** Harten's Lemma
**** Harten's Lemma
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:
If a scheme can be written as
\[ \bar{u}_{j,\ell + 1} = \bar{u}_{j,\ell} + \lambda (C_{j + 1 / 2} \Delta_+ \bar{u}_j -
   D_{j - 1 / 2} \Delta_- \bar{u}_j) \]
with $C_{j + 1 / 2} \ge 0$, $D_{j + 1 / 2} \ge 0$, $1 - \lambda
(C_{j + 1 / 2} + D_{j + 1 / 2}) \ge 0$ and $\lambda = h_t /
h_x$, then it is TVD.
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

As a matter of notation, we have
\begin{eqnarray*}
  \Delta_+ u_j & = & u_{j + 1} - u_j,\\
  \Delta_- u_j & = & u_j - u_{j - 1} .
\end{eqnarray*}
We have omitted the time subscript for the time level $\ell$.

*** Harten's Lemma: Proof
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  \Delta_+ \bar{u}_{j,\ell + 1} & = &
  \Delta_+ \bar{u}_{j,\ell} + \lambda \Delta_+ \big (C_{j + 1 / 2} \Delta_+ \bar{u}_j -
   D_{j - 1 / 2} \Delta_- \bar{u}_j\big )\\
  %%%%%%%%%%%%%%%%%%%
  & =&
  \Delta_+ \bar{u}_{j,\ell}
  + \lambda \big(C_{j + 3 / 2} \Delta_+ \bar{u}_{j + 1} - D_{j + 1 / 2} \underbrace{\Delta_+ \bar{u}_j}_{=\Delta_- \bar{u}_{j+1}} \\
  && - C_{j + 1 / 2} \Delta_+ \bar{u}_j + D_{j - 1 / 2} \Delta_- \bar{u}_j\big)\\
  %%%%%%%%%%%%%%%%%%%
  & = & [1 - \lambda (C_{j + 1 / 2} + D_{j + 1 / 2})] \Delta_+ \bar{u}_j \\
  & &+ \lambda C_{j + 3 / 2} \Delta_+ \bar{u}_{j + 1} + \lambda D_{j - 1 / 2}
  \Delta_- \bar{u}_j .\\
  \abs{ \Delta_+ \bar{u}_{j,\ell + 1} } & \stackrel{C,D,\dots\ge 0}{\le} &
  [1 - \lambda (C_{j + 1 / 2} + D_{j + 1 / 2})] | \Delta_+ \bar{u}_j |  \\
  && + \lambda \underbrace{C_{j + 3 / 2} | \Delta + \bar{u}_{j + 1} |}_{C_{j' + 1 / 2} | \Delta_+ \bar{u}_{j'} |}
  + \lambda \underbrace{D_{j - 1 / 2} | \Delta_- \bar{u}_j |}_{D_{j'' + 1 / 2} | \Delta_+ \bar{u}_{j''} |} .\\
  %%%%%%%%%%%%%%%%%%%
  \tmop{TV} (\bar{u}_{\ell + 1}) &=&
  \sum_j | \Delta_+ \bar{u}_{j,\ell + 1} | \le \sum_j \big[1 - \lambda (C_{j + 1 / 2} + D_{j + 1 / 2}) \\
  &&+ \lambda C_{j + 1 / 2} + \lambda D_{j + 1 / 2}\big] | \Delta_+ \bar{u}_j |
  \le \tmop{TV} (u_{\ell}).
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Minmod Scheme

Still assume $f'(u)\ge 0$.
\begin{equation*}
  f^{*,(1)}_{j + 1 / 2} = f \big( \bar{u}_j + \underbrace{\frac{1}{2}
  (\bar{u}_{j + 1} - \bar{u}_j)}_{\tilde{u}_j^{(1)}} \big),
  \qquad
  f^{*,(2)}_{j + 1 / 2} = f \big( \bar{u}_j + \underbrace{\frac{1}{2}
  (\bar{u}_j - \bar{u}_{j - 1})}_{\tilde{u}_j^{(2)}} \big) .
\end{equation*}
Design a `safe' thing to use for $\tilde u$:
#+LATEX: \begin{hidden}
\begin{equation*}
   \operatorname{minmod} (a, b) \assign \begin{cases}
     a & |a| < |b|, ab > 0,\\
     b & |b| < |a|, ab > 0,\\
     0 & ab \le 0,
   \end{cases}
   \qquad
   \tilde{u}_j \assign \tmop{minmod} (\tilde{u}_j^{(1)}, \tilde{u}_j^{(2)}).
\end{equation*}
*Intuition:* TV growth driven by local extrema

$\to$ if slopes have different signs, revert to first order.

\medskip
Then consider \( f^{*,(3)}_{j + 1 / 2} = f (\bar{u}_j + \tilde{u}_j)\).
Called a *slope limiter*.
#+LATEX: \end{hidden}

*** Minmod is TVD
Show that Minmod is TVD:

#+LATEX: \begin{hidden}
Rewrite
\begin{equation*}
  \bar{u}_{j,\ell + 1} = \bar{u}_j - \lambda [f (\bar{u}_j + \tilde{u}_j) - f
  (\bar{u}_{j - 1} + \tilde{u}_{j - 1})] = \bar{u}_j - \lambda [- D_{j - 1 /
  2} \Delta_- \bar{u}_j],
\end{equation*}
with
\begin{eqnarray*}
  D_{j - 1 / 2} 
  & = & \frac{f (\bar{u}_j + \tilde{u}_j) - f (\bar{u}_{j - 1} +
  \tilde{u}_{j - 1})}{\bar{u}_j - \bar{u}_{j - 1}} = f' (\xi) \frac{\bar{u}_j
  - \bar{u}_{j - 1} + \tilde{u}_j - \tilde{u}_{j - 1}}{\bar{u}_j - \bar{u}_{j
  - 1}}\\
  & = & \underbrace{f' (\xi)}_{\ge 0 \text{(by ass.)}} \left[ 1 + \underbrace{\frac{\tilde{u}_j}{\bar{u}_j -
  \bar{u}_{j - 1}}}_{0 \le \cdot \le \frac{1}{2}} -
  \underbrace{\frac{\tilde{u}_{j - 1}}{\bar{u}_j - \bar{u}_{j - 1}}}_{0
  \le \cdot \le \frac{1}{2}} \right] \ge 0.
\end{eqnarray*}
#+LATEX: \end{hidden}
*** Minmod: CFL restriction?
Derive a time step restriction for Minmod.
#+LATEX: \begin{hidden}
\[ D_{j - 1 / 2} \le 3 / 2 f' (\xi) \le \frac{3}{2} \max_u |f' (u) |. \]
Plugging this into the Harten CFL bound gives:
\[ 1 - \lambda D_{j - 1 / 2} \ge 1 - \frac{3}{2} \lambda \max_u |f' (u) |
   \ge 0 \Leftarrow \begin{array}{|l|}
     \hline
     \lambda \max_u |f' (u) | \le \frac{2}{3} .\\
     \hline
   \end{array} \]
#+LATEX: \end{hidden}
*** What about Time Integration?
\[ u^{(1)} = u_{\ell} + h_t L (u_{\ell}), \qquad u_{\ell + 1} =
   \frac{u_{\ell}}{2} + \frac{1}{2} (u^{(1)} + h_t L (u^{(1)})) . \]
Above: A version of RK2 with $L$ the ODE RHS. Will this cause wrinkles?
#+LATEX: \begin{hidden}
- $\tmop{TV}(\b u + h_t L (\b u))\le\tmop{TV}(\b u)$ (via Harten's L.)
- TV convex. $TV(\alpha \b u+(1-\alpha) \b v) \le \alpha TV(\b u) +(1-\alpha)TV(\b v)$
\begin{eqnarray*}
  && \tmop{TV} (u_{\ell + 1})
  = \tmop{TV} \left( \frac{u_{\ell}}{2} +
  \frac{1}{2} (u^{(1)} + h_t L (u^{(1)})) \right)\\
  & \le & \frac 12\tmop{TV} \left( u_{\ell} \right) + \frac{1}{2} \tmop{TV} (u^{(1)} + h_t L (u^{(1)}))\\
  & \overset{\text{TVD}}{\le} & \frac 12\tmop{TV} \left( u_{\ell} \right) + \frac{1}{2} \tmop{TV} (u^{(1)}) 
  \overset{\text{TVD}}{\le} \frac 12\tmop{TV} \left( u_{\ell} \right) + \frac{1}{2} \tmop{TV}
  (u_{\ell}) = \tmop{TV} (u_{\ell}).
\end{eqnarray*}

General idea: time steppers out of convex comb. of Fw Euler.

(*SSP* / *Strong-Stability Preserving* Schemes) Above: SSPRK(2,2)
#+LATEX: \end{hidden}
*** Total Variation is Convex

Show: $\tmop{TV}(\cdot)$ is a convex functional.
#+LATEX: \begin{hidden}
With $0\le \alpha \le 1$:
\begin{eqnarray*}
  &  & \tmop{TV} (\alpha u + (1 - \alpha) v)\\
  & \le & \sum_j \abs{\alpha (u_j - u_{j - 1}) + (1 - \alpha) (v_j - v_{j
  - 1})}\\
  & \le & \sum_j \alpha \abs{u_j - u_{j - 1}} + (1 - \alpha) \abs{v_j -
  v_{j - 1}}\\
  & = & \alpha \tmop{TV} (u) + (1 - \alpha) \tmop{TV} (v) .
\end{eqnarray*}
#+LATEX: \end{hidden}
*** TODO Potentially cover Sweby's TVD region and alternative limiters
*** TVD and High Order

Can TVD schemes be high order everywhere? (aside from near shocks)
#+LATEX: \begin{hidden}
#+ATTR_LATEX: :height 3.5cm
Consider $u_t+u_x=0$.
[[./media/tvd-smooth-extrema.pdf]]

Clearly $f'(u)\ne0$ near local max. (otherwise assume) Everything smooth: use derivatives.
According to picture, $u_h-u=O(h^2)$.

Plausibly, then $f(u_h)_x-f(u)_x=f'(u)(u-u_h)_x =O(h)$, yielding first-order accuracy.
See also [Osher/Chakravarthy `84, Lemma 2.3].
#+LATEX: \end{hidden}

*** High Order at Smooth Extrema

- TVB Schemes [Shu `87]
- ENO [Harten/Engquist/Osher/Chakravarthy `87]

  - Define $W_j=w(x_{j+1/2})=\int_{x_{1/2}}^{x_{j+1/2}} u(\xi,t) d\xi=h_x\sum_{i=1}^j\bar u_i$
    - Observe $u_{j+1/2}=w'(x_{j+1/2})$.
    - Approximate by interpolation/numerical differentiation.
  - Start with the linear function $p^{(1)}$ through $W_{j-1}$ and $W_j$
  - Compute [[https://en.wikipedia.org/w/index.php?title=Newton_polynomial&oldid=940058390][divided differences]] on $(W_{j-2}, W_{j-1}, W_j)$
  - Compute divided differences on $(W_{j-1}, W_j, W_{j+1})$
  - Use the one with the smaller magnitude (of the divided differences) to extend $p^{(1)}$ to quadratic
  - (and so on, adding points on the side with the lowest magnitude of the divided differences)


- WENO [Liu/Osher/Chan `94]

** Outlook: Systems and Multiple Dimensions
*** Systems of Conservation Laws

Linear system of hyperbolic conservation laws, $A \in \mathbb{R}^{m \times m}$:
\begin{eqnarray*}
  \b {u}_t + A\b {u}_x & = & \b {0},\\
  \b {u} (x, 0) & = & \b {u}_0 (x) .
\end{eqnarray*}
Assumptions on $A$?

#+LATEX: \begin{hidden}
System is hyperbolic [cf. [[https://people.maths.bris.ac.uk/~maajh/methods/chap1.pdf][Hogg `17]]] if $A$ is diagonalizable with real
eigenvalues.

\medskip
Let $A\b {r}_p = \lambda_p \b {r}_p$ ($p = 1, \ldots, m$). Called
*strictly* hyperbolic if the eigenvalues are distinct. $AR = R \Lambda$.

\medskip
Substitution $\b {v}= R^{- 1} \b {u}$ attains $\b {v}_t +
\Lambda \b {v}_x = 0$, called *characteristic variables*.

\medskip
/Recall:/ Rewrote wave equation in this form early on.
#+LATEX: \end{hidden}

*** Linear System Solution
\[ \b {v}= R^{- 1} \b {u}, \qquad \b {v}_t + \Lambda
   \b {v}_x = 0. \]
Write down the solution.
#+LATEX: \begin{hidden}
\[ u (x, t) = \sum_p \b {r}_p v_p (x - \lambda_p t, 0), \]
where
\[ \b {v} (x, 0) = R^{- 1} \b {u} (x, 0) . \]
#+LATEX: \end{hidden}
What is the impact on boundary conditions? E.g. $(\lambda_p) = (- c, 0, c)$
for a BC at $x = 0$ for $[0, 1]$?
#+LATEX: \begin{hidden}
Can only impose BCs on incoming waves! E.g. only one BC (on $v_3$) at $x = 0$.
#+LATEX: \end{hidden}

*** Characteristics for Systems (1/2)

Consider system $\b {u}_t + \b f (\b {u})_x =\b {0}$. Write in
quasilinear form:
#+LATEX: \begin{hidden}
\[\b {u}_t + A (\b {u}) \b {u}_x =\b {0} \qquad
   \text{with} \quad A (\b {u}) = J_{\b f} (\b {u}).\]
#+LATEX: \end{hidden}
When hyperbolic?
#+LATEX: \begin{hidden}
$A$ diagonalizable w/real eigenvalues. ``Strictly'' hyperbolic for
distinct eigenvalues. Both now *local* properties.
#+LATEX: \end{hidden}

*** Characteristics for Systems (2/2)
What about characteristics/shock speeds?
#+LATEX: \begin{hidden}
- By considering eigenstates: can still define characteristics.

  $m$ characteristics through each point.
- Characteristic locations no longer obey an ODE.
#+LATEX: \end{hidden}

Are values of $\b {u}$ still constant along characteristics?
#+LATEX: \begin{hidden}
No, only the coefficients of the eigenstates are constant along characteristics, and only locally.
#+LATEX: \end{hidden}

*** Shocks and Riemann Problems for Systems
\begin{eqnarray*}
  \b {u}_t + A\b {u}_x & = & \b {0},\\
  \b {u} (x, 0) & = & \begin{cases}
    \b {u}_l & x < 0,\\
    \b {u}_r & x > 0.
  \end{cases}
\end{eqnarray*}
Solution?
(Assume strict hyperbolicity with $\lambda_1 < \lambda_2 < \cdots < \lambda_m$.)
#+LATEX: \begin{hidden}
\[ \b {u}_l = \sum_{p = 1}^m \alpha_p \b {r}_p, \quad
   \b {u}_r = \sum_{p = 1}^m \beta_p \b {r}_p . \qquad
   \text{Then}\quad v_p (x, 0) = \begin{cases}
     \alpha_p & x < 0,\\
     \beta_p & x > 0.
   \end{cases} \]
Let $P (x, t)$ be the maximum value of $p$ for which $x - \lambda_p t > 0$,
then
\[ \b {u} (x, t) = \sum_{p = 1}^{P (x, t)} \beta_p \b {r}_p +
   \sum_{p = P (x, t) + 1}^m \alpha_p \b {r}_p . \]
#+LATEX: \end{hidden}

*** Shock Fans (1/2)

What does the solution look like?
#+LATEX: \begin{hidden}
Fan of values constant between each characteristic.

\bigskip
\begin{tikzpicture}
  \draw [->,thick ] (-3,0) -- (3,0) node [anchor=west] {$x$};
  \draw [thick,->] (0,-1mm) node [anchor=north] {$0$} -- (0,3) node [anchor=west] {$t$};
  \draw (0,0) -- (120:3) node [anchor=west] {$\lambda_1$};
  \draw (0,0) -- (70:3) node [anchor=west] {$\lambda_2$};
  \draw (0,0) -- (50:3) node [anchor=west] {$\lambda_3$};
\end{tikzpicture}
#+LATEX: \end{hidden}

Jump across the characteristic associated with $\lambda_p$?
#+LATEX: \begin{hidden}
\[[\b u] = (\beta_p - \alpha_p) \b {r}_p.\]
#+LATEX: \end{hidden}
*** Shock Fans (2/2)
Do those jumps satisfy Rankine-Hugoniot?
#+LATEX: \begin{hidden}
\[[\b f] = A [\b u] = (\beta_p - \alpha_p) A\b {r}_p = \lambda_p [\b u],\]
where $\lambda_p$ is the propagation speed of the jump.
#+LATEX: \end{hidden}

How can we find intermediate values of $\b {u}$?
#+LATEX: \begin{hidden}
``Split up'' the jump into a sum of jumps:
\[ \b {u}_r -\b {u}_l = (\beta_1 - \alpha_1) \b {r}_1 +
   \cdots + (\beta_m - \alpha_m) \b {r}_m . \]
Use Rankine-Hugoniot as a constraint.

This works much the same way in the nonlinear case.
#+LATEX: \end{hidden}

*** Two Dimensions
\(u_t + f (u)_x + g (u)_y = 0\).
Finite volume methods generalize in principle:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{multline*}
  \frac{d \bar{u}_{i j} (t)}{\tmop{dt}}
  + \frac{1}{h^2} \int_{y_{j - 1 / 2}}^{y_{j + 1 / 2}} f (u (x_{i + 1 / 2}, y, t)) - f (u (x_{i - 1 / 2}, y, t)) d y \\
  + \frac{1}{h^2} \int_{x_{i - 1 / 2}}^{x_{i + 1 / 2}} g (u (x, y_{j + 1 / 2}, t)) - g (u (x, y_{j - 1 / 2}, t)) d x
\end{multline*}
Downside: Stencil full ($n\times n$), not star-shaped (cf. FD)
#+LATEX: \end{hidden}

However:

#+LATEX: \begin{hidden}
- If a method is TVD in two dimensions, it is at most first order accurate
  except in trivial cases. [Goodman/Leveque `85].
- The `reconstruction' idea in complex geometry can become computationally
  expensive at high order.

Later: discontinuous Galerkin (DG) for high order with c. laws.
#+LATEX: \end{hidden}

* Finite Difference Methods for Elliptic Problems                  :noexport:
  :PROPERTIES:
  :RELATE_TREE_SECTION_NAME: fd-elliptic
  :RELATE_TREE_SECTION_OPENED: true
  :END:
* Finite Element Methods for Elliptic Problems
  :PROPERTIES:
  :RELATE_TREE_SECTION_NAME: fe-elliptic
  :RELATE_TREE_SECTION_OPENED: true
  :END:
** tl;dr: Functional Analysis
*** Function Spaces

Consider
\[ f_n (x) = \begin{cases}
     -1 & x \le - \frac{1}{n},\\
     \frac{3 n}{2} x - \frac{n^3}{2} x^3 & - \frac{1}{n} < x < \frac{1}{n},\\
     1 & x \ge 1 / n.
   \end{cases} \]
Converges to the step function. Problem?

#+LATEX: \begin{hidden}
$f_n$ continuous, step function not. Want: limits that preserve smoothness
properties. Limits defined by norms.
#+LATEX: \end{hidden}

*** Norms

**** Norm
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
A *norm* \(\|\cdot \|\) maps an element of a /vector space/ into \([0, \infty )\). It satisfies:

- \(\|x\|= 0 \Leftrightarrow x = 0\)
- \(\|\lambda x\|= | \lambda | \|x\|\)
- \(\|x + y\|\le \|x\|+ \|y\|\) (triangle inequality)

*** Convergence

**** Convergent Sequence
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

\(x_n \to x : \Leftrightarrow \|x_n - x\|\to 0\) (*convergence in norm*)

**** Cauchy Sequence
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

#+LATEX: \begin{hidden}
For all \(\epsilon > 0\) there exists an \(n\) for which \(\|x_\nu  - x_\mu      \|\le \epsilon\) for \(\mu , \nu \ge n\).
#+LATEX: \end{hidden}
**** End def
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

*** Banach Spaces

**** Complete/``Banach'' space
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
#+LATEX: \begin{hidden}
Cauchy \(\Rightarrow\) Convergent
#+LATEX: \end{hidden}
**** End def
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

What's special about Cauchy sequences?
#+LATEX: \begin{hidden}
Limits appear out of thin air. Can be used to construct things.
#+LATEX: \end{hidden}

Counterexamples?
#+LATEX: \begin{hidden}
- $\mathbb Q$ with absolute value
- $C^0$ with $L^2$ norm
#+LATEX: \end{hidden}

*** More on $C^0$

Let $\Omega\subseteq \mathbb R^n$ be open. Is $C^0 (\Omega)$ with $\norm{f}_{\infty} \assign
\sup_{x \in \Omega} | f (x) |$ Banach?

#+LATEX: \begin{hidden}
$f (x) = 1 / x$ clearly satisfies $f \in C^0 (\Omega)$, but its norm is
unbounded, so $\norm{\cdot}_{\infty}$ is not a norm on this space.
#+LATEX: \end{hidden}

Is $C^0 (\bar{\Omega})$ with $\norm{f}_{\infty} \assign \sup_{x \in \Omega} |
f (x) |$ Banach?

#+LATEX: \begin{hidden}
Assume $(f_i)_i$ is Cauchy.

- For each $x$, $(f_i (x))_i$ is Cauchy, so a pointwise limit exists. Call
  that $f$.

- Let $\varepsilon > 0$. There exists $N$ so that $\abs{f_n (x) - f_m (x)} <
  \varepsilon$ for all $n, m \ge N$ and $x \in \bar{\Omega}$. Taking the
  limit $m \rightarrow \infty$ yields $\abs{f_n (x) - f (x)} < \varepsilon$,
  i.e. uniform convergence, forcing $f$ to be continuous.
#+LATEX: \end{hidden}

*** $C^m$ Spaces

Let $\Omega \subseteq \mathbb{R}^n$.

\medskip
Consider a *multi-index* $\b{k}= (k_1, \ldots, k_n)\in\mathbb N_0^n$ and define the symbols
#+LATEX: \begin{hidden}
\[ D^{\b{k}} f = \frac{\partial^{\abs{\b{k}}}}{\partial
   x_1^{k_1} \cdots \partial x_n^{k_n}}, \qquad \abs{\b{k}} = k_1 +
   \cdots + k_n . \]
#+LATEX: \end{hidden}
**** $C^m$ Spaces
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
   C^m (\Omega) &= \left\{ f \in C^0 (\Omega) : D^{\b{k}} f \in C^0
   \text{ for all $\b{k}$ with $\abs{\b{k}} \le m$}
   \right\},\\
   C^{\infty} (\Omega) &= \left\{ f \in C^0 (\Omega) : D^{\b{k}} f \in
   C^0 (\Omega) \text{ for all $\b{k}$} \right\},\\
   C^m_0 (\Omega) &= \left\{ f \in C^m (\Omega) : f \text{ has compact support}
   \right\},
\end{align*}
where *compact support* means that there is a compact (closed and bounded) set
$S \subset \Omega$ for which $f (x) = 0$ if $x \not\in S$.
#+LATEX: \end{hidden}

*** $L^p$ Spaces

Let $1 \le p < \infty$.
**** $L^p$ Spaces
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
\[ L^p (\Omega) \assign \left\{ u : (u : \mathbb{R} \rightarrow \mathbb{R})
   \text{ measurable}, \int_{\Omega} \abs{u}^p d x < \infty \right\}, \]
\[ \norm{u}_p \assign \left( \int_{\Omega} \abs{u}^p d x \right)^{1 / p} . \]

**** $L^\infty$ Space
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
\[ L^{\infty} (\Omega) \assign \left\{ u : (u : \mathbb{R} \rightarrow
   \mathbb{R}), \abs{u (x)} < \infty \text{ almost everywhere} \right\}, \]
\[ \norm{u}_{\infty} = \inf \left\{ C : \abs{u (x)} \le C \text{ almost
   everywhere} \right\} . \]
*** $L^p$ Spaces: Properties

**** Hölder's Inequality
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

For $1 \le p, q \le \infty$ with $1 / p + 1 / q = 1$ and
measurable $u$ and $v$,
#+LATEX: \begin{hidden}
\[ \norm{uv}_1 \le \norm{u}_p \norm{v}_q . \]
#+LATEX: \end{hidden}

**** Minkowski's Inequality (Triangle inequality in $L^p$)
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

For $1 \le p \le \infty$ and $u, v \in L^p (\Omega)$,

#+LATEX: \begin{hidden}
\[ \norm{u + v}_p \le \norm{u}_p + \norm{v}_p . \]
#+LATEX: \end{hidden}

*** Inner Product Spaces

Let $V$ be a vector space.

**** Inner Product
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

An *inner product* is a function $\ip{\cdot}{\cdot} : V \times V \rightarrow
\mathbb{R}$ such that for any $f, g, h \in V$ and $\alpha \in \mathbb{R}$
\begin{eqnarray*}
  \ip{f}{f} & \ge & 0,\\
  \ip{f}{f} & = & 0 \Leftrightarrow f = 0,\\
  \ip{f}{g} & = & \ip{f}{g},\\
  \ip{\alpha f + g}{h} & = & \alpha \ip{f}{h} + \ip{g}{h} .
\end{eqnarray*}
**** Induced Norm
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
\[ \norm{f} = \sqrt{\ip{f}{f}} . \]
*** Hilbert Spaces

**** Hilbert Space
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

An inner product space that is complete under the induced norm.
**** End def
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

Let $\Omega$ be open.

**** $L^2$
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

$L^2(\Omega)$ equals the closure of (set of all limits of Cauchy sequences in)
$C_0^{\infty} (\Omega)$ under the induced norm $\norm{\cdot}_2$.

**** Hilbert Projection (e.g. Yosida `95, Thm. III.1)
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

#+LATEX: \begin{hidden}
Let $M \subseteq V$ be a *closed* subspace of a Hilbert space $V$. For any $u \in V$ there exists a unique $v
\in M$ such that $u = v + w$ with \(w \in M^{\perp}\).
#+LATEX: \end{hidden}
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
\(M^\perp = \left\{ w \in V : \ip{z}{w}_V = 0 \text{ for all $z \in M$} \right\}\).
#+LATEX: \end{hidden}

*** Weak Derivatives
Define the space $L^1_{\tmop{loc}}$ of *locally integrable functions*.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{multline*}
   L^1_{\tmop{loc}} (\Omega) = \bigg\{ u : (u : \mathbb{R} \rightarrow
   \mathbb{R}) \text{ measurable}, \\
   \int_{\Omega} \abs{u (x) \varphi (x)} d x <
   \infty \text{ for every $\varphi \in C_0^{\infty} (\Omega)$} \bigg\}
\end{multline*}
#+LATEX: \end{hidden}

**** Weak Derivative
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

$v \in L^1_{\tmop{loc}} (\Omega)$ is the *weak partial derivative* of $u \in
L^1_{\tmop{loc}} (\Omega)$ of multi-index order $\b{k}$ if
#+LATEX: \begin{hidden}
\[ \int_{\Omega} v \varphi d x = (- 1)^{\abs{\b{k}}} \int_{\Omega}
   uD^{\b{k}} \varphi d x \qquad \text{for all $\varphi \in
   C_0^{\infty} (\Omega)$} . \]
#+LATEX: \end{hidden}

In this case, \(D^{\b{k}}_w u \assign v\).

*** Weak Derivatives: Examples (1/2)

Consider all these on the interval $[- 1, 1]$.

\[f_1 (x) = 4 (1 - x) x\]

#+LATEX: \begin{hidden}
$D_w f_1 (x) = 4 - 8 x$. For (``strongly'') differentiable functions, weak and
strong derivatives coincide.
#+LATEX: \end{hidden}

\begin{equation*}
   f_2 (x) = \begin{cases}
     2 x & x \le 1 / 2,\\
     2 - 2 x & x > 1 / 2.
   \end{cases}
\end{equation*}
#+LATEX: \begin{hidden}
``Kinks'' in the function are allowed (but jumps are not):
\begin{equation*}
   D_w f_2 (x) = \begin{cases}
     2 & x \le 1 / 2,\\
     - 2 & x > 1 / 2.
   \end{cases}
\end{equation*}
#+LATEX: \end{hidden}

*** Weak Derivatives: Examples (2/2)
\begin{equation*}
   f_3 (x) = \sqrt{\frac{1}{2}} -\sqrt{\abs{x-1/2}}
\end{equation*}
#+LATEX: \begin{hidden}
Even cusps are allowed:
\begin{equation*}
   D_w f_3 (x) = \begin{cases}
     \frac{1}{2 \sqrt{1 / 2 - x}} & x < 1 / 2,\\
     - \frac{1}{2 \sqrt{x - 1 / 2}} & x > 1 / 2.
   \end{cases}
\end{equation*}
#+LATEX: \end{hidden}

*** Sobolev Spaces

Let $\Omega \subset \mathbb{R}^n$, $k \in \mathbb{N}_0$ and $1 \le p <
\infty$.

**** \((k, p)\)-Sobolev Norm/Space
     :PROPERTIES:
     :BEAMER_env: definition
     :END:
#+LATEX: \begin{hidden}
\begin{align*}
   \norm{u}_{k, p} &\assign \sqrt[p]{\sum_{\abs{\b{\alpha}} \le k}
   \norm{D^{\b{\alpha}}_w u}_p^p},\\
   \seminorm{u}_{k, p} &\assign \sqrt[p]{\sum_{\abs{\b{\alpha}} = k}
   \norm{D^{\b{\alpha}}_w u}_p^p}.
\end{align*}
\[ W^{k, p} (\Omega) \assign \left\{ u : (u : \Omega \rightarrow \mathbb{R}),
   \norm{u}_{k, p} < \infty \right\} . \]
#+LATEX: \end{hidden}
*** More Sobolev Spaces
$W^{0, 2} ?$
#+LATEX: \begin{hidden}
Equal to $L^2$.
#+LATEX: \end{hidden}

$W^{s, 2}$?
#+LATEX: \begin{hidden}
Also called $H^s$, a Hilbert space, with an induced norm.
From what scalar product?
#+LATEX: \end{hidden}
$H^1_0(\Omega)$?
#+LATEX: \begin{hidden}
Closure of the space $C_0^\infty(\Omega)$ under $\norm{u}_{k, p}$.

The Sobolev way of saying *zero on the boundary*.
#+LATEX: \end{hidden}

** Back to Elliptic PDEs
*** An Elliptic Model Problem

Let $\Omega \subset \mathbb R^n$ open, bounded, $f \in H^1 (\Omega)$.
\begin{eqnarray*}
  - \nabla \cdot \nabla u + u & = & f (x) \quad (x \in \Omega),\\
  u (x) & = & 0 \qquad (x \in \partial \Omega) .
\end{eqnarray*}
Let $V \assign H^1_0 (\Omega)$. Integration by parts?
(Gauss's theorem applied to $a\b{b}$):
#+LATEX: \begin{hidden}
\[ \int_{\Omega} \nabla a \cdot \b{b}+ \int_{\Omega} a \nabla \cdot
   \b{b}= \int_{\Omega} \nabla \cdot (a\b{b}) = \int_{\partial
   \Omega} \hat{\b{n}}\cdot(a\b{b})  . \]
#+LATEX: \end{hidden}
Weak form?
#+LATEX: \begin{hidden}
Multiply by *test function* $v \in V$, integrate by parts:
\[ \int_{\Omega} \nabla u \cdot \nabla v -\underbrace{\int_{\partial \Omega} \hat n \cdot(v \nabla u) }_{=0\;(v\in H^1_0)}+ \int_{\Omega} uv = \int_\Omega fv. \]
#+LATEX: \end{hidden}

*** Motivation: Bilinear Forms and Functionals
\[ \int_{\Omega} \nabla u \cdot \nabla v + \int_{\Omega} uv = \int fv. \]
This is the *weak form* of the strong-form problem. The task is to find
a $u \in V$ that satisfies this for all test functions $v \in V$.

\medskip
Recast this in terms of bilinear forms and functionals:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  a (u, v) & = & \ip{\nabla u}{\nabla v} + \ip{u}{v},\\
  g (v) & = & \ip{f}{v},
\end{eqnarray*}
where $\ip{\cdot}{\cdot}$ is the $L^2$ inner product. Then the weak form is
equivalent to
\[ a (u, v) = f (v) \qquad \text{for all $v \in V$} . \]
This motivates further study of Hilbert spaces and objects in them.
#+LATEX: \end{hidden}

*** Dual Spaces and Functionals

**** Bounded Linear Functional

Let $\left( V, \norm{\cdot} \right)$ be a Banach space. A *linear functional*
is a linear function $g : V \rightarrow \mathbb{R}$. It is *bounded*
($\Leftrightarrow$ continuous) if there exists a constant $C$ so that
\( \abs{g (v)} \le C \norm{v}\) for all $v \in V$.
**** Dual Space

Let $\left( V, \norm{\cdot} \right)$ be a Banach space. Then the *dual space*
$V'$ is the space of bounded linear functionals on $V$.

**** Dual Space is Banach (cf. e.g. Yosida `95 Thm. IV.7.1)

$V'$ is a Banach space with the *dual norm*
#+LATEX: \begin{hidden}
\[ \norm{g}_{V'} = \sup_{v \in V \setminus \{ 0 \}} \frac{\abs{g
   (v)}}{\norm{v}_V} . \]
#+LATEX: \end{hidden}

*** Functionals in the Model Problem

Is $g$ from the model problem a bounded functional? (In what space?)

#+LATEX: \begin{hidden}
Must use same space as rest of problem: $H^1 (\Omega)$.
\[ \norm{g}_{V'} = \sup_{v \in H^1 \setminus \{ 0 \}}
   \frac{\abs{\ip{f}{v}_{L^2}}}{\norm{v}_{H^1}} \le \frac{\norm{f}_{L^2}
   \norm{v}_{L^2}}{\norm{v}_{L^2} + \norm{D_w v}_{L^2}} \le
   \frac{\norm{f}_{L^2} \norm{v}_{L^2}}{\norm{v}_{L^2}} = \norm{f}_{L^2} \]
using Cauchy-Schwarz. Find: $f \in L^2$ leads to bounded $g$ in $H^1$.
#+LATEX: \end{hidden}

That bound felt loose and wasteful. Can we do better?
#+LATEX: \begin{hidden}
Define *negative-index Sobolev norms*:
\[ \norm{f}_{H^{- 1}} = \sup_{v \in H^1 (\Omega) \setminus \{ 0 \}}
   \frac{\abs{\ip{f}{v}_{L^2}}}{\norm{v}_{H^1}} . \]
Bound (by definition) $\abs{g (v)} \le \norm{f}_{H^{- 1}}
\norm{v}_{H^1}$. Allows $f\in H^{-1}$.
#+LATEX: \end{hidden}

*** Riesz Representation Theorem (1/3)

Let $V$ be a Hilbert space with inner product $\ip{\cdot}{\cdot}$.
**** Riesz
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

Let $g$ be
a bounded linear functional on $V$, i.e. $g \in V'$. Then there exists a
unique $u \in V$ so that
\( g (v) = \ip{u}{v}\) for all $v \in V$.
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
Let $g \in V'$. $N (\cdot)$ below represents the nullspace.

*Case 1.* $N (g) = V$.  $u =
0$ works, unique by scalar product axioms.

*Case 2.* $N (g) \neq V$. Let $w \in N (g)^{\perp} \setminus \{ 0
\}$. Let $\alpha = g (w) \neq 0$.
\[ g \left( \frac{g (v)}{\alpha} w \right) = \frac{g (v)}{\alpha} g (w) = g
   (v) \qquad \text{for all $v \in V$} . \]
Let $v\in V$ be arbitrary, and
let $z \assign v - (g (v) / \alpha) w$. (Feel reminded of Gram-Schmidt?) Then
$g (z) = g (v) - g (v) = 0$, i.e. $z \in N (g)$, i.e. $\ip{z}{w}_V = 0$ since
$w \in N (g)^{\perp}$.
#+LATEX: \end{hidden}

*** Riesz Representation Theorem: Proof (2/3)

Have $w \in N (g)^{\perp} \setminus \{ 0 \}$, $\alpha = g (w) \neq 0$, and $z
\assign v - (g (v) / \alpha) w \perp w$.
#+LATEX: \begin{hidden}
\[ 0 = \ip{v - \frac{g (v)}{\alpha} w}{w} \quad \Leftrightarrow \quad
   \ip{\frac{g (v)}{\alpha} w}{w} = \ip{v}{w} \qquad \tmop{for} \tmop{all} v
   \in V. \]
**** Figure
     :PROPERTIES:
     :BEAMER_col: 0.3
     :END:

\begin{tikzpicture}
  \draw (-1,0,-1)  -- (1,0,-1) -- (1,0,1) node [anchor=north] {$N(g)$} -- (-1, 0, 1) --cycle ;
  \draw [thick] (0,0) -- (0,1) coordinate (w) node [anchor=east] {$w$};
  \draw (-0.5,0) coordinate (z) node [anchor=north] {$z$} -- (0.25,1.5) coordinate (v) node [anchor=west] {$v$};

  \draw [dashed] (z) -- (0,0);

  \fill (w) circle (1pt);
  \fill (z) circle (1pt);
  \fill (v) circle (1pt);

\end{tikzpicture}

**** Wrap up existence
     :PROPERTIES:
     :BEAMER_col: 0.7
     :END:
Multiplying by $\alpha / \ip{w}{w}$ yields
\[ g (v) = \ip{v}{\underbrace{\frac{\overbrace{g (w)}^{=\alpha}}{\ip{w}{w}_V} w}_{u \assign}} . \]
**** End col
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
#+LATEX: \end{hidden}
*** Riesz Representation Theorem: Proof (3/3)

Uniqueness of $u$?
#+LATEX: \begin{hidden}
Suppose we have two: $u$ and $\hat{u}$ so that
\[ g (v) = \ip{u}{v} = \ip{\hat{u}}{v} \quad \Rightarrow \quad \ip{u -
   \hat{u}}{v} = 0 \quad \text{for all $v \in V$}, \]
Plugging in $v = u - \hat{u}$ yields \(u - \hat{u}=0\) by the properties of the
inner product.
#+LATEX: \end{hidden}

*** Back to the Model Problem
\begin{eqnarray*}
  a (u, v) & = & \ip{\nabla u}{\nabla v}_{L^2} + \ip{u}{v}_{L^2}\\
  g (v) & = & \ip{f}{v}_{L^2}\\
  a (u, v) & = & g (v)
\end{eqnarray*}
Have we learned anything about the solvability of this problem?
#+LATEX: \begin{hidden}
In this particular case, observe that $a (u, v) = \ip{u}{v}_{H^1}$. By the
Riesz Representation theorem and knowing that $g$ is a bounded linear
functional in $H^1$, we know that there exists a unique $u$ so that
\[ a (u, v) = \ip{u}{v}_{H^1} = g (v) . \]
#+LATEX: \end{hidden}
*** Poisson

Let $\Omega \subset \mathbb{R}^n$ open, bounded, $f \in H^{- 1} (\Omega)$.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  - \nabla \cdot \nabla u & = & f (x)  \quad (x \in \Omega),\\
  u (x) & = & 0 \qquad (x \in \partial \Omega) .
\end{eqnarray*}
#+LATEX: \end{hidden}
This is called the *Poisson problem* (with Dirichlet BCs).

\medskip
Weak form?
#+LATEX: \begin{hidden}
\[ \underbrace{\int_{\Omega} \nabla u \cdot \nabla vd x}_{a (u, v)} =
   \underbrace{\int_{\Omega} f (x) v (x) d x}_{g (v)} \quad \text{for all $v
   \in V$} . \]
We know that $g$ is a bounded linear functional in $H^1_0$, but $a (u, v)$ is no
longer identical to our inner product. Maybe we can come up with some
conditions that make $a$ `sufficiently similar' to an inner product?
#+LATEX: \end{hidden}

*** Ellipticity

Let $V$ be Hilbert space.

**** \(V\)-Ellipticity

A bilinear form $a (\cdot, \cdot) : V \times V \rightarrow \mathbb{R}$ is
called *coercive* if there exists a constant $c_0 > 0$ so that
#+LATEX: \begin{hidden}
\[ c_0 \norm{u}_V^2 \le a (u, u) \quad \text{for all $u \in V$}, \]
#+LATEX: \end{hidden}
and $a$ is called *continuous* if there exists a constant $c_1 > 0$ so that
#+LATEX: \begin{hidden}
\[ \abs{a (u, v)} \le c_1 \norm{u}_V \norm{v}_V \quad \text{for all $u,
   v \in V$} . \]
#+LATEX: \end{hidden}

If $a$ is both coercive and continuous on $V$, then $a$ is said to be
\(V\)-elliptic.

*** Lax-Milgram Theorem

Let $V$ be Hilbert space with inner product $\ip{\cdot}{\cdot}$.

**** Lax-Milgram, Symmetric Case

Let $a$ be a \(V\)-elliptic bilinear form that is also *symmetric*, and let $g$
be a bounded linear functional on $V$.

Then there exists a unique $u \in V$ so that $a (u, v) = g (v)$ for all $v \in
V$.
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
$a$ defines an inner product $\ip{u}{v}_a = a (u, v)$ on $V$, with linearity
and symmetry trivial, and:

- Show $a(u,u)\ge 0$.

  $a (u, u) \ge c_0 \norm{u}_V^2 \ge 0$ by coercivity,

- Show $a(u,u)=0\Rightarrow u=0$.

  $0 = a (u, u) \ge c_0 \norm{u}_V^2 \ge 0$, i.e. $\norm{u}_V = 0$,
  i.e. $u = 0$.

From the Riesz representation theorem, there exists a unique $u \in V$ so that
\( a (u, v) = \ip{u}{v}_a = g (v)\).
#+LATEX: \end{hidden}
*** Back to Poisson

Can we declare victory for Poisson?

#+LATEX: \begin{hidden}
Continuity of $a$ holds:
\[ \abs{\int_{\Omega} \nabla u \cdot \nabla vd x}
   = \abs{\ip{\nabla u}{\nabla v}_{L^2}}
   \le \norm{\nabla u}_{L^2} \norm{\nabla v}_{L^2}
   \le \norm{u}_{H^1}\norm{v}_{H^1}. \]
However coercivity is less clear:
\[ \int_{\Omega} \nabla u \cdot \nabla ud x \overset{?}{\ge} c_1 \left(
   \int_{\Omega} \nabla u \cdot \nabla ud x + \int_{\Omega} u^2 d x \right) .
\]
#+LATEX: \end{hidden}
Can this inequality hold in general, without further assumptions?

#+LATEX: \begin{hidden}
No: a constant would violate it.
#+LATEX: \end{hidden}
*** Poincaré-Friedrichs Inequality (1/3)

**** Poincaré-Friedrichs Inequality
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

Suppose $\Omega \subset \mathbb{R}^n$ is bounded and $u \in H^1_0 (\Omega)$.
Then there exists a constant $C > 0$ such that
\[ \norm{u}_{L^2} \le C \norm{\nabla u}_{L^2} . \]
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
Outline: Helpful identity, result in $C^{\infty}_0 (\Omega)$, result in $H^1_0
(\Omega)$.

*A helpful identity.* For $u \in C_0^{\infty} (\Omega)$,
\begin{eqnarray*}
  \nabla \cdot (u^2 \b{x}) & = & \partial_{x_1} (u^2 x_1) + \cdots +
  \partial_{x_n} (u^2 x_n)\\
  & = & u^2 + 2 (u \partial_{x_1} u) x_1 + \cdots + u^2 + 2 (u \partial_{x_n}
  u) x_n\\
  & = & nu^2 + 2 u (\nabla u \cdot \b{x}) .\\
  \Rightarrow \quad u^2 & = & \frac{1}{n} \nabla \cdot (u^2 \b{x}) -
  \frac{2}{n} u (\nabla u \cdot \b{x}) .
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Poincaré-Friedrichs Inequality (2/3)

Prove the result in $C^{\infty}_0 (\Omega)$.
#+LATEX: \begin{hidden}
\begin{eqnarray*}
  \norm{u}_{L^2}^2 & = & \int_{\Omega} u^2 d\b{x}= \int_{\Omega}
  \frac{1}{n} \nabla \cdot (u^2 \b{x}) - \frac{2}{n} u (\nabla u \cdot
  \b{x}) d\b{x}\\
  & = & \frac{1}{n} \int_{\partial \Omega} \underbrace{\hat{\b{n}}
  \cdot (u^2 \b{x})}_0 d s_{\b{x}} - \frac{2}{n} \int_{\Omega} u
  (\nabla u \cdot \b{x}) d\b{x}\\
  & \le & \frac{2}{n} \max_{\b{x} \in \Omega} \abs{\b{x}}
  \int_{\Omega} \abs{u \nabla u} d\b{x} \le \frac{2}{n}
  \max_{\b{x} \in \Omega} \abs{\b{x}} \norm{u}_{L^2}
  \norm{\nabla u}_{L^2}\\
  \Rightarrow \norm{u}_{L^2} & \le & \underbrace{\frac{2}{n}
  \max_{\b{x} \in \Omega} \abs{\b{x}}}_C \norm{\nabla u}_{L^2} .
\end{eqnarray*}
#+LATEX: \end{hidden}
*** Poincaré-Friedrichs Inequality (3/3)

Prove the result in $H^1_0 (\Omega)$.
#+LATEX: \begin{hidden}
Let $u \in H^1_0 (\Omega)$. Since $C_0^{\infty} (\Omega)$ is dense in $H_0^1
(\Omega)$, let $(u_k) \subset C_0^{\infty}$. Then the inequality holds for
each $u_k$, and $\norm{u_k}_{L^2} \rightarrow \norm{u}_{L^2}$ and
$\norm{\nabla u_k}_{L^2} \rightarrow \norm{\nabla u}_{L^2}$.
#+LATEX: \end{hidden}
*** Back to Poisson, Again

Show that the Poisson bilinear form is coercive.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[ \frac{1}{C^2 + 1} \norm{u}_{H^1 (\Omega)}^2 = \frac{1}{C^2 + 1} \left(
   \norm{u}_{L^2 (\Omega)}^2 + \norm{\nabla u}_{L^2}^2 \right) \le
   \norm{\nabla u}_{L^2}^2 = a (u, u) . \]
#+LATEX: \end{hidden}

Draw a conclusion on Poisson:
#+LATEX: \begin{hidden}
Because of coercivity and continuity of $a$, the Poisson weak form admits a
unique solution in $H^1_0 (\Omega)$.
#+LATEX: \end{hidden}

** Galerkin Approximation
*** Ritz-Galerkin

Some key goals for this section:

- How do we use the weak form to compute an approximate solution?
- What can we know about the accuracy of the approximate solution?

Can we pick one underlying principle for the construction of the
approximation?
#+LATEX: \begin{hidden}
Considered: Weak form $a (u, v) = g (v)$ for all $v \in V \subseteq H$, where
$H$ is a Hilbert space. (Think of $V$ as $H^1_0$ for example.)

Idea: Choose a finite-dimensional subspace $V_h \subset V$, find a solution
$u_h\in V_h$ to the weak-form problem
\[ a (u_h, v_h) = g (v_h) \qquad \text{for all $v_h \in V_h$} . \]
This is called *Ritz-Galerkin approximation*.
#+LATEX: \end{hidden}

*** Galerkin Orthogonality
\begin{align*}
  a (u, v) &= g (v) \qquad \text{for all $v \in V$},
  a (u_h, v_h) &= g (v_h) \qquad \text{for all $v_h \in V_h$}.
\end{align*}
Observations?
#+LATEX: \begin{hidden}
Observe that the `continuous' weak form also allows $v_h$ to be plugged in:
\[ a (u, v_h) = g (v_h) \qquad \text{for all $v_h \in V_h$} . \]
Subtracting the two leads to *Galerkin Orthgonality*:
\[ a (u_h - u, v_h) = 0 \qquad \text{for all $v_h \in V_h$}, \]
i.e. using $a (\cdot, \cdot)$ as a (sort of) inner product, the error $u -
u_h$ is orthogonal to the space of test functions.
#+LATEX: \end{hidden}

*** Céa's Lemma

Let $V \subset H$ be a closed subspace of a Hilbert space $H$.

**** Céa's Lemma

Let $a (\cdot, \cdot)$ be a coercive and continuous bilinear form on $V$. In
addition, for a bounded linear functional $g$ on $V$, let $u \in V$ satisfy
\[ a (u, v) = g (v) \qquad \text{for all $v \in V$} . \]
Consider the finite-dimensional subspace $V_h \subset V$ and $u_h \in V_h$
that satisfies
\[ a (u_h, v_h) = g (v_h)  \qquad \text{for all $v_h \in V_h$} . \]
Then
#+LATEX: \begin{hidden}
\[ \norm{u - u_h}_V \le \frac{c_1}{c_0} \inf_{v_h \in V_h} \norm{u - v_h}_V . \]
#+LATEX: \end{hidden}

*** Céa's Lemma: Proof

Recall Galerkin orthgonality:
\( a (u_h - u, v_h) = 0\) for all $v_h \in V_h$. Show the result.

#+LATEX: \begin{hidden}
For any $v_h \in V_h$,
\begin{eqnarray*}
  c_0 \norm{u - u_h}_V^2 & \le & a (u - u_h, u - u_h) \qquad
  \text{(coercivity)}\\
  & = & a (u - u_h, u - v_h) + a (u - u_h, v_h - u_h)\\
  & = & a (u - u_h, u - v_h) \qquad \text{(Galerkin orth.)}\\
  & \le & c_1 \norm{u - u_h}_V \norm{u - v_h}_V .
\end{eqnarray*}
Dividing by $\norm{u - u_h}_V$ completes the proof.
#+LATEX: \end{hidden}

*** Elliptic Regularity

**** $H^s$ Regularity
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

Let $m \ge 1$, $H^m_0 (\Omega) \subseteq V \subseteq H^m (\Omega)$ and $a
(\cdot, \cdot)$ a \(V\)-elliptic bilinear form. The bilinear form
\( a (u, v) = \ip{f}{v}\) for all $v \in V$
is called *$H^s$ regular*, if for every $f \in H^{s - 2 m}$ there
exists a solution $u \in H^s (\Omega)$ and we have with a constant $C (\Omega, a, s)$,
#+LATEX: \begin{hidden}
\[ \norm{u}_{H^s} \le C (\Omega, a, s) \norm{f}_{H^{s - 2 m}} . \]
#+LATEX: \end{hidden}

**** Elliptic Regularity (cf. Braess Thm. 7.2)
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

Let $a$ be a \(H^1_0\)-elliptic bilinear form with sufficiently smooth coefficient
functions.
#+LATEX: \begin{hidden}
- If $\Omega$ is convex, then then Dirichlet problem is $H^2$ regular.

- Let $s \ge 2$. If $\partial \Omega$ is $C^s$, the Dirichlet problem is
  $H^s$ regular.
#+LATEX: \end{hidden}

*** Elliptic Regularity: Counterexamples
Are the conditions on the boundary essential for elliptic regularity?
#+LATEX: \begin{hidden}
**** Figure
     :PROPERTIES:
     :BEAMER_col: 0.2
     :END:

\begin{tikzpicture}
  \draw [fill=black!30] (0,0) ++(0,1) arc  (90:90+135:1) arc (90+135:360:1)-- (0,0) --cycle;
\end{tikzpicture}

**** Description
     :PROPERTIES:
     :BEAMER_col: 0.75
     :END:

Consider $\laplace u=0$, $u(e^{i\phi})=\sin(2/3\phi)$, $u=0$ elsewhere.

- $u(z)=\operatorname{Im}(z^{2/3})$ with $z=x+iy\in\mathbb C$.
- Derivative: $(2/3)z^{-1/3}$: unbounded $\Rightarrow$ $u\not\in H^2$!

**** End col
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
#+LATEX: \end{hidden}

Are there any particular concerns for mixed boundary conditions?
#+LATEX: \begin{hidden}
**** Figure
     :PROPERTIES:
     :BEAMER_col: 0.2
     :END:

\begin{tikzpicture}
  \coordinate (l) at (-1, 0.5);
  \coordinate (r) at (1, 0.5);
  \coordinate (mtop) at (0, 0);
  \coordinate (mbot) at (0, -1);

  \draw [fill=black!30] (l) -- (mtop) -- (r) -- (mbot) --cycle;
  \draw [dashed] (mtop) -- (mbot);
\end{tikzpicture}

**** Description
     :PROPERTIES:
     :BEAMER_col: 0.75
     :END:

Homogeneous Neumann on dashed line with (e.g.) left half, Dirichlet elsewhere.
- Solution could be found by solving on whole domain using reflected Dirichlet BCs.
- Reentrant corner $\Rightarrow$ $u\not\in H^2$ (in gen.)

**** End col
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
#+LATEX: \end{hidden}

*** Estimating the Error in the Energy Norm

Come up with an idea of a bound on $\norm{u - u_h}_{H^1}$.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{multline*}
   \norm{u - u_h}_{H^1}
   \underset{\text{C{\'e}a}}{\le} C \inf_{v_h \in V_h} \norm{u - v_h}_{H^1}
   \le C \norm{u - I_h u}_{H^1}\\
   \underset{\text{TBD}}{\le} C_1 h \norm{u}_{H^2}
   \underset{H^2 \text{ reg.}}{\le} c_2 h \norm{f}_{L^2}.
\end{multline*}
#+LATEX: \end{hidden}
What's still to do?

#+LATEX: \begin{hidden}
- we still need to figure out what $V_h$ will be,
- $I_h$ is some interpolation operator that we will define more precisely
  later, and
- we need to worry about the interpolation error bound (``TBD'')
- Finally, $H^1$ is kind of a weird norm. Can we get an error estimate in
  $L^2$?
#+LATEX: \end{hidden}

*** $L^2$ Estimates

Let $H$ be a Hilbert space with the norm $\norm{\cdot}_H$ and the inner
product $\ip{\cdot}{\cdot}$. (Think: $H=L^2$, $V=H^1$.)

**** Aubin-Nitsche
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

Let $V \subseteq H$ be a subspace that becomes a Hilbert space under the norm
$\norm{\cdot}_V$. Let the embedding $V \rightarrow H$ be continuous. Then we
have for the finite element solution $u \in V_h \subset V$:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[ \norm{u - u_h}_H \le c_1 \norm{u - u_h}_V \sup_{g \in H} \left[
   \frac{1}{\norm{g}_H} \inf_{v_h \in V_h} \norm{\varphi_g - v_h}_V
   \right], \]
#+LATEX: \end{hidden}

if with every $g \in H$ we associate the unique (weak) solution $\varphi_g$ of the
equation (also called the *dual problem*)
#+LATEX: \begin{hidden}
\[ a (w, \varphi_g) = \ip{g}{w} \quad \text{for all $w \in V$}, \]
#+LATEX: \end{hidden}

*** Aubin-Nitsche: Proof

#+LATEX: \begin{hidden}
The norm of an element in a Hilbert space can be determined via the scalar
product:
\(
  \norm{w}_H = \sup_{g \in H} \ip{g}{w}/\norm{g}_H.
\)
\begin{eqnarray*}
  \ip{g}{u - u_h}{}{} & \underset{\text{Def. $\varphi_g$}}{=} & a (u - u_h,
  \varphi_g) \underset{\text{Galerkin orth.}}{=} a (u - u_h, \varphi_g -
  v_h)\\
  & \underset{\text{cont. $a$}}{\le} & c_1 \norm{u - u_h}{}{} _V
  \norm{\varphi_g - v_h}_V .
\end{eqnarray*}
Since this argument is valid for any $v_h \in V_h$, we obtain
\[ \ip{g}{u - u_h} \le c_1 \norm{u - u_h}_V \inf_{v_h \in V_h}
   \norm{\varphi_g - v_h}_V . \]
Plugging into the norm relationship yields
\[ \norm{u - u_h}_H = \sup_{g \in H} \frac{\ip{g}{w}}{\norm{g}_H}
   \le c_1 \norm{u - u_h}_V \sup_{g \in H} \left[
   \frac{1}{\norm{g}_H} \inf_{v_h \in V_h} \norm{\varphi_g - v_h}_V
   \right] . \]
#+LATEX: \end{hidden}

*** $L^2$ Estimates using Aubin-Nitsche

\[ \norm{u - u_h}_H \le c_1 \norm{u - u_h}_V \sup_{g \in H} \left[
   \frac{1}{\norm{g}_H} \inf_{v_h \in V_h} \norm{\varphi_g - v_h}_V
   \right], \]
If $u \in H^1_0 (\Omega)$, what do we get from Aubin-Nitsche?
#+LATEX: \begin{hidden}
As before (e.g. Poisson: symmetry of $a$: *primal* prob. = dual prob.):
\[
  \inf_{v_h \in V_h} \norm{\varphi_g - v_h}_{H^1}
   \le C \norm{\varphi_g - I_h \varphi_g}_{H^1}\\
   \le C_1 h \norm{\varphi_g}_{H^2}
   \le c_2 h \norm{g}_{L^2}.
\]
So
\( \norm{u - u_h}_{L^2} \le Ch \norm{u - u_h}_{H^1}\).
#+LATEX: \end{hidden}

So does Aubin-Nitsche give us an $L^2$ estimate?

#+LATEX: \begin{hidden}
Had (aside from missing pieces):
\( \norm{u - u_h}_{H^1} \le c_2 h \norm{f}_{L^2}\).

If we have $f \in L^2 (\Omega)$ and hence $u \in H^2 (\Omega)$
($H^2$ regularity), then
\[ \norm{u - u_h}_{L^2} \le Ch^2 \norm{f}_{L^2} . \]
#+LATEX: \end{hidden}

** Finite Elements: A 1D Cartoon
*** Finite Elements in 1D: Discrete Form

$\Omega \assign [\alpha, \beta]$. Look for $u \in H^1_0 (\Omega)$, so that $a (u,
\varphi) = \ip{f}{\varphi}$ for all $\varphi \in H^1_0 (\Omega)$. Choose
$V_h = \tmop{span} \{\varphi_1, \ldots, \varphi_n \}$ and expand
\( u_h = \sum_{i = 1}^n u^i_h \varphi_i \in V_h \).
Find the discrete system.
#+LATEX: \begin{hidden}

\[ a \left( \sum_{i = 1}^n u_h^i \varphi_i, \varphi \right) = \ip{f}{\varphi} \quad
   \text{for all } \varphi \in V_h, \]
We may as well choose the basis $(\varphi_i)$ to represent $\varphi \in V_h$:
\[ a \left( \sum_{i = 1}^n u_h^i \varphi_i, \varphi_j \right) = \ip{f}{\varphi_j} \quad
   \text{for all } j \in \{1, \ldots, n\} . \]
This /could/ lead to a linear system $Au = b$, where $A = \{a_{i, j} \} \in
\mathbb{R}^{n \times n}$ with $a_{i, j} = a (\varphi_i, \varphi_j)$, $u = \{u_h^i
\}$, $b_j = \ip{f}{\varphi_j}$, but we choose not to go this route.
#+LATEX: \end{hidden}
*** Grids and Hats

Let $I_i \assign [\alpha_i, \beta_i]$, so that
\( \bar{\Omega} = \bigcup_{i = 0}^N I_i \)
and $I_i^{\circ} \cap I_j = \emptyset$ for $i \neq j$.
Consider a grid
\[ \alpha = x_0 < \cdots < x_N < x_{N + 1} = \beta, \]
i.e. $\alpha_i = x_i$, $\beta_i = x_{i + 1}$ for $i\in\{0,\dots, N\}$. The
$\{x_i \}$ are called *nodes* of the grid. $h_i \assign x_{i + 1} - x_i$
for $i\in\{0,\dots, N\}$ and $h \assign \max_i h_i$. $V_h$? Basis?
#+LATEX: \begin{hidden}
\[ P_h^1 \assign \{v_h \in C^0 (\bar{\Omega}) : \text{for all } i \in \{0, \ldots,
   N\}, v_h |_{I_i} \in \mathbb{P}_1 \}. \]
For $i \in \{0, \ldots, N+1\}$, let
\[ \varphi_i (x) \assign \left\{\begin{array}{ll}
     \frac{1}{h_{i - 1}} (x - x_{i - 1}) & x \in I_{i - 1},\\
     \frac{1}{h_i} (x_{i + 1} - x) & x \in I_i,\\
     0 & \text{otherwise}
   \end{array}\right. \in P^1_h . \]
Observe: The set $\{\varphi_i \}_i$ forms a basis of
$P_h^1$.
#+LATEX: \end{hidden}

*** Degrees of Freedom and Matrices

Define something more general than basis coefficients to solve for.
#+LATEX: \begin{hidden}
- For $i \in \{0, \ldots, N + 1\}$, let $\gamma_i : C (\bar{\Omega}) \rightarrow \mathbb{R}$.

  /Here:/ \(v \mapsto \gamma_i (v) \assign v (x_i) \in \mathbb{R}\).

  /Generally:/ could be derivatives etc. (cf. splines).
- $\{\gamma_i \}_{i=0}^ {N + 1}$ are *global degrees of freedom* in $P_h^1$.
- $\{\gamma_i \}_{i=0}^{N + 1}$ forms a basis of the dual space $(P_h^1)'$.

  (i.e. uniquely determine $\varphi\in V_h$, global *unisolvence*)
#+LATEX: \end{hidden}
Define *shape functions* and assemble the *stiffness matrix*:
#+LATEX: \begin{hidden}
Shape functions $\hat \varphi\in V_h$ satisfy
\(\gamma_j(\hat \varphi_i) =\delta_{i,j}\) for $i,j\in\{0,\dots,N+1\}$.
\begin{equation*}
  a (u_h, \hat \varphi_i) = \ip{f}{\varphi_i}
  \Leftrightarrow\sum_{j = 1}^N \underbrace{\gamma_j(u_h)}_{=u_h^i}
  \underbrace{a (\hat \varphi_j, \hat \varphi_i)}_{(A_h)_{i,j}} = \underbrace{\ip{f}{\varphi_i}}_{(\b b_h)_i}
  (j=1,\dots,N)
\end{equation*}
#+LATEX: \end{hidden}
*** A Matrix Property for Efficiency

\[
(A_h)_{i,j}= a (\hat \varphi_j, \hat \varphi_i).
\]

Anything special about the matrix?
#+LATEX: \begin{hidden}
Only $a_{i, i}, a_{i, i + 1}, a_{i, i - 1} \neq 0$ in the \(i\)th
row of $A$ is nonzero. *Sparse*.
#+LATEX: \end{hidden}

*** Error Estimation

According to Céa, what's our main missing piece in error estimation now?

#+LATEX: \begin{hidden}
An interpolation operator
\begin{eqnarray*}
  I_h^1 : C^0 (\bar{\Omega}) & \rightarrow & P_h^1,\\
  v & \mapsto & \sum_{i = 0}^{N + 1} \gamma_i (v) \hat\varphi_i \in P_h^1 .
\end{eqnarray*}
/Next:/ need to estimate its accuracy.
#+LATEX: \end{hidden}

*** Interpolation Error (1D-only)

For $v \in H^2 (\Omega)$,
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  \norm{v - I_h^1 v}_{L^2} & \le & h^2 \seminorm{v}_{H^2} \quad
  \text{for all $h > 0$},\\
  \seminorm{(v - I_h^1 v)}_{H^1} & \le & h \seminorm{v}_{H^2} \quad
  \text{for all $h > 0$} .
\end{eqnarray*}
#+LATEX: \end{hidden}

If $v \in H^1 (\Omega) \setminus H^2 (\Omega)$,
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  \norm{v - I_h^1 v}_{L^2} & \le & h \seminorm{ v}_{H^1} \quad \text{for
  all $h > 0$},\\
  \lim_{h \rightarrow 0} \seminorm{(v - I^1_h v)}_{H^1} & = & 0.
\end{eqnarray*}
#+LATEX: \end{hidden}
Is $I^1_h$ defined for $v\in H^2$? for $v\in H^1\setminus H^2$?
#+LATEX: \begin{hidden}
Depends on the dimension $n$ and the domain $\Omega$. Need to consider the *Sobolev Embedding Theorem*.
#+LATEX: \end{hidden}
*** Interpolation Error: Towards an Estimate

Provide an *a-priori* estimate.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[ \norm{u - u_h}_{H^1}
  \le \frac{c_1}{c_0} \inf_{v_h \in P^1_h} \norm{u - v_h}_{H^1}
  \le \frac{c_1}{c_0} \norm{u - I_h^1 u}_{H^1}
  \le \frac{c_1}{c_0} h \seminorm{u}_{H^2} . \]
#+LATEX: \end{hidden}

What's the relationship between $I^1_h u$ and $u_h$?
#+LATEX: \begin{hidden}
None!
#+LATEX: \end{hidden}

*** Local-to-Global

Is there a simple way of constructing the polynomial basis?
#+LATEX: \begin{hidden}
The basis functions $\{\varphi_i \}_{i=1}^N$ can be viewed
as a composition of

- grid-independent *reference basis functions* on a *reference element*, and
- geometric transformations from the reference element to the grid.

#+LATEX: \end{hidden}
*** Local-to-Global: Math

Construct a polynomial basis using this approach.

#+LATEX: \begin{hidden}
Let $\hat{\kappa} = [0, 1]$ be the reference interval and consider the affine
transformations $T_I : \hat{x} \in \hat{\kappa} \mapsto x = x_i + \hat{x} h_i$
for $i\in\{0, \dots, N\}$. Define the shape functions
\begin{eqnarray*}
  \hat{\varphi}_0 (\hat{x}) & \assign & 1 - \hat{x} \quad \text{for all }
  \hat{x} \in \hat{\kappa},\\
  \hat{\varphi}_1 (\hat{x}) & \assign & \hat{x} \quad \text{for all } \hat{x}
  \in \kappa .
\end{eqnarray*}
These functions form a basis of $P_1 (\hat{\kappa})$. Then
\[ \varphi_i (x) = \left\{\begin{array}{ll}
     (\hat{\varphi}_1 \circ T_{i - 1}^{- 1}) (x) & x \in [x_{i - 1}, x_i],\\
     (\hat{\varphi}_0 \circ T_i^{- 1}) (x) & x \in [x_i, x_{i + 1}] .
   \end{array}\right. \]
#+LATEX: \end{hidden}
*** Demo

\demolink{fe-elliptic}{Developing FEM in 1D}

*** Going Higher Order

$\Omega \subset \mathbb R$ with a grid as above.

\bigskip
Possible extension:
#+LATEX: \begin{hidden}
\[ P_h^k \assign \{v_h \in C^0 (\bar{\Omega}) : \text{for all } i \in \{1, \ldots,
   N\}, v_h |_{I_i} \in \mathbb{P}_k \}. \]
#+LATEX: \end{hidden}
**** Higher Order Approximation

Let $0 \le \ell \le k$. Then for $v \in H^{\ell + 1} (\Omega)$,
#+LATEX: \begin{hidden}
\[ \norm{v - I_h^k v}_{L^2} + h \seminorm{(v - I_h^k v)}_{H^1}
  \le Ch^{\ell + 1} \seminorm{ v}_{H^{\ell + 1}} . \]
#+LATEX: \end{hidden}
*** High-Order: Degrees of Freedom

Define some *degrees of freedom* (or *DoFs*) for high-order 1D FEM.
#+LATEX: \begin{hidden}
Let $\{\gamma_j \}_{j=0}^{N+1} \in (V_h^1)'$ be the linear
functionals so that
\[ \gamma_j (v_h) = v_h (x_j) \quad \text{for all } v_h \in V_h^1 . \]
Using terminology from classical mechanics, these functions are called
*(global) degrees of freedom*. The functions $\{\varphi_i \}_{i=0}^{N+1}$
that are defined so that
\[ \gamma_j (\varphi_i) = \delta_{i, j} \quad (i,j\in\{0,\dots,N+1\}, \varphi_i \in V_h^1) \]
holds are called *(global) shape functions*. One can also define *local shape
functions* on the reference element.
#+LATEX: \end{hidden}

*** High-Order: Local Basis

Define local form functions for high-order 1D FEM.
#+LATEX: \begin{hidden}
The local form functions are typically chosen to be Lagrange polynomials:
\[ \hat{\varphi}_i^k (\hat{x}) = \frac{\prod_{j = 0, j \neq i}^k (\hat{x} -
   \hat{x}_j)}{\prod_{j = 0, j \neq i}^k (\hat{x}_i - \hat{x}_j)}, \]
where $\hat{x}_j = j / k$ for $i=0,\dots,k$.

$x_{i, j} \assign x_i + (j / k) h_i$ for $i=0,\dots,N$ and $j=0,\dots,k - 1$, further $x_{N + 1, 0} = 0$. Then
\[ \dim (V_h^k) = k (N + 1) + 1. \]
#+LATEX: \end{hidden}
*** High-Order: Global Basis
Obtain the global shape functions for high-order 1D FEM.
#+LATEX: \begin{hidden}
Define
\[ \varphi_{i, 0} (x) \assign \left\{\begin{array}{ll}
     \hat{\varphi}_k^k \circ T_{i - 1}^{- 1} (x) & x \in [x_{i - 1}, x_i],\\
     \hat{\varphi}_0^k \circ T_i^{- 1} (x) & x \in [x_i, x_{i + 1}],\\
     0 & \text{otherwise,}
   \end{array}\right. \]
and
\[ \varphi_{i, j} (x) \assign \left\{\begin{array}{ll}
     \hat{\varphi}_j^k \circ T_i^{- 1} (x) & x \in [x_i, x_{i + 1}],\\
     0 & \text{otherwise} .
   \end{array}\right. \]
for $j=0,\dots,k - 1$ und $i=0,\dots,N$.
#+LATEX: \end{hidden}

** Finite Elements in 2D
*** A Boundary Value Problem
Consider the following elliptic PDE
\begin{align*}
  - \nabla \cdot \left( \kappa\left(\b{x} \right) \nabla u \right) &= f\left(\b{x}\right)
    \quad \text{for $\b x \in \Omega \subset {\mathbb R}^2$},\\
  u\left(\b{x}\right) &= 0 \quad \mbox{when} \quad \b{x} \in \partial \Omega.
\end{align*}
Weak form?
#+LATEX: \begin{hidden}
Multiply by a test function $v\in H^1_0(\Omega)$ and integrate by parts:
\begin{align*}
  \int_{\Omega} \left[ - \nabla \cdot \left( \kappa\left(\b{x} \right) \nabla u \right) - f\left(\b{x}\right) \right] \, v \, \mathrm{d}\b{x} &= 0\\
  \Leftrightarrow
  -\int_{\partial \Omega} v \left[ \kappa \widehat{\b{n}} \cdot \nabla u \right] \, \mathrm{d} \Gamma + \int_{\Omega} \left[ \kappa\left(\b{x} \right) \nabla u \cdot  \nabla v  - f\left(\b{x}\right) v \right] \, \mathrm{d}\b{x} &= 0.
\end{align*}
The boundary integral vanishes since $v\in H^1_0$ and we find
\[  \int_{\Omega} \kappa\left(\b{x} \right) \nabla u \cdot  \nabla v  \, \mathrm{d}\b{x} = \int_{\Omega} f\left(\b{x}\right) v  \, \mathrm{d}\b{x}. \]
#+LATEX: \end{hidden}

*** Weak Form: Bilinear Form and RHS Functional
Hence the problem is to find $u \in V$, such that
\[a\left(u,v\right) = g\left(v\right), \quad\text{for all $v \in V=H^1_0(\Omega)$}\]
where\dots
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
  a\left(u,v\right) &:= \int_{\Omega} \kappa\left(\b{x} \right) \nabla u \cdot  \nabla v  \, \mathrm{d}\b{x},\\
  g\left(v\right) &:= \int_{\Omega} f\left(\b{x}\right) v  \, \mathrm{d}\b{x},
\end{align*}

#+LATEX: \end{hidden}
Is this symmetric, coercive, and continuous?
#+LATEX: \begin{hidden}
- Symmetric: yes.
- Coercive: When there exists $c$ so that $0<c\le \kappa(\b x)$ for all $\b x$.
- Continuous: When there exists $C$ so that $\kappa(\b x)\le C <\infty$ for all $\b x$.
#+LATEX: \end{hidden}

*** Energy Functional :noexport:

Differentiating the energy functional,
\[ \frac{\mathrm{d}}{\mathrm{d} \tau} J\left(u + \tau v \right) \bigr|_{\tau=0}  = \frac{1}{2} a\left(u,v\right) + \frac{1}{2} a\left(v,u\right) - g\left(v\right), \]
using symmetry of $a\left(\cdot,\cdot\right)$, and equating the derivative with zero,
\[ a\left(u,v\right) - g\left(v\right) = 0. \]
Hence, for $u$ to be a stationary point, this must be true for all $v \neq 0$.  If we compute the second directional-derivative,
\[ \frac{\mathrm{d}^2}{\mathrm{d} \tau^2} J\left(u + \tau v \right) \bigr|_{\tau=0}  = a\left(v,v\right), \]
we can conclude that $u$ is a local and global minimizer if  $a\left(\cdot,\cdot\right)$ is continuous and coercive,
\[ a\left(v,v\right) > 0 \quad \forall v \in V \; \mbox{with} \; v \neq 0 \]
*** Triangulation: 2D

Suppose the domain is a union of triangles $E_m$, with vertices $x_i$.

\input{media/unstructuredmesh.tex}
#+BEGIN_CENTER
\begin{tikzpicture}
  \meshnodes
  \meshtris
  %\drawnodenames
  \node [left=1cm of d] {$\Omega$};
  \draw [fill=blue!30] (c) -- (n) -- (g) ;
  \node [below=5mm of g,xshift=-5mm] (ellabel) {$E_m$};
  \draw [thick,->,shorten >=5mm] (ellabel) -- (c) ;
\end{tikzpicture}
#+END_CENTER

\[ \bar \Omega = \bigcup_{i=1}^M E_m. \]
*** Elements and the Bilinear Form
If the domain, $\Omega$, can be written as a disjoint union of elements,
$E_k$,
\[ \Omega = \cup_{m=1}^{M} E_m \quad \mbox{with} \quad E_{i}^\circ \cap E_j^\circ = \emptyset \; \mbox{for} \; i \neq j, \]
what happens to $a$ and $g$?
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
  a\left(u,v\right) &= \sum_{m=1}^M \int_{E_m} \kappa\left(\b{x} \right) \nabla u \cdot  \nabla v  \, \mathrm{d}\b{x},\\
  g\left(v\right) &= \sum_{m=1}^M \int_{E_m} q\left(\b{x}\right) v  \, \mathrm{d}\b{x}.
\end{align*}
#+LATEX: \end{hidden}

*** Basis Functions

Expand
\[ u_N\left(\b{x}\right) = \sum_{i = 1}^{N_p} u_i \varphi_i, \]
and plug into the weak form.
#+LATEX: \begin{hidden}
\[ \sum_{j=1}^{N_p} u_j a\left( \varphi_j, \varphi_i \right) = g\left(\varphi_i\right), \quad \text{for $i = 1 \ldots N_p$}. \]
#+LATEX: \end{hidden}

*** Global Lagrange Basis

Approximate solution $u_h$: Piecewise linear on $\Omega$

\input{media/smallermesh.tex}
#+BEGIN_CENTER
\begin{tikzpicture}[
  x={(1.5cm,0cm)},y={(-0.7071*0.75cm,-0.7071*0.75cm)},z={(0cm,1cm)},
  meshtriangle/.style={line join=round,dashed},
  functriangle/.style={line join=round, fill=blue!50!white},
]
  \meshnodes
  \meshtris
  \nodeloop
    \draw [dotted] (\i) -- (f\i);
  %\nodeloop
    %\node at (\i) {\i};
  \withmeshtris\drawfunctriangle
  \node [left=5mm of c] {$\Omega$};
  \node [left=5mm of fc] {$u_h$};
\end{tikzpicture}
#+END_CENTER

The *Lagrange basis* for $V_h$ consists of piecewise linear $\varphi_i$, with\dots
#+LATEX: \begin{hidden}
\[ \varphi_i\left(\b{x}_i\right) = 1 \quad \mbox{and} \quad \varphi_i \left( \b{x}_j\right) = 0, \quad \mbox{for} \quad i \neq j.\]
#+LATEX: \end{hidden}

*** Basis Functions Features

Features of the basis?
#+LATEX: \begin{hidden}
- For the piecewise linear Lagrange basis, each $\varphi_i$ is continuous on $\Omega$.
- Restricted to $E_m$, each $\varphi_i$ is linear.
#+LATEX: \end{hidden}

#+BEGIN_CENTER
#+BEGIN_EXPORT latex
\begin{tikzpicture}[line join=round,scale=1.5]
  \coordinate (mid) at (1.85, 0, 1.75);
  
  \coordinate (a) at ($ (0.86, 0, 1.46) - (mid) $);
  \coordinate (b) at ($ (1.97, 0, 0.76) - (mid) $);
  \coordinate (c) at ($ (2.68, 0, 1.40) - (mid) $);
  \coordinate (d) at ($ (2.43, 0, 2.64) - (mid) $);
  \coordinate (e) at ($ (1.15, 0, 2.68) - (mid) $);
  
  \coordinate (ofs) at (4,0,0);
  \coordinate (top) at (0,1,0);
  
  \foreach \i/\j in {a/b, b/c, c/d, d/e, e/a}
  {
    \draw [fill=yellow!50!white] (\i) -- (\j) -- (0,0,0) -- cycle;
    \draw (\i) -- (top);
    
    \draw [fill=yellow!50!white]
         ($ (ofs)+0.3*(\i)+0.3*(\j) + (\i) $) coordinate (\i a)
      -- ($ (ofs)+0.3*(\i)+0.3*(\j) + (\j) $) coordinate (\i b)
      -- ($ (ofs)+0.3*(\i)+0.3*(\j) $)  coordinate (\i ctr)
      -- cycle;
  }
  \foreach \i/\j/\col in {a/b/blue, b/c/green, c/d/orange, d/e/gray, e/a/red}
  {
    \coordinate (\i top) at ($ (\i ctr) + (0, 1, 0) $);
    \draw [dotted] (\i top) -- (\i ctr);
    \draw [fill=\col!50!white,opacity=0.5] (\i top) -- (\i a) -- (\i b) -- cycle;
  }
  \draw [dotted] (top) -- (0,0);
  
  \node at ($ 0.4*(ofs) $) {$\to$};
\end{tikzpicture}
#+END_EXPORT
#+END_CENTER

*** Local Basis

What basis functions exist on each triangle?
#+LATEX: \begin{hidden}
On each triangle, $E_m$, we have three non-zero basis functions,
one for each vertex of the triangle:

#+BEGIN_EXPORT latex
\begin{tikzpicture}[scale=0.8]
  \coordinate (a) at (0,0,0);
  \coordinate (b) at (4,0,0);
  \coordinate (c) at (8,0,0);
  
  \coordinate (aa) at ($(a) + (0,0,0)$);
  \coordinate (ab) at ($(a) + (2.5,0,1)$);
  \coordinate (ac) at ($(a) + (2,0,-3)$);
  
  \coordinate (ba) at ($(b) + (0,0,0)$);
  \coordinate (bb) at ($(b) + (2.5,0,1)$);
  \coordinate (bc) at ($(b) + (2,0,-3)$);
  
  \coordinate (ca) at ($(c) + (0,0,0)$);
  \coordinate (cb) at ($(c) + (2.5,0,1)$);
  \coordinate (cc) at ($(c) + (2,0,-3)$);
  
  \coordinate (af) at ($(aa) + (0,0.8,0)$);
  \coordinate (bf) at ($(bb) + (0,0.8,0)$);
  \coordinate (cf) at ($(cc) + (0,0.8,0)$);
  
  \foreach \i in {a,b,c}
  {
    \draw [thick, dashed] (\i a) -- (\i b) -- (\i c) -- cycle;
    
    \node [anchor=north east] at (\i a) {$\b x_1$};
    \node [anchor=north west] at (\i b) {$\b x_2$};
    \node [anchor=south west] at (\i c) {$\b x_3$};
    
    \draw [dotted] (\i\i) -- (\i f);
  }
  
  \draw [fill=blue!50!white] (af) -- (ab) -- (ac) -- cycle;
  \draw [fill=blue!50!white] (ba) -- (bf) -- (bc) -- cycle;
  \draw [fill=blue!50!white] (ca) -- (cb) -- (cf) -- cycle;
  
  \node [anchor=north,yshift=-5mm] at ($ 0.5*(aa) + 0.5 *(ab) $) {$\varphi_1$};
  \node [anchor=north,yshift=-5mm] at ($ 0.5*(ba) + 0.5 *(bb) $) {$\varphi_2$};
  \node [anchor=north,yshift=-5mm] at ($ 0.5*(ca) + 0.5 *(cb) $) {$\varphi_3$};
\end{tikzpicture}
#+END_EXPORT

In the Figure, $\varphi_1\left(\b{x}_1\right) = 1$,
$\varphi_1\left(\b{x}_2\right) = 0$, and $\varphi_1\left(\b{x}_3\right) =
0$.
#+LATEX: \end{hidden}

*** Local Basis Expressions

Write expressions for the *nodal* linear basis in 2D.
#+LATEX: \begin{hidden}
**** Ref element figure
     :PROPERTIES:
     :BEAMER_col: 0.3
     :END:

\begin{tikzpicture}[scale=1.5]
  \draw [->] (-0.2,0) -- (1.2,0)  node [anchor=west] {$r$};
  \draw [->] (0,-0.2) -- (0,1.2)  node [anchor=south] {$s$};
  \draw (1,0.1) -- +(0,-0.2) node [anchor=north] {$1$};
  \draw (0.1,1) -- +(-0.2,0) node [anchor=east] {$1$};
  \draw [thick] (0,0) -- (1,0) -- (0,1) -- cycle;
  \foreach \i in {0,...,1}
    \foreach \j in {0,...,\i}
      \fill (\i-\j,\j) circle (2pt);
  \node at (0,0) [anchor=south west] {$\varphi_1$};
  \node at (1,0) [anchor=south west] {$\varphi_2$};
  \node at (0,1) [anchor=south west] {$\varphi_3$};
\end{tikzpicture}
**** Basis
     :PROPERTIES:
     :BEAMER_col: 0.6
     :END:

- $\varphi_1(r,s) =1-r-s$
- $\varphi_2(r,s) =r$
- $\varphi_3(r,s) =s$
**** End col
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
#+LATEX: \end{hidden}

*** Higher-Order, Higher-Dimensional Simplex Bases

What's an \(n\)-simplex?
#+LATEX: \begin{hidden}
$r_i\ge 0$, $\sum r_i \le 1$. ($\to$ [[https://en.wikipedia.org/wiki/Barycentric_coordinate_system][barycentric]]) Interval, $\triangle$, tetrahedron, \dots
#+LATEX: \end{hidden}

Give a higher-order polynomial space on the \(n\)-simplex:
#+LATEX: \begin{hidden}
\[
P^N:=\operatorname{span}\left\{\prod_{i=1}^d x_i^{n_i}:\sum n_i\le N\right\}
\]
#+LATEX: \end{hidden}

Give nodal sets (on the $\triangle$) for  $P^N$ and $\operatorname{dim} P^N$ in general.
#+LATEX: \begin{hidden}
**** Quadratic
     :PROPERTIES:
     :BEAMER_col: 0.2
     :END:

\begin{tikzpicture}[scale=1.15]
  \draw [->] (-0.2,0) -- (1.2,0)  node [anchor=west] {$r$};
  \draw [->] (0,-0.2) -- (0,1.2)  node [anchor=west] {$s$};
  \draw (1,0.1) -- +(0,-0.2) node [anchor=north] {$1$};
  \draw (0.1,1) -- +(-0.2,0) node [anchor=east] {$1$};
  \draw [thick] (0,0) -- (1,0) -- (0,1) -- cycle;
  \foreach \i in {0,...,2}
    \foreach \j in {0,...,\i}
      \fill (\i/2-\j/2,\j/2) circle (1.5pt);
\end{tikzpicture}
**** Quartic
     :PROPERTIES:
     :BEAMER_col: 0.2
     :END:

\begin{tikzpicture}[scale=1.15]
  \draw [->] (-0.2,0) -- (1.2,0)  node [anchor=west] {$r$};
  \draw [->] (0,-0.2) -- (0,1.2)  node [anchor=west] {$s$};
  \draw (1,0.1) -- +(0,-0.2) node [anchor=north] {$1$};
  \draw (0.1,1) -- +(-0.2,0) node [anchor=east] {$1$};
  \draw [thick] (0,0) -- (1,0) -- (0,1) -- cycle;
  \foreach \i in {0,...,4}
    \foreach \j in {0,...,\i}
      \fill (\i/4-\j/4,\j/4) circle (1.5pt);
\end{tikzpicture}
**** Dimensions
     :PROPERTIES:
     :BEAMER_col: 0.6
     :END:

\[\operatorname{dim}P^N=N_p=\frac{(N+1)(N+2)}2\]

Avoiding Runge: e.g. [[https://doi.org/10.1007/s10665-006-9086-6][Warburton `06]]
**** End col
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
#+LATEX: \end{hidden}
*** Finding a Nodal/Lagrange Basis in General
Given a nodal set $(\xi_i)_{i = 1}^{N_p} \subset \hat E$ (where $\hat E$ is the
reference element) and a basis $(\varphi_j)_{j = 1}^{N_p} : \hat E \rightarrow
\mathbb{R}$, find a Lagrange basis.

#+LATEX: \begin{hidden}
Set up a Vandermonde matrix:
\[ V \assign \left[\begin{array}{ccc}
     \varphi_1 (\xi_1) & \cdots & \varphi_{N_p} (\xi_1)\\
     \vdots & \ddots & \vdots\\
     \varphi_1 (\xi_{N_p}) & \cdots & \varphi_{N_p} (\xi_{N_p})
   \end{array}\right] . \]
Then \(\ell_i \assign \sum_{j=1}^{N^p} (V^{- T})_{i, j} \varphi_j \) is a Lagrange basis.
#+LATEX: \end{hidden}

*** Higher-Order, Higher-Dimensional Tensor Product Bases

What's a tensor product element?
#+LATEX: \begin{hidden}
$[0,1]^n\subset \mathbb R^n$. Interval, quad, hexahedron.
#+LATEX: \end{hidden}

Give a higher-order polynomial space on the \(n\)-simplex:
#+LATEX: \begin{hidden}
\[
  Q^N:=\operatorname{span}\left \{\prod_{i=1}^d x_i^{n_i}:\max n_i\le N\right\}
\]
#+LATEX: \end{hidden}

Give the nodal sets (on the quad) for  $Q^N$.
#+LATEX: \begin{hidden}
**** Quadratic
     :PROPERTIES:
     :BEAMER_col: 0.3
     :END:

\begin{tikzpicture}[scale=1.15]
  \draw [->] (-0.2,0) -- (1.2,0)  node [anchor=west] {$r$};
  \draw [->] (0,-0.2) -- (0,1.2)  node [anchor=west] {$s$};
  \draw (1,0.1) -- +(0,-0.2) node [anchor=north] {$1$};
  \draw (0.1,1) -- +(-0.2,0) node [anchor=east] {$1$};
  \draw [thick] (0,0) -- (1,0) -- (1,1) -- (0,1) -- cycle;
  \foreach \i in {0,...,2}
    \foreach \j in {0,...,2}
      \fill (\i/2,\j/2) circle (1.5pt);
\end{tikzpicture}
**** Quartic
     :PROPERTIES:
     :BEAMER_col: 0.3
     :END:

\begin{tikzpicture}[scale=1.15]
  \draw [->] (-0.2,0) -- (1.2,0)  node [anchor=west] {$r$};
  \draw [->] (0,-0.2) -- (0,1.2)  node [anchor=west] {$s$};
  \draw (1,0.1) -- +(0,-0.2) node [anchor=north] {$1$};
  \draw (0.1,1) -- +(-0.2,0) node [anchor=east] {$1$};
  \draw [thick] (0,0) -- (1,0) -- (1,1) -- (0,1) -- cycle;
  \foreach \i in {0,...,4}
    \foreach \j in {0,...,4}
      \fill (\i/4,\j/4) circle (1.5pt);
\end{tikzpicture}
**** End col
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
#+LATEX: \end{hidden}
*** Tensor Product Elements: Lagrange Basis

Lagrange Basis for Tensor Product Elements?
#+LATEX: \begin{hidden}
Can use tensor product of one-dimensional basis $\Rightarrow$ Lower complexity
for this and many other operations.
#+LATEX: \end{hidden}

*** Element Mappings

#+BEGIN_CENTER
\begin{tikzpicture}[scale=0.7]
  \draw (0,-2) -- ++(0,4);

  \begin{scope}[xshift=-2cm]
    \draw (-1,-1) -- (1,-1) -- (-1,1) --cycle;

    \node at (0,-1.5) {$\hat E$};
  \end{scope}

  \begin{scope}[xshift=3cm]
    \draw (-1.8,-1.3) -- (0.35,-1.1) -- (-1.5,0.8) --cycle;

    \node at (0,-1.5) {$E_m$};
  \end{scope}

  \draw [thick,->](-2.5,-0.5)..controls +(1,1) .. (2,-0.5)
  node [pos=0.5,anchor=south] {$T_m$};
\end{tikzpicture}
#+END_CENTER

Construct a mapping $T_m:\hat E\to E_m$. Reference element $\hat E$, global $\triangle$ $E_m$.
#+LATEX: \begin{hidden}
\[ T_m(r,s) = ( \b{x}_2 - \b{x}_1 ) r + ( \b{x}_3 - \b{x}_1 ) s + \b{x}_1 .\]
#+LATEX: \end{hidden}
What is the Jacobian of $T_m$?
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
   J_T = &\begin{bmatrix} \partial x / \partial r & \partial x / \partial s \\ \partial y / \partial r & \partial y / \partial s \end{bmatrix}
  = \left[ \frac{\partial T}{\partial r} \quad \frac{\partial T}{\partial s} \right]\\
  = &[ \begin{array}{rr} (\b{x}_2 - \b{x}_1) & (\b{x}_3 - \b{x}_1) \end{array} ] \in {\mathbb R}^{2 \times 2}.
\end{align*}
#+LATEX: \end{hidden}

*** More on Mappings
Is an affine mapping sufficient for a tensor product element?
#+LATEX: \begin{hidden}
No, because affine mappings preserve parallel lines: Global elements
could only be parallelograms.

*Idea:* Consider a mapping $T_m\in (Q^1)^n$.
#+LATEX: \end{hidden}

How might we accomplish curvilinear elements using the same idea?
#+LATEX: \begin{hidden}
- Use *isoparametric mappings* $T_m\in (P^N)^n$ (if FEM basis is $P^N$)
- Use *subparametric mappings* $T_m\in (P^M)^n$

  ($M<N$ if FEM basis is $P^N$)
- Use *superparametric mappings* $T_m\in (P^M)^n$

  ($M>N$ if FEM basis is $P^N$)
#+LATEX: \end{hidden}

*** Constructing the Global Basis
Construct a basis on the element $E_m$ from the reference basis
$(\hat{\varphi}_j)_{j = 1}^{N_p} : E_m \rightarrow \mathbb{R}$.
#+LATEX: \begin{hidden}
\[ \varphi_{i, j} (\b{x}) = \hat{\varphi}_j (T_m^{- 1} (\b{x})) . \]
#+LATEX: \end{hidden}

What's the gradient of this basis?
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  \nabla_{\b x} \varphi_j (T^{- 1} (\b{x})) & = & \left[
  \frac{d}{d\b{x}} \varphi_j (T^{- 1} (\b{x})) \right]^T\\
  & = & \left[ \left( \frac{d \varphi_j}{d\b{r}} \right)_{T^{- 1}
  (\b{x})} J_T^{- 1} (\b{x}) \right]^T\\
  & = & J_T^{- T} (\b{x}) \nabla_{\b r} \varphi_j (T^{- 1} (\b{x})) .
\end{eqnarray*}
#+LATEX: \end{hidden}

*** Assembling a Linear System

Express the matrix and vector elements in
\[ \sum_{j=1}^{N_p} u_j a( \varphi_j, \varphi_i ) = g(\varphi_i) \quad\text{for $i = 1, \ldots, N_p$}.\]
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
  a(\varphi_i,\varphi_j) &= \sum_{m=1}^M \int_{E_m}
  \kappa(\b{x} ) \nabla \varphi_i \cdot \nabla \varphi_j \,
  \mathrm{d}\b{x},\\
  g(\varphi_i) &= \sum_{m=1}^M \int_{E_m} f(\b{x}) \varphi_i  \, \mathrm{d}\b{x}.
\end{align*}
#+LATEX: \end{hidden}
*** Integrals on the Reference Element

Evaluate
\[\int_{E} \kappa(\b{x}) \nabla_{\b x} \varphi_i ( \b{x} )^T \nabla_{\b x} \varphi_j ( \b{x} ) d\b{x}.\]
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
  &\int_{E} \kappa(\b{x}) \nabla_{\b x} \varphi_i ( \b{x} )^T \nabla_{\b x} \varphi_j ( \b{x} ) d\b{x} \\
 = & \int_{E} \kappa( \b{x} ) ( J_T^{-T} \nabla_{\b r} \varphi_i )^T ( J_T^{-T} \nabla_{\b r} \varphi_j ) d\b{x} \\
 \overset{P^1}{=} & ( J_T^{-T} \nabla_{\b r} \varphi_i )^T ( J_T^{-T} \nabla_{\b r} \varphi_j ) | J_T | \int_{\hat E} \kappa( T( \b{r} ) ) d\b{r}
\end{align*}
#+LATEX: \end{hidden}
And now the RHS functional.
#+LATEX: \begin{hidden}
\[ \int_{E} f(\b{x}) \varphi_i ( \b{x} ) d\b{x} = | J_T |  \int_{\hat E} f(T(\b{r})) \varphi_i ( \b{r} ) d\b{r}. \]
#+LATEX: \end{hidden}

*** Inhomogeneous Dirichlet BCs

Handle an inhomogeneous boundary condition $u(\b x)=\eta(\b x)$ on $\partial \Omega$.
#+LATEX: \begin{hidden}
- Find a  function $u^0\in H^1(\Omega)$ with boundary values
  \( u^0(\b{x}) = \eta(\b{x})\) on $\partial\Omega$. ("*lifted*" from boundary to volume)
- Define \(\hat{u} := u - u^0\in H^1_0(\Omega)\).
- Insert $u = \hat{u} + u^0$ into the weak form:
  \begin{align*}
  a( \hat{u} + u^0 , v ) & = a( \hat{u} , v ) + a( u^0 , v ) = g(v),\\
  a( \hat{u}, v ) &= \underbrace{g(v) - a(u^0,v)}_{\hat g(v):=},
  \end{align*}
  where still $\hat u\in H^1_0$.

Altogether:
- Inhomogeneous BC just leads to extra term on RHS.
- No change in function spaces.
#+LATEX: \end{hidden}

*** Demo

- \demolink{fe-elliptic}{Developing FEM in 2D}
- \demolink{fe-elliptic}{2D FEM Using Firedrake}
- \demolink{fe-elliptic}{Rates of Convergence}

** Approximation Theory in Sobolev Spaces
*** Conditions on the Mesh

Let $\Omega$ be a polygonal domain.

**** Admissibility (Braess, Def. II.5.1)

A partition (*mesh*) $\mathcal{T}= \{ E_1, \ldots, E_M \}$ of $\Omega$
into triangular or quadrilateral *elements* is called *admissible* if

#+LATEX: \begin{hidden}
- $\bar{\Omega} = \bigcup_{i = 1}^M E_i$.

- If $E_i \cap E_j$ consists of exactly one point, then it is a common vertex
  of $E_i$ and $E_j$.

- If $E_i \cap E_j$ consists of more than one point for $i \neq j$, then $E_i
  \cap E_j$ is a common edge of $E_i$ and $E_j$.
#+LATEX: \end{hidden}
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
Give an example of a non-admissible partition.

#+LATEX: \begin{hidden}
One with a *hanging node*.
#+LATEX: \end{hidden}

*** Mesh Resolution, Shape Regularity

**** Diameter
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

#+LATEX: \begin{hidden}
A bounded set $\Omega$ has *diameter*
\(d (\Omega) = \sup \left\{ \abs{x - y} : x, y \in \Omega \right\}\).
#+LATEX: \end{hidden}

**** Mesh Resolution

#+LATEX: \begin{hidden}
When every element of a partition has diameter at most $2 h$, we write
$\mathcal{T}_h$ instead of $\mathcal{T}$.
#+LATEX: \end{hidden}

**** Shape Regularity (Braess, Def. II.5.1)
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

A family of partitions $\{ \mathcal{T}_h \}$ is called *shape regular* if
#+LATEX: \begin{hidden}
there exists a number $\kappa > 0$ so that every $E \in \mathcal{T}_h$
contains a circle of radius $\rho_T$ with $\rho_E \ge h_E / \kappa$,
where $h_T$ is half the diameter of $E$.
#+LATEX: \end{hidden}

*** Cone Conditions

**** Lipschitz Domain
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

A bounded domain $\Omega \subset \mathbb{R}^n$ is called a *Lipschitz domain*
provided that\dots
#+LATEX: \begin{hidden}

for every $x \in \partial \Omega$ there exists a neighborhood of
$x$ within which $\partial \Omega$ can be represented as the graph of a
Lipschitz function.
#+LATEX: \end{hidden}

**** End def
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:
Lipschitz domains satisfy a *cone condition*:

#+LATEX: \begin{hidden}
The interior angles at vertices are positive, so that a cone can be
placed in $\Omega$ with its tip at the vertex.
#+LATEX: \end{hidden}


**** Rellich Selection Theorem (Braess, Thm. II.1.9)
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

Let $m \ge 0$, let $\Omega$ be Lipschitz. Then the imbedding $H^{m + 1}
(\Omega) \rightarrow H^m (\Omega)$ is *compact*, i.e. any bounded sequence in
the range of the imbedding has a convergent subsequence.

*** The Interpolation Operator

**** Interpolation Operator (Braess, Lemma II.6.2)
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

Let $\Omega \subset \mathbb{R}^2$ be Lipschitz. Let $t \ge 2$, and $z_1,
z_2, \ldots, z_s$ are $s \assign t (t + 1) / 2$ prescribed points in
$\bar{\Omega}$ such that the interpolation operator $I : H^t \rightarrow
\mathbb{P}^{t - 1}$ is well-defined. Then there exists a constant $c$ so that
for $u \in H^t (\Omega)$
#+LATEX: \begin{hidden}
\[ \norm{u - Iu}_{H^t} \le c (\Omega, (z_i)) \seminorm{u}_{H^t} . \]
#+LATEX: \end{hidden}

**** Approx. for Congruent $\triangle$ (Braess, Remark II.6.5)
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

Let $E_h \assign h \hat{E}$, i.e. a scaled version of a reference triangle, with
$h \le 1$. Then, for $0 \le m \le t$, there exists a $C$ so
that
#+LATEX: \begin{hidden}
\[ \norm{u - Iu}_{H^m (E_h)} \le Ch^{t - m} \seminorm{u}_{H^t (E_h)} . \]
#+LATEX: \end{hidden}

*** Approximation for Congruent Triangles: Proof (1/2)
Set up a function on $E_h$ and $\hat E$. Work out the scaling for the derivative.
#+LATEX: \begin{hidden}
Let $u \in H^t (E_h)$. Define $v \in H^t (\hat{E})$ by $v (y) \assign u (hy)$.

Then $D_w^{\alpha} v = h^{\abs{\alpha}} D^{\alpha}_w u$ for $\abs{\alpha} \le t$.
#+LATEX: \end{hidden}

Work out the scaling for the Sobolev seminorm.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[ \seminorm{v}_{H^{\ell} (\hat{E})}^2 
   = \sum_{\abs{\alpha} = \ell} \int_{\hat{E}} (D_w^{\alpha} v)^2
   = \sum_{\abs{\alpha} = \ell} \int_{E_h} h^{2 \ell} (D_w^{\alpha} u)^2 h^{- 2} 
   = h^{2 \ell - 2} \seminorm{u}_{H^{\ell} (E_h)}^2 . \]
#+LATEX: \end{hidden}
Work out the scaling for the Sobolev norm. Recall $h\le 1$.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[ \norm{u}_{H^m (E_h)}^2 
  = \sum_{\ell \le m} \seminorm{u}_{H^{\ell} (E_h)}^2 
  = \sum_{\ell \le m} h^{- 2 \ell + 2} \seminorm{v}_{H^{\ell} (E_h)}^2
  \le C' h^{- 2 m + 2} \norm{v}_{H^m (\hat{E})}^2 . \]
#+LATEX: \end{hidden}
*** Approximation for Congruent Triangles: Proof (1/2)
    
\[ \norm{u - Iu}_{H^m (E_h)} \le Ch^{t - m} \seminorm{u}_{H^t (E_h)}
   \quad (0 \le m \le t) \]
- $\seminorm{v}_{H^{\ell} (\hat{E})}^2=\seminorm{u}_{H^{\ell} (E_h)}^2$
- $\norm{u}_{H^m (E_h)}^2 \le C' h^{- 2 m + 2} \norm{v}_{H^m (\hat{E})}^2$
Prove the estimate.
#+LATEX: \begin{hidden}
Inserting $u - Iu$ into this estimate in place of $u$:
\begin{eqnarray*}
  \norm{u - Iu}_{H^m (E_h)} & \le & C' h^{- m + 1} \norm{v - Iv}_{H^m
  (\hat{E})} \le C' h^{- m + 1} \norm{v - Iv}_{H^t (\hat{E})}\\
  & \le & C' ch^{- m + 1} \seminorm{v}_{H^t (\hat{E})} \le C'
  ch^{t - m} \seminorm{u}_{H^t (E_h)} .
\end{eqnarray*}
#+LATEX: \end{hidden}

*** $H^m$ Polynomial Approximation on Meshes

**** Broken Norm
     :PROPERTIES:
     :BEAMER_env: definition
     :END:

Given a partition $\mathcal{T}_h = \{ E_i \}_{i = 1}^M$ and a function $u$
such that $u \in H^m (E_i)$,
#+LATEX: \begin{hidden}
\[ \norm{u}_{H^m, h} \assign \sqrt{\sum_{i = 1}^M \norm{u}^2_{H^m (E_i)}} . \]
#+LATEX: \end{hidden}

**** Approximation Theorem (Braess, Theorem II.6.4)

Let $t \ge 2$, suppose $\mathcal{T}_h$ is a shape-regular triangulation
of $\Omega$. Then there exists a constant $c$ such that, for $0 \le m
\le t$ and $u \in H^t (\Omega)$,
#+LATEX: \begin{hidden}
\[ \norm{u - I_h u}_{H^m, h} \le c (\Omega, \kappa, t) h^{t - m}
   \seminorm{u}_{H^t (\Omega)}, \]
#+LATEX: \end{hidden}
where $I_h$ denotes interpolation by a piecewise polynomial of degree $t - 1$.

** TODO Stranger Elements
** Saddle Point Problems, Stokes, and Mixed FEM
*** Weak Forms as Minimization Problems

Let $V$ be a linear space, and $a : V \times V \rightarrow \mathbb{R}$ a
bilinear form, and $g \in V'$.

**** Solutions of Weak Forms are Quadratic Form Minimizers
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

If $a$ is SPD, then
#+LATEX: \begin{hidden}
\( J (v) \assign \frac{1}{2} a (v, v) - g (v) \)
#+LATEX: \end{hidden}
attains its minimum over $V$ at $u$ iff $a (u, v) = g (v)$ for all $v \in V$.

**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  J (u + tv) & = & \frac{1}{2} a (u + tv, u + tv) - g (u + tv)\\
  & = & J (u) + t [a (u, v) - g (v)] + \frac{t^2}{2} a (v, v) .
\end{eqnarray*}
for $u, v \in V$ and $t \in \mathbb{R}$.

If $u$ satisfies $a (u, v) = g (v)$, $J (u + v) > J (u)$.

If $J$ has a min at $u$, derivative of $t \mapsto J (u + tv)$ must vanish at
$t = 0$.
#+LATEX: \end{hidden}

*** Example: Lagrange Multipliers in $\mathbb{R}^2$
\begin{eqnarray*}
  f (x, y) = x^2 + y^2 & \rightarrow & \min !\\
  g (x, y) = x + y & = & 2
\end{eqnarray*}
Write down the Lagrangian.
#+LATEX: \begin{hidden}

$\mathcal{L} (x, y, \lambda) = f (x, y) + \lambda g (x, y) = x^2 + y^2 +
\lambda (x + y - 2)$.

#+LATEX: \end{hidden}
Write down a necessary condition for a constrained minimum.
#+LATEX: \begin{hidden}
\[
  0=\nabla \mathcal L=\begin{bmatrix}
    \nabla f+\lambda \nabla g\\
    g
  \end{bmatrix}.
\]
#+LATEX: \end{hidden}
*** Saddle Point Problems

$X$, $M$ Hilbert spaces. $a : X \times X \rightarrow \mathbb{R}$ and $b : X
\times M \rightarrow \mathbb{R}$ continuous bilinear forms, $f \in X'$, $g \in
M'$. Minimize
\[ J (u) = \frac{1}{2} a (u, u) - \ip{f}{u} \qquad \text{subject to} \qquad b
   (u, \mu) = \ip{g}{\mu} \quad (\mu \in M) . \]
Apply the method of the Lagrange multipliers.
#+LATEX: \begin{hidden}
\[ \mathcal{L} (u, \lambda) = J (u) + \left[ b (u, \lambda) - \ip{g}{\lambda}
   \right] \quad (\lambda \in M) . \]
\vspace{-3ex}
- $J$ and $\mathcal{L} (\cdot, \lambda)$ agree when constraint is satisfied.

- Idea: Select $\lambda \in M$ to `tweak' $\mathcal{L}$ so that minimizer of
  $\mathcal{L} (\cdot, \lambda)$ satsifies the constraints. (Finite-dim: $-
  \nabla f = J_g^T \b{\lambda}$)

Yields *saddle point problem*: find $(u, \lambda) \in X \times M$ so that
\begin{eqnarray*}
  a (u, v) + b (v, \lambda) & = & \ip{f}{v} \quad (v \in X),\\
  b (u, \mu) & = & \ip{g}{\mu} \quad (\mu \in M) .
\end{eqnarray*}
#+LATEX: \end{hidden}
*** Example: Saddle Point Problem in $\mathbb{R}^2$
\vspace*{-3ex}
\begin{eqnarray*}
  f (x, y) = x^2 + y^2 & \rightarrow & \min !\\
  g (x, y) = x + y & = & 2
\end{eqnarray*}
Lagrangian: $\mathcal{L} (x, y, \lambda) = f (x, y) + \lambda g (x, y) = x^2 + y^2 + \lambda (x + y - 2)$.

\medskip
Show that $x = y = 1$, $\lambda = - 2$ is a saddle point.
#+LATEX: \begin{hidden}
The Hessian has the form
\begin{equation*}
  \mathcal H_{\mathcal L}
  =
  \begin{bmatrix}
     H_f & \nabla g\\
     \nabla g^T & 0
   \end{bmatrix}.
\end{equation*}
\begin{equation*}
  \mathcal H_{\mathcal L}
  =
  \begin{bmatrix}
    A & B^T\\
    B & 0
  \end{bmatrix}
  =
  M
  \begin{bmatrix}
    A \\
      & -BA^{-1}B^T
  \end{bmatrix}
  M^T,
\end{equation*}
demonstrating indefiniteness using [[https://en.wikipedia.org/wiki/Sylvester's_law_of_inertia][Sylvester's Law of Inertia]].

(cf. [[https://doi.org/10.1017/S0962492904000212][Benzi et al. `05]], Section 3.4)
#+LATEX: \end{hidden}
*** Saddle Point Property :noexport:

Assume we have $(u, \lambda) \in X \times M$
\begin{eqnarray*}
  a (u, v) + b (v, \lambda) & = & \ip{f}{v} \quad (v \in X),\\
  b (u, \mu) & = & \ip{g}{\mu} \quad (\mu \in M) .\\
  \mathcal{L} (u, \lambda) & = & \frac{1}{2} a (u, u) - \ip{f}{u} + [b (u,
  \lambda) - \langle g, \lambda \rangle] .
\end{eqnarray*}
Show $\mathcal{L} (u, \lambda) \le \mathcal{L} (u + \tau w, \lambda)$
for $w \in X$, $\tau \in \mathbb{R}$.
#+LATEX: \begin{hidden}
\begin{eqnarray*}
  \mathcal{L} (u + \tau w, \lambda) & = & \frac{1}{2} a (u + \tau w, u + \tau
  w) - \ip{f}{u + \tau w} + [b (u + \tau w, \lambda) - \langle g, \lambda
  \rangle] .\\
  & = & \mathcal{L} (u) + \tau \left( \underbrace{a (u, w) - \ip{f}{w} + b
  (w, \lambda)}_{= 0} \right) + \tau^2 \underbrace{a (w, w)}_{\ge 0} .
\end{eqnarray*}
#+LATEX: \end{hidden}
Show $\mathcal{L} (u, \mu) =\mathcal{L} (u, \lambda)$ for $\mu \in M$.
#+LATEX: \begin{hidden}
\begin{eqnarray*}
  \mathcal{L} (u, \mu) & = & \frac{1}{2} a (u, u) - \ip{f}{u} + [b (u, \mu) -
  \langle g, \mu \rangle] =\mathcal{L} (u, \lambda) .
\end{eqnarray*}
#+LATEX: \end{hidden}
*** Saddle Point Property :noexport:

What is the *saddle point property*?
#+LATEX: \begin{hidden}
- $\mathcal{L} (u, \lambda) \le \mathcal{L} (v, \lambda)$ for $v \in X$.

- $\mathcal{L} (u, \mu) \le \mathcal{L} (u, \lambda)$ for $\mu \in M$.
#+LATEX: \end{hidden}
Showed: Solutions of the saddle point problem satisfy this (relaxed) property.

Can we say that $(u, \lambda)$ satsifying the saddle point property are
solutions of the saddle point problem?

*** Stokes Equation
\begin{eqnarray*}
  \Delta \b{u}+ \nabla p & = & -\b{f} \quad (x \in \Omega),\\
  \nabla \cdot \b{u} & = & 0 \quad (x \in \Omega),\\
  \b{u} & = & \b{u}_0 \quad (x \in \partial \Omega) .
\end{eqnarray*}
What are the pieces?

#+LATEX: \begin{hidden}
- $\b{u}$ is the *velocity field*,

- *$p$* is the pressure,

- $\b{f}$ is an externally applied *force field*,

- Pressure gradient gives rise to an additional force that prevents a density change.

- $\nabla \cdot \b{u}= 0$ is the *incompressibility constraint*:

  Pressure falls/rises where a source/sink would be created.
#+LATEX: \end{hidden}
*** Stokes: Properties
\begin{eqnarray*}
  \Delta \b{u}+ \nabla p & = & -\b{f} \quad (x \in \Omega),\\
  \nabla \cdot \b{u} & = & 0 \quad (x \in \Omega),\\
  \b{u} & = & \b{u}_0 \quad (x \in \partial \Omega) .
\end{eqnarray*}
Can we choose any $\b{u}_0$?
#+LATEX: \begin{hidden}
\[ \int_{\partial \Omega} \b{u}_0 \cdot \hat{\b{n}} d
   S_{\b{x}} = \int_{\partial \Omega} \b{u} \cdot
   \hat{\b{n}} d S_{\b{x}} = \int_{\Omega} \nabla \cdot
   \b{u}d\b{x}= 0 \]
is a *compatibility condition*. Satisfied e.g. for $\b{u}_0 \equiv
\b{0}$.
#+LATEX: \end{hidden}

Does Stokes fully determine the pressure?
#+LATEX: \begin{hidden}
Only up to an additive constant. Additionally demand \( \int_{\Omega} pd x = 0\).
#+LATEX: \end{hidden}
*** Stokes: Variational Formulation
\vspace*{-3ex}
\[ \Delta \b{u}+ \nabla p = -\b{f}, \qquad \nabla \cdot
   \b{u}= 0 \quad (x \in \partial \Omega) . \]
Choose some function spaces (for homogeneous $\b{u}_0 =\b{0}$).
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[ X = H^1_0 (\Omega)^n, \qquad M = L^2_0 (\Omega) \assign \left\{ q \in L^2
   (\Omega) : \int_{\Omega} qd x = 0 \right\} \]
#+LATEX: \end{hidden}
Derive a weak form.
#+LATEX: \begin{hidden}
\[
  a (\b{u}, \b{v}) = \int_{\Omega} J_{\b{u}} : J_{\b{v}}, \qquad
  b (\b{v}, q) = \int_{\Omega} \nabla \cdot \b{v} q,
\]
$A : B = \tmop{tr} (AB^T)=\sum_{i,j} A_{i,j} B_{i,j}$.
Find $(\b{u}, p) \in X \times M$ so that
\begin{eqnarray*}
  a (\b{u}, \b{v}) + b (\b{v}, p) & = &
  \ip{\b{f}}{\b{v}}_{L^2} \quad (\b{v} \in X),\\
  b (\b{u}, q) & = & 0 \quad (q \in M),
\end{eqnarray*}
where in reusing $b$, we used that $(- \tmop{div})^*=\tmop{grad}$ are
adjoint.
#+LATEX: \end{hidden}

*** Solvability of Saddle Point Problems

The Stokes weak form is clearly in saddle-point form.

Do all saddle point problems have unique solutions?
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  f (x, y) = x^2 + y^2 & \rightarrow & \min !,\\
  x + y & = & 2,\\
  3 x + 3 y & = & 6.
\end{eqnarray*}
$\mathcal{L} (x, y, \lambda) = x^2 + y^2 + \lambda (x + y - 2) + \mu (3 x + 3
y - 6)$. $(\lambda, \mu)$ no longer uniquely determined.

\medskip
$\rightarrow$ Need a criterion.
#+LATEX: \end{hidden}

*** The inf-sup Condition

# Find $(u, \lambda) \in X \times M$ so that
\vspace*{-4ex}
\begin{eqnarray*}
  a (u, v) + b (v, \lambda) & = & \ip{f}{v} \quad (v \in X),\\
  b (u, \mu) & = & \ip{g}{\mu} \quad (\mu \in M) .
\end{eqnarray*}
**** Brezzi's splitting theorem (Braess, III.4.3)
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

The saddle point problem has a unique solution if and only if

- The bilinear form $a (\cdot, \cdot)$ is \(V\)-elliptic, where
  \(V = \left\{ u : b (u, \mu) = 0 \text{for all $\mu \in M$} \right\}\), i.e. there exists $c_0 > 0$ so that
  #+LATEX: \begin{hidden}
  \[ a (v, v) \ge c_0 \norm{v}_X^2  \qquad (v\in V). \]
  #+LATEX: \end{hidden}

- There exists a constant $c_2 > 0$ so that (*inf-sup* or *LBB condition*):
  #+LATEX: \begin{hidden}
  \[ \inf_{\mu \in M} \sup_{v \in X} \frac{b (v, \mu)}{\norm{v}_X \norm{\mu}_M} \ge c_2 . \]
  #+LATEX: \end{hidden}

*** Interpreting the inf-sup Condition
\vspace*{-2ex}
\begin{equation*}
  \begin{bmatrix}
    A & B^T\\
    B & 0
  \end{bmatrix}
  =
  M
  \begin{bmatrix}
    A \\
      & -BA^{-1}B^T
  \end{bmatrix}
  M^T
\end{equation*}
\begin{equation*}
   a (v, v) \ge c_0 \norm{v}_X^2, \qquad
  \inf_{\mu \in M} \sup_{v \in X} \frac{b (v, \mu)}{\norm{v}_X \norm{\mu}_M} \ge c_2 .
\end{equation*}
For any given $v$, can we expect $b(v,\mu)$ to be nonzero for all $\mu$?
#+LATEX: \begin{hidden}
No! E.g. for Stokes, the $B$ block is short-and-fat $\Rightarrow$ $\exists$ nullspace.
#+LATEX: \end{hidden}
What is the inf-sup condition saying?
#+LATEX: \begin{hidden}
``$b$ has no \(\mu\)-nullspace.''
#+LATEX: \end{hidden}
Why does it suffice for $a$ to be \(V\)-elliptic?
#+LATEX: \begin{hidden}
True in the linear algebra, too! (Think Schur complements.) ([[https://doi.org/10.1017/S0962492904000212][Benzi et al. `05]], Thm. 3.2)
#+LATEX: \end{hidden}

*** inf-sup and Stokes
\begin{eqnarray*}
  a (\b{u}, \b{v}) & = & \int_{\Omega} J_{\b{u}} :
  J_{\b{v}}, \qquad \text{where } A : B = \tmop{tr} (AB^T),\\
  b (\b{v}, q) & = & \int_{\Omega} \nabla \cdot \b{v}q.
\end{eqnarray*}
Find $(\b{u}, p) \in X \times M$ so that
\begin{eqnarray*}
  a (\b{u}, \b{v}) + b (\b{v}, p) & = &
  \ip{\b{f}}{\b{v}}_{L^2} \quad (\b{v} \in X),\\
  b (\b{u}, q) & = & 0 \quad (q \in M).
\end{eqnarray*}
**** Existence and Uniqueness for Stokes (Braess, III.6.5)
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

There exists a unique solution of this system when $\b{f} \in H^{- 1}
(\Omega)^n$.

**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

(based on results due to Ladyšenskaya, Nečas)
*** Discretizations for Stokes

\demolink{fe-elliptic}{2D Stokes Using Firedrake} (\(P^1\)-\(P^1\))

\medskip
Give a heuristic reason why \(P^1\)-\(P^1\) might not be great.
#+LATEX: \begin{hidden}
The differential operators being applied to $\b u$ and $p$ in the Stokes system are of different order.
#+LATEX: \end{hidden}

\medskip
\demolink{fe-elliptic}{Bad Discretizations for 2D Stokes}
*** Establishing a Discrete inf-sup Condition

Suppose $b : X \times M \rightarrow \mathbb{R}$ satisfies inf-sup. Subspaces $X_h\subseteq X$, $M_h\subseteq M$.

**** Fortin's Criterion ([Fortin 1977])

Suppose there exists a bounded projector $\Pi_h : X \rightarrow X_h$ so that
#+LATEX: \begin{hidden}
\[ b (v - \Pi_h v, \mu_h) = 0 \quad (\mu_h \in M_h) . \]
#+LATEX: \end{hidden}
If $\norm{\Pi_h} \le c$ for some constant $c$ independent of $h$, then
$b$ satisfies the inf-sup-condition on $X_h \times M_h$.
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
Let $\mu_h \in M_h$. By assumption, $b (v, \mu_h) = b (\Pi_h v, \mu_h)$ for $v
\in X$.
\begin{align*}
   \sup_{v_h \in X_h} \frac{b (v_h, \mu_h)}{\norm{v_h}}
   &\ge \sup_{v_h
   \in \Pi_h X} \frac{b (v_h, \mu_h)}{\norm{v_h}} = \; \sup_{v \in X} \frac{b
   (\Pi_h v, \mu_h)}{\norm{\Pi_h v}}\\
   &\ge \frac{1}{c} \sup_{v \in X} \frac{b (v, \mu_h)}{\norm{v}}
   \ge c_2 \norm{\mu_h} .
\end{align*}
#+LATEX: \end{hidden}

*** \(H^1\)-Boundedness of the \(L^2\)-Projector

Assume \(H^2\)-regularity and a *uniform* triangulations
$\mathcal{T}_h$. (Not in general!)

**** \(H^1\)-Boundedness of the \(L^2\)-Projector (Braess Corollary II.7.8)

Let $\pi_h^0$ be the \(L_2\)-projector onto a finite element space $V_h \subset
H^1 (\Omega)$. Then, for an \(h\)-independent constant $c$,
#+LATEX: \begin{hidden}
\[ \norm{\pi_h^0 v}_{H^1} \le c \norm{v}_{H^1} . \]
#+LATEX: \end{hidden}
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

Ingredients?
#+LATEX: \begin{hidden}
- Regularity

- Aubin-Nitsche

- *Inverse estimates* (For affine, pw. polynomial family $V_h$:
  $\norm{v_h}_{H^t, h} \le Ch^{m - t} \norm{v_h}_{H^m, h}$ with $0
  \le m \le t$, e.g. $\norm{v_h}_{H^1, h} \le Ch^{- 1}
  \norm{v_h}_{L^2, h}$.)
#+LATEX: \end{hidden}

*** \(H^1\)-Boundedness of the \(L^2\)-Projector

Does $H^1$ boundedness of the $H^1$ projector hold?
#+LATEX: \begin{hidden}
Yes, any Hilbert space projection is bounded. (Pythagoras)
#+LATEX: \end{hidden}

How would this break down without the uniformity assumption?
#+LATEX: \begin{hidden}
On a graded mesh, where $L^2$ projection introduces $O (1 / h)$ growth in the
$H^1$ seminorm (which measures oscillation, in a way).
#+LATEX: \end{hidden}

*** Bramble-Hilbert Lemma                                          :noexport:

Let $\Omega \subset \mathbb{R}^2$ be a domain with Lipschitz boundary.

**** Bramble-Hilbert Lemma (Braess, Lemma II.6.3)

Suppose $t \ge 2$ and $L : H^t (\Omega) \rightarrow Y$ bounded, where
$Y$ is some normed linear space. If $P^{t - 1} \subset N (L)$ (i.e. if $L$
annihilates polynomials), then there exists a constant $c (\Omega)$ so that
\[ \norm{Lv}_Y \le c (\Omega) \norm{L} \seminorm{v}_{H^t} . \]
Let $\mathcal{I}: H^t \rightarrow P^{t - 1}$ be the interpolation operator.
Then, by the interpolation estimate,
\[ \norm{Lv}_Y = \norm{L (v -\mathcal{I}v)}_Y \le \norm{L} \cdot \norm{v
   -\mathcal{I}v}_{H^t} \le c (\Omega) \norm{L} \cdot \seminorm{v}_{H^t}
   . \]
*** Bubbles and the MINI Element

What is a *bubble function*?

#+LATEX: \begin{hidden}
$\varphi_b (r, s) = rs (1 - r - s)$. (see figure on next slide)
#+LATEX: \end{hidden}

Let $B^3$ be the span of the bubble function and $\mathcal{T}_h$ the triangulation.

\medskip
Define the MINI variational space $X_h \times M_h$.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  X_h & \assign & \left\{ v_h \in C (\bar{\Omega})^2 \cap H_0^1 (\Omega)^2 :
  v_h |_E \in (P^1 \oplus B^3)^2 \text{ for $E \in \mathcal{T}_h$}
  \right\}\\
  M_h & \assign & \left\{ q_h \in C (\bar{\Omega}) \cap L^2_0 (\Omega) : v_h |_E \in P^1 \text{ for $E \in \mathcal{T}_h$} \right\}
\end{eqnarray*}
#+LATEX: \end{hidden}
Computational impact of the bubble DOF?
#+LATEX: \begin{hidden}
Not coupled to DOFs outside the element; can use static condensation to
eliminate.
#+LATEX: \end{hidden}

*** The Bubble in Pictures

# Gnuplot:

# set isosamples 60
# set terminal tikz
# set output 'bubble.tikz'
# splot [r=0:1][s=0:1] r+s<=1?r*s*(1-r-s):1/0

#+BEGIN_CENTER
#+LATEX: {\scriptsize\input{media/bubble.tikz}}
#+END_CENTER

*** MINI Satisifies an inf-sup Condition (1/4)

**** MINI satisifes inf-sup (Braess Theorem III.7.2)

Assume $\Omega$ is convex or has a smooth boundary. Then the MINI variational
space satisfies an inf-sup condition for every variational form that itself
satisfies one.
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
Assume uniform meshes (can generalize). Let
\[\mathcal{M}_h \assign \left\{ v_h
\in C (\bar{\Omega}) \cap H_0^1 (\Omega) : v_h |_E \in P^1 \text{
for $E \in \mathcal{T}_h$} \right\}.\]
Let $\pi_h^0 : H^1_0 \rightarrow \mathcal{M}_h$ be the $L^2$ projector.

Then $\norm{\pi_h^0 v}_{H^1} \le c_1 \norm{v}_{H^1}$ from its
\(H^1\)-boundedness and, from the interpolation estimate,
\begin{align*}
  \norm{v - \pi_h^0 v}_{L^2}
  & \le \norm{v -\mathcal{I}v}_{L^2} + \norm{\mathcal{I}v - \pi_h^0 v}_{L^2}\\
  & = \norm{v -\mathcal{I}v}_{L^2} + \norm{\pi_h^0 (\mathcal{I}v - v)}_{L^2}
  \le c_2 h \seminorm{v}_{H^1} .
\end{align*}
#+LATEX: \end{hidden}
*** MINI Satisifies an inf-sup Condition (2/4)

Create a projector onto the bubble space $B^3$.

#+LATEX: \begin{hidden}
Let $\pi_h^1 : L^2 \rightarrow B^3$ be linear so that
\[ \int_E (\pi_h^1 v - v) d x = 0 \quad \text{for $E \in \mathcal{T}_h$} . \]
#+LATEX: \end{hidden}
What does this bubble projector do?
#+LATEX: \begin{hidden}
- Project onto piecewise constant functions.

- Replace the constant by a bubble with the same integral.
#+LATEX: \end{hidden}

Do we have an estimate for the bubble projector?
#+LATEX: \begin{hidden}
\[ \norm{\pi_h^1 v}_{L^2} \le c_3 \norm{v}_{L^2} . \]
#+LATEX: \end{hidden}

*** MINI Satisifies an inf-sup Condition (3/4)

Make an overall projector $\Pi_h$ onto $X_h$.

#+LATEX: \begin{hidden}
Define $\Pi_h v \assign \pi_h^0 v + \pi_h^1 (v - \pi_h^0 v)$. By construction,
$\Pi_h$ preserves the constant mode, i.e.
\(\int (\Pi_h v - v) d x = 0\).
#+LATEX: \end{hidden}

Show Fortin's criterion for $\Pi_h$.

#+LATEX: \begin{hidden}
Extend $\Pi_h$ to vector-valued component-by-component.

$q_h \in M_h$ is continuous, so we may apply Gauss's theorem.
\begin{eqnarray*}
  && b (\b{v}- \Pi_h \b{v}, q_h) \\
  & = & \int \nabla \cdot
  (\b{v}- \Pi_h \b{v}) q_h d x\\
  & = & \int_{\partial \Omega} (\b{v}- \Pi_h \b{v}) \cdot
  \hat{\b{n}}  \underbrace{q_h}_0 d S_x - \int_{\Omega} (v - \Pi_h v)
  \cdot \underbrace{\nabla q_h}_{\tmop{const}} d x = 0.
\end{eqnarray*}
#+LATEX: \end{hidden}

*** MINI Satisifies an inf-sup Condition (4/4)

- $\norm{\pi_h^0 v}_{H^1} \le c_1 \norm{v}_{H^1}$ for $L^2$ projector $\pi_h^0 : H^1_0 \rightarrow \mathcal{M}_h$.
- $\norm{v - \pi_h^0 v}_{L^2} \le c_2 h \seminorm{v}_{H^1}$.
- $\norm{\pi_h^1 v}_{L^2} \le c_3 \norm{v}_{L^2}$.

\medskip
Show \(H^1\)-boundedness of $\Pi_h$.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{eqnarray*}
  \norm{\Pi_h v_{}}_{H^1} & \le & \norm{\pi_h^0 v}_{H^1} + \norm{\pi_h^1
  (v - \pi_h^0 v)}_{H^1}\\
  & \underset{\text{inv.est.}}{\le} & c_1 \norm{v}_{H^1} + c_4 h^{- 1}
  \norm{\pi_h^1 (v - \pi_h^0 v)}_{L^2}\\
  & \le & c_1 \norm{v}_{H^1} + c_4 h^{- 1} c_3 \norm{v - \pi_h^0
  v}_{L^2}\\
  & \le & c_1 \norm{v}_{H^1} + c_4 c_3 c_2 \norm{v}_{H^1} .
\end{eqnarray*}

#+LATEX: \end{hidden}
*** Demo

\demolink{fe-elliptic}{2D Stokes Using Firedrake} (MINI and Taylor-Hood)
** Non-symmetric Bilinear Forms
*** Lax-Milgram, General Case

Let $V$ be Hilbert space with inner product $\ip{\cdot}{\cdot}$.

**** Lax-Milgram, General Case
     :PROPERTIES:
     :BEAMER_env: theorem
     :END:

Let $a$ be a \(V\)-elliptic bilinear form, and let $g$ be a bounded linear
functional on $V$.

Then there exists a unique $u \in V$ so that $a (u, v) = g (v)$ for all $v \in
V$.
**** End thm
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

#+LATEX: \begin{hidden}
Let $u \in V$ and observe $a_u (v) \assign a (u, v)$ is a bounded linear
functional (due to continuity of $a$). Let $t_u \in V$ be the Riesz
representer of $a_u$ with $a_u (v) = \ip{v}{t_u}$ for all $v \in V$. Consider
the mapping defined by that:
\[ T : V \rightarrow V, \qquad u \mapsto Tu \assign t_u . \]
We show that $T$ is linear, bounded, has closed range, and is onto $V$.
#+LATEX: \end{hidden}

*** Lax-Milgram Proof (2/5)

$a (u, v) = \ip{v}{Tu}$. Show linearity of $T$.
#+LATEX: \begin{hidden}
For $u, v, w \in V$ and $\alpha \in \mathbb{R}$:
\[ \ip{v}{T (\alpha u + w)} = a (\alpha u + w, v) = \alpha \ip{v}{Tu} +
   \ip{v}{Tw} . \]
#+LATEX: \end{hidden}

Show boundedness $\Leftrightarrow$ continuity of $T$.
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[ \norm{Tu}^2 = \ip{Tu}{Tu} = a_u (Tu) = a (u, Tu) \le c_1 \norm{Tu}
   \norm{u} \quad \text{(continuity)} . \]
#+LATEX: \end{hidden}

*** Lax-Milgram Proof (3/5)

$a (u, v) = \ip{v}{Tu}$. Show that $T$ has closed range. (Needed for Hilbert
projection, which is needed for onto.)
#+LATEX: \begin{hidden}
Let $z_n = Tu_n$ be a sequence in $\tmop{range} (T)$. By definition, $a (u_n,
v) = \ip{v}{Tu_n} = \ip{v}{z_n}$ for all $v \in V$, so that
\begin{eqnarray*}
  a (u_n - u_m, v) & = & \ip{v}{z_n - z_m}\\
  \Rightarrow \quad a (u_n - u_m, u_n - u_m) & = & \ip{u_n - u_m}{z_n - z_m}\\
  \Rightarrow \quad c_0 \norm{u_n - u_m}^2 & \le &
  \norm{u_n - u_m} \norm{z_n - z_m} \quad \text{(coercivity)}\\
  \Rightarrow \quad c_0 \norm{u_n - u_m} & \le & \norm{z_n - z_m} .
\end{eqnarray*}
If $z_n \rightarrow z$, $(u_n)$ must be Cauchy, so has a limit (because $V$ is
Hilbert). Let $u$ be the limit. Next: Show $z = Tu$.

Let $v \in V$ be arbitrary. $a (u_n, v) \rightarrow a (u, v)$ by continuity.
Also: $\abs{\ip{Tu_n - z}{v}} \rightarrow 0$, so that $\ip{v}{Tu_n}
\rightarrow \ip{v}{z}$, so $a (u, v) = \ip{v}{z}$, and by definition of $T$,
$z = Tu$.
#+LATEX: \end{hidden}

*** Lax-Milgram Proof (4/5)

$a (u, v) = \ip{v}{Tu}$. Show that $T$ is onto $V$.
#+LATEX: \begin{hidden}
Suppose not. By the Hilbert projection theorem, there exists $w \in
\tmop{range} (T)^{\perp} \setminus \{ 0 \}$. Therefore $\ip{w}{Tu} = 0$ for
all $u \in V$. Choosing $u = w$ gives $0 = \ip{w}{Tw} = a (w, w)$, a
contradiction.
#+LATEX: \end{hidden}

*** Lax-Milgram Proof (5/5)

Show existence of the solution $u$.

#+LATEX: \begin{hidden}

Let $z$ be the Riesz representer of $g$: $g (v) = \ip{v}{z}$ for all $v \in
V$. Since $T : V \rightarrow V$ is onto, there exists a $u \in V$ so that $z =
Tu$, i.e. $g (v) = \ip{v}{Tu} = a (u, v)$ for all $v \in V$.

#+LATEX: \end{hidden}

Show uniqueness of the solution $u$.

#+LATEX: \begin{hidden}
Suppose we have a second $\hat{u}$ with $z = T \hat{u}$. Then $a (u - \hat{u},
v) = 0$ for all $v \in V$, particularly $a (u - \hat{u}, u - \hat{u}) = 0$,
i.e. $u = \hat{u}$.
#+LATEX: \end{hidden}

** TODO Neumann problem
* Discontinuous Galerkin Methods for Hyperbolic Problems
  :PROPERTIES:
  :RELATE_TREE_SECTION_NAME: dg-hyperbolic
  :RELATE_TREE_SECTION_OPENED: true
  :END:
** Case Study: Maxwell's as a Conservation Law
*** Conservation laws
*Goal:* Solve /conservation laws/ on bounded domain $\Omega\subset \mathbb R^n$:
\[ \b q_t + \nabla \cdot \b F (\b q) = 0 \]

**** Example: Maxwell's Equations
\vspace{-3ex}
\begin{align*}
  \partial_{t}\b D-\nabla\times \b H
  & =-\b j,\qquad
  & \partial_{t}\b B+\nabla\times \b E & =\b 0,\\
  \nabla\cdot \b D & =\rho,
  & \nabla\cdot \b B & =0.
\end{align*}

**** End ex
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

What do we do with the divergence constraints?
#+LATEX: \begin{hidden}
Ignore them. If satisfied at initial condition, they continue to be satisfied.
#+LATEX: \end{hidden}

*** Rewriting Maxwell's

Let $\b q=(D_x, D_y, D_z, B_x, B_y, B_z)^T$. Consider $\b D=\epsilon \b E$ and $\b B=\mu \b H$.
\begin{align*}
  \partial_{t}\b D-\nabla\times \b H
  & =-\b 0,\qquad
  & \partial_{t}\b B+\nabla\times \b E & =\b 0.
\end{align*}
Rewrite in conservation law form: $\b q_t+\nabla \cdot F(\b q) = 0$
#+LATEX: \begin{hidden}
\begin{equation*}
  \b q_t + \nabla\cdot
  \begin{pmatrix}
    0&-{{B_z}\over{\varepsilon}}&{{B_y }\over{\varepsilon}}\\
    {{B_z}\over{ \varepsilon}}&0&-{{B_x}\over{\varepsilon}}\\
    -{{B_y}\over{\varepsilon}}&{{B_x}\over{ \varepsilon}}&0\\
    0&{{D_z}\over{\mu}}&-{{D_y }\over{\mu}}\\
    -{{D_z}\over{\mu}}&0&{{D_x}\over{\mu}}\\
    {{D_y}\over{\mu}}&- {{D_x}\over{\mu}}&0\\
  \end{pmatrix}
  =\b 0
\end{equation*}
#+LATEX: \end{hidden}
Could we also define $\b q=(E_x, E_y, E_z, H_x, H_y, H_z)^T$?
#+LATEX: \begin{hidden}
No: coeff. on the wrong side of the $\nabla \cdot$. Only OK for constant-coeff.
#+LATEX: \end{hidden}

** Evaluating Schemes for Advection
*** Solving $q_t+aq_x=0$: Finite Differences

#+BEGIN_CENTER
\begin{tikzpicture}
  \draw [->] (-3,0) -- ++(6,0);
  \draw [->] (0,-0.5) -- ++(0,2.5);
  \draw [thick, green,domain=-2.5:2.5] plot[mark=x,smooth] (\x,{sin(\x*180)+0.75}) ;
  \draw [blue,only marks,domain=-2.5:2.5] plot[mark=x] (\x,{sin(\x*180)+0.75}) ;
\end{tikzpicture}
#+END_CENTER

**** Adv
     :PROPERTIES:
     :BEAMER_col: 0.6
     :END:

#+LATEX: \begin{hidden}
\plusball Simple to implement

\plusball High-order

\plusball Local and explicit in time

\plusball Theory available

\minusball High-order/geometry: pick one.

- Upwind/downwind differencing?
  - How about in a system?
- Boundaries?
- Discontinuities?
#+LATEX: \end{hidden}
**** Eqn
     :PROPERTIES:
     :BEAMER_col: 0.4
     :END:

\[D_t^-+ aD_x^- =0\]

\[D_t^+ f := \frac{f(t+\Delta t) -f(t)}{\Delta t} \]

*** Solving $q_t+aq_x=0$: Finite Volume
\begin{tikzpicture}
  \draw [->] (-3,0) -- ++(6,0);
  \draw [->] (0,-0.5) -- ++(0,2.5);
  \draw [thick,green,domain=-2.5:2.5] plot[smooth] (\x,{sin(\x*180)+0.75}) ;
  \draw [blue,domain=-2.5:2.5,samples=200] plot (\x,{sin(round(\x*5)*36)+0.75}) ;
\end{tikzpicture}

**** Adv
     :PROPERTIES:
     :BEAMER_col: 0.6
     :END:

#+LATEX: \begin{hidden}

\plusball Robust, fast, good for c.laws

\plusball Local and explicit in time

\plusball Solid theory

\minusball High-order/geometry: pick one.

#+LATEX: \end{hidden}

**** Eqn
     :PROPERTIES:
     :BEAMER_col: 0.4
     :END:

\[\bar q_k:=\int_{(k-1/2)\Delta x}^{(k+1/2)\Delta x} q(x) dx \]

\vspace{-1.5ex}
\[ \Delta x \partial_t \bar q_k + f^{k+1/2}-f^{k-1/2} = 0 \]

$f^{k\pm1/2}$: flux ``reconstructions''

*** Solving $q_t+aq_x=0$: Finite Elements
#+BEGIN_CENTER
\begin{tikzpicture}
  \draw [->] (-3,0) -- ++(6,0);
  \draw [->] (0,-0.5) -- ++(0,2.5);
  \draw [green,domain=-2.5:2.5] plot[smooth] (\x,{sin(\x*180)+0.75}) ;
  %\draw [blue,domain=-2.5:2.5,samples=200] plot (\x,) ;
  \foreach \x in {-2.5,-2,...,2.5}
  {
    \pgfmathsetmacro{\yval}{sin(round(\x*5)*36)+0.75}
    \draw (\x-0.5,0) -- (\x,\yval) -- (\x+0.5,0);
  }
\end{tikzpicture}
#+END_CENTER

**** Adv
     :PROPERTIES:
     :BEAMER_col: 0.6
     :END:

#+LATEX: \begin{hidden}

\plusball High-order

\plusball geom. flexible

\plusball Non-local and implicit in time

\plusball Solid theory

\minusball Not nonlinearly robust

\minusball Not fast: Mass matrix solve

#+LATEX: \end{hidden}
**** Math
     :PROPERTIES:
     :BEAMER_col: 0.4
     :END:

\[
  \int_\Omega q_t^N \phi +aq_x^N \phi dx =0
\]

for $\phi$ in a test space.
*** Do we really want high order?

**** Figure
     :PROPERTIES:
     :BEAMER_col: 0.5
     :END:

#+ATTR_LATEX: :width \textwidth
[[./media/high-order-better.pdf]]

\credit{Figure from talk by Jan Hesthaven}

**** Text
     :PROPERTIES:
     :BEAMER_col: 0.5
     :END:

Time to compute solution at 5% error

\bigskip
Big assumption?
#+LATEX: \begin{hidden}
Spectral expansion of solution decays quickly

(i.e. solution smooth)
#+LATEX: \end{hidden}

*** Summarizing

Want flexibility of finite elements /without/ the drawbacks.

#+LATEX: \begin{hidden}
Let's redevelop finite elements, with a bit more care.

Strategy:
- Use \(n\)-dimensional POV for a while to expose geometric issues more clearly.
- Reduce to 1D when necessary.
- Mop up remaining issues later.
#+LATEX: \end{hidden}

** Developing DG
*** Developing the Scheme

\input{media/unstructuredmesh.tex}
#+BEGIN_CENTER
\begin{tikzpicture}[scale=0.8]
  \meshnodes
  \meshtris
  %\drawnodenames
  \node [left=1cm of d] {$\Omega$};
  \draw [fill=blue!30] (c) -- (n) -- (g) ;
  \node [below=5mm of g,xshift=-5mm] (ellabel) {$E_m$};
  \draw [thick,->,shorten >=5mm] (ellabel) -- (c) ;
\end{tikzpicture}
#+END_CENTER

What do do about unbounded domains?
#+LATEX: \begin{hidden}
Need to truncate domain, e.g.:

- Special boundary conditions (e.g. [[https://doi.org/10.1073/pnas.74.5.1765][Engquist/Majda `77]], [[https://doi.org/10.1016/j.wavemoti.2003.12.007][Hagstrom/Warburton `04]])
- *Perfectly Matched Layers* (PMLs, [[https://doi.org/10.1006/jcph.1994.1159][Berenger `94]])
#+LATEX: \end{hidden}

*** Dealing with the Mesh, Part I
For each cell $E_k$, find a ref-to-global map $T_k$:

#+BEGIN_CENTER
\begin{tikzpicture}[scale=0.7]
  \draw (0,-2) -- ++(0,4);

  \begin{scope}[xshift=-2cm]
    \draw (-1,-1) -- (1,-1) -- (-1,1) --cycle;

    \node at (0,-1.5) {$\hat E$};
  \end{scope}

  \begin{scope}[xshift=3cm]
    \draw (-1.8,-1.3) -- (0.35,-1.1) -- (-1.5,0.8) --cycle;

    \node at (0,-1.5) {$E_k$};
  \end{scope}

  \draw [thick,->](-2.5,-0.5)..controls +(1,1) .. (2,-0.5)
  node [pos=0.5,anchor=south] {$T_k$};
\end{tikzpicture}
#+END_CENTER

\begin{align*}
  T_k : \hat E \to E_k\\
  \b x=(x,y,z)&=T_k(r,s,t) =T_k(\b r)
\end{align*}
- $T_k$ affine for straight-sided simplices: $T_k(\b r)=A\b r+\b b$
- Curved elements also possible: iso/sub/super-parametric

*** Dealing with the Mesh, Part II

Based on knowledge of how to do this on $\hat E$:

\bigskip
Can now /integrate/ on $\Omega$:
#+LATEX: \begin{hidden}
\[
  \int_\Omega f dx
  = \sum_{E_k}\int_{E_k} f dx
  = \sum_{E_k}\int_{\hat E} f \left|\frac{d \b x}{d\b r}\right| dr
\]
#+LATEX: \end{hidden}

and /differentiate/ on $\Omega$:
#+LATEX: \begin{hidden}
\[
  \frac{\partial f}{\partial \b x}
  =
  \frac{\partial \b r}{\partial \b x}
  \frac{\partial f}{\partial \b r}
\]
#+LATEX: \end{hidden}

Jacobian of $T_k^{-1}$?
#+LATEX: \begin{hidden}
\[
  \frac{d \b x}{d\b r}
  \frac{d \b r}{d\b x}
  = \operatorname{Id}
  \quad
  \Leftrightarrow
  \quad
  \left(\frac{d \b x}{d\b r}\right)^{-1}
  =
  \frac{d \b r}{d\b x}
\]
#+LATEX: \end{hidden}

*** Dealing with the Mesh, Part III
Approximation basis set on \(E_k\)?

#+LATEX: \begin{hidden}

Use the one we have on \(\hat E\):
\[\phi_i^k(x):=\phi_i(T_k^{-1}(x)) \]
#+LATEX: \end{hidden}

What function space do we get if $\Psi$ is non-affine?
#+LATEX: \begin{hidden}
- A basis of rational functions.
- Approximation results nontrivial.
#+LATEX: \end{hidden}

*** Going Galerkin
**** Derivation
     :PROPERTIES:
     :BEAMER_col: 0.8
     :END:
\[\int_{E_k} q_t^k \phi +(\nabla\cdot F^k)\phi dx = 0 \]
Integrate by parts:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\[
  0 =
  \int_{E_k} q_t^k \phi dx  -\int_{E_k} F^k \cdot \nabla \phi dx
  +\int_{\partial E_k} (F^k \cdot \hat {\b n}) \phi dx
\]
#+LATEX: \end{hidden}
Problem?
#+LATEX: \begin{hidden}
- *Problem:* Two values to choose from on boundary.
- Don't choose (for now).
- Call chosen answer *numerical flux* $(F^k \cdot n)^*$
- Feel vaguely reminded of finite volume
#+LATEX: \end{hidden}

**** Figure
     :PROPERTIES:
     :BEAMER_col: 0.2
     :END:

\begin{tikzpicture}[rotate=20,thick]
  \draw [fill=green!30] (-1,0) -- (1,0) -- (0.2,1.5) --cycle;
  \draw [ultra thick,->] (0,0) --(0,0.6);
  \draw [yshift=-1mm] (-1,0) -- (1,0) -- (-0.1,-1.5) --cycle;
\end{tikzpicture}

*** Strong-Form DG

/Weak form/:
\[
  0 =
  \int_{E_k} q_t^k \phi dx  -\int_{E_k} F^k \cdot \nabla \phi dx
  +\int_{\partial E_k} (F^k \cdot \hat{\b n})^* \phi dx
\]
Integrate by parts /again/:
#+LATEX: \begin{hidden}
\[
  0 =
  \int_{E_k} q_t^k \phi +(\nabla\cdot F^k)\phi dx
  +\int_{\partial E_k} (F^k \cdot \hat{\b n})^*-(F^k \cdot \hat{\b n})^- \phi dx
\]

- *Strong-form DG*
- Same solution as weak for linear, constant-coefficient problems.
#+LATEX: \end{hidden}
** Fluxes and Stability
*** Accuracy and Stabillity

In DG: what provides accuracy? what provides stability?
#+LATEX: \begin{hidden}
- Local approximation space provides /accuracy/
- Fluxes provide /stability/

*Lax equivalence:* Accuracy + Stability = Convergence

\medskip
\to Let flux choice be guided by stability.
#+LATEX: \end{hidden}

\credit{Following slides based on material by Tim Warburton}

*** Stability: Basic Setup (1/2)

\[0 =
  \int_{E_k} q_t^k \phi dx  -\int_{E_k} F^k\cdot\nabla \phi dx
  +\int_{\partial E_k} (F^k \cdot \hat{\b n}) \phi dS_x \]
#+LATEX: \begin{hidden}
Trick: Set $\phi = q$. Specialize $F(u):=(a u, 0,0)^T =ae_xu$.
\begin{align*}
  0
  &= \int_{E_k} q_t^k q_k dx  -\int_{E_k} a q_k e_x\cdot \nabla q_k dx
  +\int_{\partial E_k} (a q_k e_x \cdot \hat{\b n})^* q_k dS_x\\
    &= \int_{E_k} q_t^k q_k dx  -\int_{E_k} a q_k \partial_x q_k dx
    +\int_{\partial E_k} (a q_k n_x)^* q_k dS_x\\
    &= \frac{\partial_t}2 \int_{E_k} q_k q_k dx  -\int_{E_k} a q_k \partial_x q_k dx
    +\int_{\partial E_k} (a q_k n_x)^* q_k dS_x
\end{align*}
\[\Rightarrow \frac {\partial_t \|q_k\|_{2,E_k}^2}2
  = \int_{E_k} a q_k \partial_x q_k dx
  -\int_{\partial E_k} (a q_k n_x)^* q_k dS_x \uncover<+->{\overset{!}\le 0} \]
#+LATEX: \end{hidden}

*** Stability: Basic Setup (2/2)
\[\frac {\partial_t \|q_k\|_{2,E_k}^2}2
  = \int_{E_k} a q_k \partial_x q_k dx
  -\int_{\partial E_k} (a q_k n_x)^* q_k dS_x
\]
#+LATEX: \begin{hidden}
Integrate by parts:
\[
  \int f\partial_x f = -\int f\partial_x f +\int_\partial f^2 n_x
\]
to see:
\[\frac {\partial_t \|q_k\|_{2,E_k}^2}2
  = \int_{\partial E_k}  \frac{ a (q_k)^2 n_x}2 - (a q_k n_x)^* q_k dS_x
\]

\medskip
This depends on neighbors--end of element-local analysis!
#+LATEX: \end{hidden}
*** Stability: Going Global

\[\frac {\partial_t \|q_k\|_{2,E_k}^2}2
  = \int_{\partial E_k}  \frac{ a (q_k)^2 n_x}2 - (a q_k n_x)^* q_k dS_x
\]
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
\frac {\partial_t \|q_k\|_{2,\Omega}^2}2
  &= \sum_k \int_{\partial E_k}  \frac{ a (q_k)^2 n_x}2 - (a q_k n_x)^* q_k dS_x\\
  &= \sum_{f\in \text{faces}}
  \Big(
  \int_{f}  \frac{ a (q_k^+)^2 n_x^+}2 - (a q_k n_x)^*_+ q_k^+ dS_x\\
  &\qquad
  +\int_{f}  \frac{ a (q_k^-)^2 n_x^-}2 - (a q_k n_x)^*_- q_k^- dS_x
  \Big)
\end{align*}

# - $+/-$ terminology: normal points towards ``$+$'', i.e. $\hat{\b n}^-=-\hat{\b n}^+$
- Assumption: \((a q_k n_x)^*_+ + (a q_k n_x)^*_- = 0 \)

  (``no accumulation on interface'')
- $a$ is constant
#+LATEX: \end{hidden}

*** Gather up

\vspace*{-3ex}
\begin{align*}
\frac {\partial_t \|q_k\|_{2,\Omega}^2}2
    &= \sum_{f\in \text{faces}}
    \Big(
    \int_{f}  \frac{ a (q_k^+)^2 n_x^+}2 - (a q_k n_x)^*_+ q_k^+ dS_x\\
    &\qquad
    +\int_{f}  \frac{ a (q_k^-)^2 n_x^-}2 - (a q_k n_x)^*_- q_k^- dS_x
    \Big)
\end{align*}
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
\frac {\partial_t \|q_k\|_{2,\Omega}^2}2
    &= \sum_{f\in \text{faces}}
    \int_{f}  an_x^- \frac{ (q_k^-)^2 -(q_k^+)^2 }2 - (a q_k n_x)^*_-( q_k^- - q_k^+) dS_x\\
    &= \sum_{f\in \text{faces}}
    \int_{f}  \left(an_x^- \frac{ q_k^- +q_k^+ }2 - (a q_k n_x)^*_-\right)( q_k^- - q_k^+) dS_x
\end{align*}
Want all that non-positive. So demand:
\[
  \left(an_x^- \frac{ q_k^- +q_k^+ }2 - (a q_k n_x)^*_-\right)( q_k^- - q_k^+)
  \overset{!}\le 0
\]
#+LATEX: \end{hidden}

*** Picking a Flux

Want:
\[
  (*) =
  \left(an_x^- \frac{ q_k^- +q_k^+ }2 - (a q_k n_x)^*_-\right)( q_k^- - q_k^+)
  \overset{!}\le 0
\]
Ideas?
#+LATEX: \begin{hidden}
One possible choice:
\[
  (a q_k n_x)^*_-:=
  a n_x^- \frac{ q_k^- + q_k^+}2
\]

- Called the \emph{central flux}.
- Observe: $(*)=0$ $\Rightarrow$ \(L^2\)-norm exactly
  conserved!
- The lazy man's flux.
- Works.
- Problematic! Why?
#+LATEX: \end{hidden}
*** Picking a flux, attempt two

Want:
\[
    (*) =
    \left(an_x^- \frac{ q_k^- +q_k^+ }2 - (a q_k n_x)^*_-\right)( q_k^- - q_k^+)
    \overset{!}\le 0
\]
More ideas?
#+LATEX: \begin{hidden}
\begin{equation*}
  (a q_k n_x)^*_-:=
  a n_x^- \frac{ q_k^- + q_k^+}2
  +\alpha
  \frac{ q_k^- - q_k^+}2
\end{equation*}
(with $\alpha\ge 0$)

Unit considerations suggest: $\alpha=\pm an_x^-\overset{!}\ge 0$.

\medskip
Called the *upwind flux* (aka local L-F)

- Observe: $(*)<0$ $\Rightarrow$ dissipative!
- Quite good in practice.
#+LATEX: \end{hidden}
*** Comparing Fluxes (1/3)
**** Central
     :PROPERTIES:
     :BEAMER_col: .5
     :END:

Central

#+ATTR_LATEX: :height 4cm
[[./media/central-flux-crop.pdf]]

**** Upwind
     :PROPERTIES:
     :BEAMER_col: .5
     :END:

Upwind

#+ATTR_LATEX: :height 4cm
[[./media/upwind-flux-crop.pdf]]

\credit{Figure from talk by Jan Hesthaven}

**** Comments
     :PROPERTIES:
     :BEAMER_env: ignoreheading
     :END:

Upwind penalizes jumps!
*** Comparing Fluxes (2/3)

#+ATTR_LATEX: :height 7cm
[[./media/max-jump.pdf]]

\credit{Figure from lecture by Tim Warburton}
*** Comparing Fluxes (3/3)

#+ATTR_LATEX: :height 7cm
[[./media/max-error.pdf]]

\credit{Figure from lecture by Tim Warburton}
*** Stability Analysis

Clif notes on flux choice?
#+LATEX: \begin{hidden}
`Pick the average' or `pick the upwind value'
#+LATEX: \end{hidden}

Swept under the rug: Boundary conditions
#+LATEX: \begin{hidden}
Also important for stability!
#+LATEX: \end{hidden}
Element coupling (and BCs) done /weakly/
#+LATEX: \begin{hidden}
- Numerical solution really is discontinuous
- Hence ``discontinuous Galerkin''
#+LATEX: \end{hidden}

*** Accuracy

Stability: (preliminary version) done!

Accuracy: Depends on approximation properties!
#+LATEX: \begin{hidden}


Need approximation space: polynomials of (total) degree at most
$N$ on the reference element.

\medskip
So, expect $h^{N+1}$ residual.

\medskip
Practically often true. Theoretically:
- Lesaint, Raviart `74:
  - $h^N$ in the general case
  - $h^{N+1}$ for special grids
- Johnson `86: $h^{N+1/2}$
#+LATEX: \end{hidden}
*** Systems of Conservation Laws

What to do about systems?

#+LATEX: \begin{hidden}
- Consider Riemann (jump) problem
  - Obtain `fan' of different wave speeds
- /Rankine-Hugoniot condition/:
  \[ \jump{F(q)} = \text{(wave speed)}\jump{q} \]
- Number states across fan $q_0, q_{-1}, q_{1}, \dots$
- Set up Rankine-Hugoniot at each state boundary
- Solve for rest-state flux $F(q_0)$
- Just like Finite Volume
#+LATEX: \end{hidden}
*** What about multiple dimensions?
**** Text
     :PROPERTIES:
     :BEAMER_col: 0.7
     :END:

We've dealt with 1D systems.

\medskip
How about the move to multiple dimensions?
#+LATEX: \begin{hidden}



\medskip
/In principle/ there is (almost) nothing to see.

\medskip
Recipe:
- Reduce \(n\)D c.law to \(1\)D c.law across boundary
- *Diagonalize*
- Play Rankine-Hugoniot game as before
- Transform back
#+LATEX: \end{hidden}

**** Figure
     :PROPERTIES:
     :BEAMER_col: 0.3
     :END:

\begin{tikzpicture}[rotate=20,thick]
  \draw [fill=green!30] (-1,0) -- (1,0) -- (0.2,1.5) --cycle;
  \draw [ultra thick,->] (0,0) --(0,0.6);
  \draw [yshift=-1mm] (-1,0) -- (1,0) -- (-0.1,-1.5) --cycle;
\end{tikzpicture}
*** Simultaneous Diagonalization

2D second-order wave equation across a boundary with normal $n$:
#+LATEX: \begin{hidden}
\begin{equation*}
  q_t +
  \begin{pmatrix}0&-c\,{\it n_x}&-c\,{\it n_y}\cr -c\,{\it n_x}&0&0\\ -c\,
         {\it n_y}&0&0 \end{pmatrix}
  \partial_n q = 0
\end{equation*}
Must simultaneously diagonalize for all $(n_x,n_y)^T$ to obtain
generic expression!

More symbolically:
\begin{equation*}
  q_t + (A n_x) \partial_x q +(B n_y) \partial_y q
\end{equation*}
Need to find matrix $S$ that simultaneously diagonalizes $An_x$ and
$Bn_y$!
#+LATEX: \end{hidden}

\demolink{dg-hyperbolic}{Finding Numerical Fluxes for DG} (Part 1)

*** Jumps and Averages

Jump and average of a scalar quantity:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
  \avg q &:= \frac{q^-+q^+}2\\
 \jump q &:= q^+\b n^++q^-\b n^-
\end{align*}
#+LATEX: \end{hidden}

Jump and average of a vector quantity:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
  \avg{\b q} &:= \frac{\b q^-+\b q^+}2\\
 \jump{\b q} &:= \b q^+\cdot \b n^++\b q^-\cdot \b n^-
\end{align*}
#+LATEX: \end{hidden}
*** A Flux for Maxwell's
Wanted to solve Maxwell's equation in the time domain. Numerical flux?

\medskip
Either look in the [[https://doi.org/10.1016/0010-4655(91)90199-U][literature]]:
\[
  \hat{\b n} \cdot( \b F_N-\b F_N^{\ast}):=
  \frac 12
  \begin{pmatrix}
    \avg Z^{-1} \hat{\b n} \times (Z^+ \jump{\b H} - \alpha \hat{\b n} \times \jump{\b E}) \\
    \avg Y^{-1} \hat{\b n} \times (-Y^+ \jump{\b E} - \alpha \hat{\b n} \times \jump{\b H})
  \end{pmatrix}.
\]
or derive yourself: \demolink{dg-hyperbolic}{Finding Numerical Fluxes for DG} (Part 2)

\medskip
*Good news:* Scheme mathematically complete.

** Implementation Concerns
*** Implementing DG
/Weak form/:
\[
  0 =
  \int_{E_k} q_t^k \phi dx  -\int_{E_k} F^k \cdot \nabla \phi dx
  +\int_{\partial E_k} (F^k \cdot n)^* \phi dx
\]
What do the DoFs mean?

#+LATEX: \begin{hidden}
Two main choices:
- /Modal/ DG (expansion coefficients)
- /Nodal/ DG (point values at nodal locations)

We choose to use *nodal DG* here.

\medskip
Need: set of basis functions, set of nodes
#+LATEX: \end{hidden}
*** Modes

**** Text
     :PROPERTIES:
     :BEAMER_col: 0.8
     :END:

Function spaces same as for FEM: $P^N$, $Q^N$.

\medskip
Numerically: better to use orthogonal polynomials with
\[\int_{\hat E} \phi_i\phi_j=\delta_{i,j}\]
#+LATEX: \begin{hidden}

- 1D: Legendre polys
- \(n\)D: Proriol `57/Koornwinder `75/Dubiner `93

Notation: $(\phi_i)_{i=1}^{N_p}$.
#+LATEX: \end{hidden}

**** Figure
     :PROPERTIES:
     :BEAMER_col: 0.2
     :END:

#+BEGIN_CENTER
\begin{tikzpicture}
  \draw [->] (-1.3,0) -- (1.3,0) ;
  \draw [->] (0,-1.3) -- (0,1.3) ;
  \draw [ultra thick,black] plot file {media/legendre-1.dat} ;
  \draw [ultra thick,green] plot file {media/legendre-2.dat} ;
  \draw [ultra thick,blue] plot file {media/legendre-3.dat} ;
  \draw [ultra thick,magenta] plot file {media/legendre-4.dat} ;
\end{tikzpicture}
#+END_CENTER
*** Nodes
Define set of interpolation nodes
$(\xi_i)_{i=1}^{N_p}$ and $\ell_i$ their Lagrange basis.

\medskip
Define \emph{generalized Vandermonde matrix}
\[V_{ij}:=\phi_j(\xi_i) \]

**** Dev
     :PROPERTIES:
     :BEAMER_col: 0.7
     :END:
#+LATEX: \begin{hidden}

\[V\text{(modal coeff.)} = \text{(nodal coeff.)} \]
#+LATEX: \end{hidden}
$\xi_i$ determine $\operatorname{cond}(V)$!
#+LATEX: \begin{hidden}
- Equispaced nodes: cond. exponential in $N$
- 1D: Gauß-Lobatto or Chebyshev
- \(n\)D: cottage industry

  (e.g. [Warburton `06])
#+LATEX: \end{hidden}

**** Figure
     :PROPERTIES:
     :BEAMER_col: 0.3
     :END:

#+ATTR_LATEX: :width \textwidth
[[./media/tet-nodes.png]]
*** In Matrix Form

\[0 =
  \int_{E_k} q_t^k \phi dx  -\int_{E_k} F^k \cdot \nabla \phi dx
  +\int_{\partial E_k} (F^k \cdot n)^* \phi dx \]
Write in matrix form:
#+LATEX: \begin{hidden}
\vspace{-3ex}
\begin{align*}
  \mathcal M_{i j}^k &\assign \int_{E_k} \ell_i \ell_j dx
  =|A_k|\mathcal M\assign |A_k| \int_{\hat E} \ell_i \ell_j dx
  =|A_k| V^{-T} V^{-1}\\
  \mathcal S_{i j}^{k, \partial\nu} & \assign \int_{E_k} \ell_i \partial_{x_{\nu}} \ell_j \mathd x,\\
  \mathcal M_{i j}^{k, A} & \assign \int_{A \subset \partial E_k} \ell_i \ell_j \mathd S_x.
\end{align*}
\begin{equation*}
  0 =  \mathcal M^k \partial_t u^k
  - \sum_{\nu} \mathcal S^{k, \partial_{\nu}} [F(u^k)]
  + \sum_{A \subset \partial E_k} \mathcal M^{k, A}
  ( \hat{n} \cdot F)^{\ast}
\end{equation*}
#+LATEX: \end{hidden}
*** Explicit Time Integration

\begin{equation*}
  0 =  \mathcal M^k \partial_t u^k
  - \sum_{\nu} \mathcal S^{k, \partial_{\nu}} [F(u^k)]
  + \sum_{A \subset \partial E_k} \mathcal M^{k, A}
  ( \hat{n} \cdot F)^{\ast}
\end{equation*}
How can we do time integration on this weak form?
#+LATEX: \begin{hidden}
Goal: Dig out $\partial_t u$! Must invert $\mathcal M$.\medskip

- In `normal' finite elements: large, unstructured, sparse matrix
- In DG: Block-diagonal
- In simplicial DG: Templated block-diagonal
- In curvilinear DG: /Still/ templated block-diagonal

  e.g.: [Warburton `08], [[[https://doi.org/10.1137/16M1089198][Chan, Hewett, Warburton `17]]]
#+LATEX: \end{hidden}
*** Trick: Multiple face mass matrices

Applying multiple face mass matrices at once:
#+LATEX: \begin{hidden}


\begin{multline*}
\int_{\partial E_k}  \hat n \cdot
  (F^*) \phi \mathd S
=\\
\text{
\begin{minipage}{3.4cm}
\beginpgfgraphicnamed{multi-face-mass-matrix}
\begin{tikzpicture}[
  densemat/.style={fill=gray!30},
  ]
  \draw (2,-1) rectangle +(3,2) ;
  %
  % guts of the multi-face mass matrix
  \draw [densemat] (2,1) rectangle +(1,-1) ;
  \foreach \ys/\ye in {0.1/0.3, -0.25/-0.7, 0.6/0.8}
  { \draw [densemat] (3,\ys) rectangle (4,\ye) ; }
  \foreach \ys/\ye in {0.4/0.1, -0.1/-0.3, -0.9/-1, 1/0.9}
  { \draw [densemat] (4,\ys) rectangle (5,\ye) ; }
%
  \node at (2.5,0.5) {$M^{A_1}$} ;
  \node at (3.5,-0.475) {$M^{A_2}$} ;
  \node at (4.5,0.25) {$M^{A_3}$} ;
\end{tikzpicture}
\endpgfgraphicnamed
\end{minipage}
}
\bigg(
J_1 \hat n \cdot  (F^*) | _{A_1}
\bigg|
\cdots
\bigg|
J_3 \hat n \cdot  (F^*) | _{A_3}
\bigg).
\end{multline*}
#+LATEX: \end{hidden}

*** DG and Modern Computers: Possible Advantages
DG on modern processor architectures: Why?

#+LATEX: \begin{hidden}
- On-chip parallelism
  - DG inherently parallel.
- Deepening Memory Hierarchy
  - The majority of DG is local.
- Compute Bandwidth $\gg$ Memory Bandwidth
  - DG is arithmetically intense.
- Processors favor dense data.
  - Local parts of the DG operator are dense.
- Penalty on scattered access.
  - DG's cell connectivity is sparser than CG's
  - and more regular.
#+LATEX: \end{hidden}

** TODO Nonlinearities, Overintegration
** TODO Curvi, WADG
* A Glimpse of Integral Equation Methods for Elliptic Problems :noexport:
  :PROPERTIES:
  :RELATE_TREE_SECTION_NAME: ie-elliptic
  :RELATE_TREE_SECTION_OPENED: true
  :END:
